function ImportType(t){}function CastType(t){return t}function _createTClass_(){var t=this.prototype,e=this,i=new e;return i.classname=t.__class__,i._initclass_(),i}function _createTObject_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=_createTClass_.call(this),r=[],o=i;null!=o;)o.hasOwnProperty("initObj")&&r.push(o),o=Object.getPrototypeOf(o);return r=r.reverse(),r.forEach(function(e){(r=e.initObj).call.apply(r,[i].concat(t));var r}),i}function OverrideEUIInit(){eui.override._init()}function CollectGarbage(){"undefined"!=typeof g_CollectGarbage&&g_CollectGarbage()}function OverrideEgretInit(){egret.override._init(),RES.override._init()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},core;!function(t){function e(t,e){for(var r in e)"prototype"!=r&&e.hasOwnProperty(r)&&(t[r]=e[r]);for(var o=t.prototype,n=e.prototype,a=Object.keys(n),s=a.length,h=0;s>h;h++){var l=a[h];if(!o.hasOwnProperty(l)||i(o,l)){var p=Object.getOwnPropertyDescriptor(n,l);Object.defineProperty(o,l,p)}}}function i(t,e){if("function"!=typeof t[e])return!1;var i=t[e].toString(),r=i.indexOf("{"),o=i.lastIndexOf("}");return i=i.substring(r+1,o),""==i.trim()}t.MixinClasses=e}(core||(core={}));var TClass=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._initclass_=function(){this.mReferenceCount=1},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.getInstance=function(){return void 0==this._instance&&(this._instance=_createTObject_.call(this)),this._instance},e.destoryInstance=function(){void 0!=this._instance&&(this._instance.deleteObj(),this._instance=void 0)},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=_createTObject_.call.apply(_createTObject_,[this].concat(t));return i.autorelease(),i},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _createTObject_.call.apply(_createTObject_,[this].concat(t))},e.prototype.deleteObj=function(){this.mReferenceCount=0;for(var t=this;null!=t;)t.hasOwnProperty("destory")&&t.destory.call(this),t=Object.getPrototypeOf(t)},e.prototype.retain=function(){TLog.Assert(this.mReferenceCount>=0,"this.mReferenceCount >= 0"),this.mReferenceCount++},e.prototype.release=function(){TLog.Assert(this.mReferenceCount>=0,"this.mReferenceCount >= 0"),this.mReferenceCount--,0==this.mReferenceCount&&this.deleteObj()},e.prototype.releaseLater=function(){core.AutoreleasePool.getInstance().addObject(this)},e.prototype.getReferenceCount=function(){return this.mReferenceCount},e.prototype.autorelease=function(){core.AutoreleasePool.getInstance().addObject(this)},e.prototype.getProperty=function(t){return t in this?this[t]:null},e}(egret.HashObject);__reflect(TClass.prototype,"TClass");var core;!function(t){var e=function(t){function e(){var e=t.call(this,"",!1,!1)||this;return e._initclass_(),e.handle=0,e}return __extends(e,t),e.prototype._initclass_=function(){},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.deleteObj=function(){},e.prototype.retain=function(){},e.prototype.release=function(){},e.prototype.autorelease=function(){},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e}(egret.Event);t.EventArgs=e,__reflect(e.prototype,"core.EventArgs");var i=function(t){function e(){var e=t.call(this)||this;return e.mCurrentEventName="",e._initclass_(),e}return __extends(e,t),e.prototype._initclass_=function(){},e.getInstance=function(){},e.destoryInstance=function(){},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.deleteObj=function(){},e.prototype.retain=function(){},e.prototype.release=function(){},e.prototype.releaseLater=function(){},e.prototype.autorelease=function(){},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.prototype.$addListener=function(e,i,r,o,n,a){var s=this.$getEventMap(o),h=s[e];(!h||TLog.Assert(this.isEventExsit(h,i,r),"EventSet registerEvent %s exsit...",e))&&t.prototype.$addListener.call(this,e,i,r,o,n,a)},e.prototype.fireEvent=function(e,i,r){var o=this.mCurrentEventName;this.mCurrentEventName=e,i.$type=e,i.$bubbles=!!r;var n=t.prototype.dispatchEvent.call(this,i);return this.mCurrentEventName=o,n},e.prototype.dispatchEvent=function(t){throw new Error("dispatch not support")},e.prototype.isEventExsit=function(t,e,i){for(var r=0;r<t.length;r++){var o=t[r];if(o.listener==e&&o.thisObject==i&&o.target==this)return!1}return!0},e.prototype.clearEvent=function(){this.$EventDispatcher={1:{},2:{},3:0},this.mCurrentEventName=""},e.prototype.getCurrentEventName=function(){return this.mCurrentEventName},e}(egret.EventDispatcher);t.EventSet=i,__reflect(i.prototype,"core.EventSet"),t.MixinClasses(e,TClass),t.MixinClasses(i,TClass)}(core||(core={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mbInView=!1,this.mParentLayer=null,this.mNodeIndex=0,this.mOriginalParent=null},i.prototype.destory=function(){var t=this.getDisplayNode();t.parent&&t.parent.removeChild(t)},i.prototype.setInCameraView=function(t,e){e!=this.mbInView&&(this.mbInView=e,e?this.onCameraFound():this.onCameraLost())},i.prototype.onUpdate=function(t){if(t){var e=this.isInCameraView(t);this.setInCameraView(t,e)}else this.setInCameraView(t,!0)},i.prototype.isInCameraView=function(t){var e=this.getBoundRect(),i=t.getViewRect(),r=i.intersects(e);return r},i.prototype.isClip=function(){return!this.mbInView},i.prototype.onCameraFound=function(){if(null!=this.mParentLayer){var t=this.getDisplayNode();null==t.parent&&this.mParentLayer.getDisplayNode().addChildAt(t,this.mNodeIndex)}},i.prototype.onCameraLost=function(){if(null!=this.mParentLayer){var t=this.getDisplayNode(),e=this.mParentLayer.getDisplayNode();t.parent==e&&(this.mNodeIndex=e.getChildIndex(t),e.removeChild(t))}},i.prototype.setVisible=function(t){var e=this.getDisplayNode();e.visible!=t&&(null==this.mOriginalParent&&(this.mOriginalParent=e.parent),t?this.mOriginalParent?this.mOriginalParent.addChild(e):this.mParentLayer&&this.mParentLayer.getDisplayNode().addChild(e):(this.mOriginalParent=e.parent,e.parent&&e.parent.removeChild(e))),e.visible=t},i.prototype.setVisibleRaw=function(t){var e=this.getDisplayNode();e.visible=t},i.prototype.isVisible=function(){return this.getDisplayNode().visible},i.prototype.onEnterMap=function(t){TLog.Assert(null==this.mParentLayer,"onEnterMap"),this.mParentLayer=t,this.mbInView=!1,this.mOriginalParent=null},i.prototype.onLeaveMap=function(t){TLog.Assert(null!=this.mParentLayer,"onLeaveMap"),(null==this.mParentLayer||this.mParentLayer==t)&&(this.mbInView&&(this.mbInView=!1,this.onCameraLost()),this.mParentLayer=null,this.mOriginalParent=null)},i.prototype.isEnterMap=function(){return null!=this.mParentLayer},i.prototype.getLayer=function(){return this.mParentLayer},i.prototype.setPosition=function(t,e){TLog.Assert(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e));var i=this.getDisplayNode();i.x=t,i.y=e},i.prototype.getPositionX=function(){var t=this.getDisplayNode();return t.x},i.prototype.getPositionY=function(){var t=this.getDisplayNode();return t.y},i.prototype.setPositionCellXY=function(e,i){var r=t.LogicBlock.getXFromCell(e),o=t.LogicBlock.getXFromCell(i);this.setPosition(r,o)},i.prototype.getPositionCellX=function(){return t.LogicBlock.getCellX(this.getPositionX())},i.prototype.getPositionCellY=function(){return t.LogicBlock.getCellY(this.getPositionY())},i}(core.EventSet);t.SpriteBase=e,__reflect(e.prototype,"map.SpriteBase")}(map||(map={}));var map;!function(t){function e(t){return t>7&&(t=7),0>t&&(t=0),t=4>=t?4-t:12-t}var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.report=0,this.optimizeflag=0,this.mPathMgr=t.MapManager.getInstance().getPathMgr(),this.movementEvent=t.SpriteMovEvent.newObj(),this.mmoving=!1,this.mbTickMove=!1,this.m_nAngle=-1,this.m_bDirChange=!1},r.prototype.destory=function(){this.movementEvent.deleteObj(),this.movementEvent=null},r.prototype.addReportFlag=function(t){this.report=this.report|t},r.prototype.removeReportFlag=function(t){this.report=this.report&~t},r.prototype.clearReportFlag=function(){this.report=0},r.prototype.moveTo=function(e,i,r){TLog.Assert(!isNaN(e)&&!isNaN(i)),this._DelayInitLogicPath();var o=this.getPositionX(),n=this.getPositionY(),a={x:o,y:n},s={x:e,y:i},h=this.mPathMgr.createPath(this.logicPath,a,s,this.getAngle(),1e4,r);return h==t.FindPathType.eFindPathType_Succeed?0==this.mmoving&&(this.mmoving=!0,this.report&t.MoveReportFlag.MOVEMENT_BEGIN_RUN&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_BEGIN_RUN)):h==t.FindPathType.eFindPathType_Fail&&this.mmoving&&(this.mmoving=!1,t.MoveReportFlag.MOVEMENT_STOPING&this.report&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_STOPING)),this.mbTickMove=h!=t.FindPathType.eFindPathType_Fail,this.mbTickMove},r.prototype.moveStop=function(){TLog.Assert(this.isEnterMap()),this.mbTickMove&&this.logicPath&&(this.mbTickMove=!1,this.mPathMgr.clearPath(this.logicPath)),this.mmoving&&(this.mmoving=!1,t.MoveReportFlag.MOVEMENT_STOPING&this.report&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_STOPING))},r.prototype.isMoving=function(){return this.mmoving},r.prototype.setMoveSpeed=function(t){this._DelayInitLogicPath(),this.logicPath.SetSpeed(t)},r.prototype.getMoveSpeed=function(){return this._DelayInitLogicPath(),this.logicPath.GetSpeed()},r.prototype._DelayInitLogicPath=function(){return TLog.Assert(this.isEnterMap()),null==this.logicPath&&(this.logicPath=this.mPathMgr.createLogicPath(),this.logicPath.SetSpeed(this.getMoveSpeed())),!0},r.prototype._FireMovementEvent=function(e){if(0!=e){var i={x:this.getPositionX(),y:this.getPositionY()},r={x:this.getPositionCellX(),y:this.getPositionCellY()};return this.movementEvent.actor=this,this.movementEvent.flag=e,this.movementEvent.dir=this.getDir(),this.movementEvent.pixel=i,this.movementEvent.cell=r,0!=(e&t.MoveReportFlag.MOVEMENT_BEGIN_RUN)&&0!=(this.report&t.MoveReportFlag.MOVEMENT_TRACE_PATH)&&this.logicPath,0==(e&t.MoveReportFlag.MOVEMENT_CELL_CHANGED)?void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent):this.mPathMgr.getLogicBlock().IsBlock(r)?(this.movementEvent.flag=this.movementEvent.flag&~t.MoveReportFlag.MOVEMENT_CELL_CHANGED,void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent)):void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent)}},r.prototype.setDir=function(t){this.setAngle(45*e(t))},r.prototype.getDir=function(){var t=this.getAngle(),i=22.5,r=1;return i>=t||t>=360-i?r=0:t>=i&&3*i>=t?r=1:t>=3*i&&5*i>=t?r=2:t>=5*i&&7*i>=t?r=3:t>=7*i&&9*i>=t?r=4:t>=9*i&&11*i>=t?r=5:t>=11*i&&13*i>=t?r=6:t>=13*i&&15*i>=t&&(r=7),e(r)},r.prototype.setAngle=function(t){TLog.Assert(!isNaN(t)),this.m_nAngle!=t&&(this.m_nAngle=t,this.m_bDirChange=!0)},r.prototype.getAngle=function(){return this.m_nAngle},r.prototype.setDirChange=function(){this.m_bDirChange=!0},r.prototype._UpdateMovement=function(e){if(this.isEnterMap()&&this.mbTickMove&&null!=this.logicPath){this.logicPath.UpdateTime(core.TimeStamp.DelayTime);var i=0,r={};r.bStop=!1,r.x=0,r.y=0,r.dir=0;var o=this.mPathMgr.updatePath(this.logicPath,r),n=r.bStop,a=r.dir,s={},h={};if(h.x=r.x,h.y=r.y,o==t.FindPathType.eFindPathType_Succeed)if(0==this.mmoving)this.mmoving=!0,i|=t.MoveReportFlag.MOVEMENT_BEGIN_RUN;else if(n)this.mbTickMove=!1,this.mmoving&&(this.mmoving=!1,i|=t.MoveReportFlag.MOVEMENT_STOPING);else{var l=this.getPositionX(),p=this.getPositionY(),u=this.getPositionCellX(),m=this.getPositionCellY(),c=this.getAngle();(h.x!=l||h.y!=p)&&(i|=t.MoveReportFlag.MOVEMENT_PIXEL_CHANGED,s.x=t.LogicBlock.getCellX(h.x),s.y=t.LogicBlock.getCellX(h.y),this.setPosition(h.x,h.y),(s.x!=u||s.y!=m)&&(i|=t.MoveReportFlag.MOVEMENT_CELL_CHANGED)),a!=c&&(i|=t.MoveReportFlag.MOVEMENT_DIR_CHANGED,this.setAngle(a))}else o==t.FindPathType.eFindPathType_Fail&&(this.mmoving&&(this.mmoving=!1,i|=t.MoveReportFlag.MOVEMENT_STOPING),this.mbTickMove=!1);if(i&=this.report,0!=i){if(this.isClip()&&0!=(this.optimizeflag&t.OptimizeFlag.OPTIMIZE_MOVEMENT_ONSEE)&&!(i&t.MoveReportFlag.MOVEMENT_BEGIN_RUN||i&t.MoveReportFlag.MOVEMENT_STOPING))return;this._FireMovementEvent(i)}}},r.prototype._UpdateAppearance=function(){if(!(this.isClip()&&this.optimizeflag&t.OptimizeFlag.OPTIMIZE_UPDATE_ONSEE)&&this.m_bDirChange){var e=this.getDir();this.onMoveDirChange(e)&&(this.m_bDirChange=!1)}},r.prototype.onUpdate=function(t){i.prototype.onUpdate.call(this,t),this._UpdateMovement(t),this._UpdateAppearance()},r.prototype.onMoveDirChange=function(t){return!0},r}(t.SpriteBase);t.MovableSprite=i,__reflect(i.prototype,"map.MovableSprite")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTileMap=t[0],this.mZOder=-1},e.prototype.destory=function(){},e.prototype.getTileMap=function(){return this.mTileMap},e.prototype.onUpdate=function(t){},e.prototype.setZOrder=function(t){this.mZOder=t},e.prototype.getZOrder=function(){return this.mZOder},e}(TClass);t.LayerBase=e,__reflect(e.prototype,"map.LayerBase")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mResRefCount=0,this.mLoadState=t.ModelLoadState.eUnLoaded,this.mModelName=e[0],this.mSpriteMgr=e[2],this.mUnLoadBeginTime=-1},i.prototype.destory=function(){this.unloadImp()},i.prototype.load=function(){return this.mResRefCount++,1==this.mResRefCount&&(this.isUnLoading()&&(this.mSpriteMgr.removeUnloadingResource(this),this.mUnLoadBeginTime=-1,this.mLoadState=t.ModelLoadState.eLoaded),this.isUnLoaded()&&(this.mLoadState=t.ModelLoadState.eLoading,this._loadImp())),this.mLoadState==t.ModelLoadState.eLoaded},i.prototype.unload=function(){return TLog.Assert(this.mResRefCount>0),this.mResRefCount--,0==this.mResRefCount&&(this.isLoading()?(this._cancelLoadImp(),this.mLoadState=t.ModelLoadState.eUnLoaded):(this.mLoadState=t.ModelLoadState.eUnLoading,this.mSpriteMgr.addUnloadingResource(this))),this.isUnLoaded()},i.prototype.unloadImp=function(){this._unloadImp(),this.mSpriteMgr.removeUnloadingResource(this),this.mUnLoadBeginTime=-1,this.mLoadState=t.ModelLoadState.eUnLoaded},i.prototype.isLoaded=function(){return this.mLoadState==t.ModelLoadState.eLoaded},i.prototype.isLoading=function(){return this.mLoadState==t.ModelLoadState.eLoading},i.prototype.isUnLoaded=function(){return this.mLoadState==t.ModelLoadState.eUnLoaded},i.prototype.isUnLoading=function(){return this.mLoadState==t.ModelLoadState.eUnLoading},i.prototype.notifyLoadComplete=function(){this.mLoadState=t.ModelLoadState.eLoaded},i.prototype._loadImp=function(){},i.prototype._unloadImp=function(){},i.prototype._cancelLoadImp=function(){},i}(TClass);t.SpriteResourceBase=e,__reflect(e.prototype,"map.SpriteResourceBase")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTag=-1,this.mObjectList=[],this.mAddObjectList=[],this.mRemoveObjectList=[],this.mRenderObjectList=[],this.mbUpdateLock=!1},i.prototype.destory=function(){this.clearSprite()},i.prototype.getDisplayNode=function(){return this.mDisplayNode||(this.mDisplayNode=new t.SpriteLayerDisplayerNode),this.mDisplayNode},i.prototype.setTag=function(t){this.mTag=t},i.prototype.getTag=function(){return this.mTag},i.prototype.addSprite=function(t){if(null==t)return!1;if(this.mbUpdateLock){var e=this.mRemoveObjectList.indexOf(t);return-1!=e&&(t.release(),this.mRemoveObjectList.splice(e,1)),-1!=this.mAddObjectList.indexOf(t)?!1:(t.retain(),t.onEnterMap(this),this.mAddObjectList.push(t),!0)}var e=this.mObjectList.indexOf(t);-1==e&&(t.retain(),this.mObjectList.push(t),t.isEnterMap()||t.onEnterMap(this));var i=this.mRemoveObjectList.indexOf(t);return-1!=i&&(t.release(),t.isEnterMap()||t.onEnterMap(this),this.mRemoveObjectList.splice(i,1)),!0},i.prototype.removeSprite=function(t){if(null!=t){var e=this.mAddObjectList.indexOf(t);if(-1!=e&&(t.release(),this.mAddObjectList.splice(e,1)),-1==this.mRemoveObjectList.indexOf(t))return t.retain(),t.onLeaveMap(this),this.mRemoveObjectList.push(t),!0}},i.prototype.removeSpriteImp=function(t){var e=this.mObjectList.indexOf(t);return-1!=e&&(this.mObjectList.splice(e,1),t.release()),e=this.mRenderObjectList.indexOf(t),-1!=e&&this.mRenderObjectList.splice(e,1),!0},i.prototype.clearSprite=function(){this.mAddObjectList.forEach(function(t){t.release()}),this.mAddObjectList.length=0,this.mRemoveObjectList.forEach(function(t){t.release()}),this.mRemoveObjectList.length=0,this.mObjectList.forEach(function(t){t.release()}),this.mObjectList.length=0,this.mRenderObjectList.length=0},i.prototype.onUpdate=function(t){0!=this.mObjectList.length&&(this.onUpdateSpriteList(t),this.onRenderSpriteList(t))},i.prototype.onUpdateSpriteList=function(t){this.mbUpdateLock=!0;for(var e=this.mObjectList.length,i=0;e>i;i++){var r=this.mObjectList[i];-1==this.mRemoveObjectList.indexOf(r)&&r.onUpdate(t)}if(this.mbUpdateLock=!1,this.mAddObjectList.length>0){for(var e=this.mAddObjectList.length,i=0;e>i;i++){var r=this.mAddObjectList[i];this.addSprite(r),r.release()}this.mAddObjectList.length=0}if(this.mRemoveObjectList.length>0){for(var e=this.mRemoveObjectList.length,i=0;e>i;i++){var r=this.mRemoveObjectList[i];this.removeSpriteImp(r),r.release()}this.mRemoveObjectList.length=0}},i.prototype.onRenderSpriteList=function(t){var e=this;this.mRenderObjectList.length=0,this.mObjectList.forEach(function(t){1==t.isVisible()&&0==t.isClip()&&e.mRenderObjectList.push(t)})},i}(t.LayerBase);t.SpriteLayer=e,__reflect(e.prototype,"map.SpriteLayer")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.mLayerEyeshot=new t.MapLayerEyeShot,i.mLayerType=0,i.mLayerID=0,i}return __extends(i,e),i.prototype.destory=function(){},i.prototype.getDisplayNode=function(){return this.mDisplayNode||(this.mDisplayNode=new t.MapLayerDisplayerNode),this.mDisplayNode},i.prototype.initEyeshot=function(t,e,i,r){this.mLayerEyeshot.create(this,t,e,i,r)},i.prototype.load=function(t){return this.mLayerType=t.readByte(),this.mLayerID=t.readShort(),this.mName=t.readString(),!0},i.prototype.onUpdate=function(t){t.isViewChanged()&&(this.mLayerEyeshot.changeViewportSize(t.getViewWidth(),t.getViewHeight(),!1),this.mLayerEyeshot.moveViewportCenterTo(t.getViewCenterX(),t.getViewCenterY()))},i.prototype.onEyeshotFound=function(t,e){},i.prototype.onEyeshotLost=function(t,e){},i}(t.LayerBase);t.MapLayerBase=e,__reflect(e.prototype,"map.MapLayerBase",["map.IEyeshotCallback"])}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mRootNode=new egret.DisplayObjectContainer,this.mLogicFlags=0,this.mLogicInfo={0:""},this.mSpriteMgr=t.LogicSpriteManager.getInstance(),this.mParentSprite=null,this.mChildSpriteList=[],this.mChildAddInfoList=[],this.m_bFlipX=!1,this.m_bFlipY=!1,this.mFlipXFlag=1,this.mFlipYFlag=1,this.m_bMirror=!1,this.mPersScale=1,this.mScale=1,this.mAlpha=255,this.mMaskAlpha=255,this.mRotate=0,this.mDisplayeNodeList=[],this.mBoundRect=new egret.Rectangle,this.mBoundRect.setTo(0,0,1,1),this.mBoundActionId="",this.mbBoundDirty=!1,this.mbUpdateAnimAlways=!1,this.mPartSkinInfoList=[],this.mActionAliasMap={}},i.prototype.destory=function(){this.mSpriteMgr.removeSprite(this),this.clearAllChildSprite(),this.mRootNode.parent&&this.mRootNode.parent.removeChild(this.mRootNode),this.mDisplayeNodeList=null,this.mAnimEvent&&(this.mAnimEvent.release(),this.mAnimEvent=null)},i.prototype.getBoundRect=function(){var e=this.getDisplayNode();return this.mBoundRect.x=t.FLOOR(e.x-this.mBoundRect.width/2),this.mBoundRect.y=t.FLOOR(e.y-this.mBoundRect.height),this.mBoundRect},i.prototype.loadModel=function(t){return this.changeSkin(""),this.mPartSkinInfoList.length=0,this.setLogicInfo(0,t,1),!0},i.prototype.getModelName=function(){return this.mLogicInfo[0]},i.prototype.changeAction=function(t,e){return this.setLogicInfo(1,t,2),this.setLogicInfo(3,e,8),!1},i.prototype.addAliasAction=function(t,e){this.mActionAliasMap[t]=e},i.prototype.clearAliasAction=function(){this.mActionAliasMap={}},i.prototype.getAliasAction=function(t){return this.mActionAliasMap[t]},i.prototype.getActionId=function(){return this.mLogicInfo[1]},i.prototype.getLoopCount=function(){return null!=this.mLogicInfo[3]?this.mLogicInfo[3]:-1},i.prototype.setAnimSpeed=function(t){this.setLogicInfo(2,t,4)},i.prototype.getAnimSpeed=function(){return this.mLogicInfo[2]||1},i.prototype.setPause=function(t){this.setLogicInfo(4,t,16)},i.prototype.isPause=function(){return this.mLogicInfo[4]||!1},i.prototype.setAlpha=function(t){this.mAlpha=t,this._updateAlpha()},i.prototype.setMaskAlpha=function(t){this.mMaskAlpha=t,this._updateAlpha()},i.prototype.setColor=function(t,e,i){},i.prototype.setRotate=function(t){this.mRotate=t,this._updateRotate()},i.prototype.getRotate=function(){return this.mRotate},i.prototype.setScale=function(t){this.mScale=t,this._updateScale()},i.prototype.getScale=function(){return this.mScale},i.prototype.setPersScale=function(t){this.mPersScale=t,this._updateScale()},i.prototype.getPersScale=function(){return this.mPersScale},i.prototype.setMirror=function(t){this.m_bMirror=t,this.setDirChange()},i.prototype.setFlipXY=function(t,e){this.m_bFlipX=t,this.m_bFlipY=e,this.setDirChange()},i.prototype.isFlipX=function(){return this.m_bFlipX},i.prototype.isFlipY=function(){return this.m_bFlipY},i.prototype.setParent=function(t){this.mParentSprite=t},i.prototype.getParent=function(){return this.mParentSprite},i.prototype.setBoundActionId=function(t){this.mBoundActionId=t},i.prototype.getBoundActionId=function(){return this.mBoundActionId},i.prototype.invalideBounds=function(){this.report&t.AnimReportFlag.BOUND_NOTIFY&&(this.mbBoundDirty=!0)},i.prototype.setUpdateAnimAlways=function(t){this.mbUpdateAnimAlways=t},i.prototype.isUpdateAnimAlways=function(){return this.mbUpdateAnimAlways},i.prototype.changePartSkin=function(t,e){for(var i=0;i<this.mPartSkinInfoList.length;i++){var r=this.mPartSkinInfoList[i];if(r.sloName==t)return void(r.replaceSkinPath=e)}var o={slotName:t,replaceSkinPath:e};this.mPartSkinInfoList.push(o)},i.prototype.changeSkin=function(t){this.setLogicInfo(5,t,64)},i.prototype.getSkinName=function(){return this.mLogicInfo[5]||""},i.prototype.setPositionOffset=function(t,e){},i.prototype.addChildSprite=function(t,e,i,r){if(null!=e&&e!=this){TLog.Assert(0==e.isEnterMap()&&null==e.getParent());var o={};o.slot=t,o.sprite=e,o.order=null==i?0/0:i,o.bTransform=!!r,this.mChildAddInfoList.push(o),e.setParent(this),e.retain()}},i.prototype.removeChildSprite=function(t){for(var e=!1,i=0;i<this.mChildAddInfoList.length;i++){var r=this.mChildAddInfoList[i];if(r.sprite==t){this._removeChildNode(t),this.mChildAddInfoList.splice(i,1),e=!0;break}}if(!e)for(var i=0;i<this.mChildSpriteList.length;i++){var o=this.mChildSpriteList[i];if(o==t){this._removeChildNode(t),this.mChildSpriteList.splice(i,1);break}}},i.prototype.clearAllChildSprite=function(){for(var t=0;t<this.mChildSpriteList.length;t++){var e=this.mChildSpriteList[t];this._removeChildNode(e)}this.mChildSpriteList.length=0},i.prototype.addDisplayeNode=function(e,i){if(!(null==i||0>e||e>t.SpriteDisplayNodeType.eDisplayNode_Unknown)&&JsUtil.arrayPush(this.mDisplayeNodeList,i)){var r=0;e==t.SpriteDisplayNodeType.eDisplayNode_Shadow||e==t.SpriteDisplayNodeType.eDisplayNode_UI&&(r=-1),this.mRootNode.addChildAt(i,r)}},i.prototype.removeDisplayeNode=function(t){JsUtil.arrayRemoveVal(this.mDisplayeNodeList,t)&&this.mRootNode.removeChild(t)},i.prototype.getDisplayNodeList=function(){return this.mDisplayeNodeList},i.prototype.setPosition=function(t,e){TLog.Assert(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e));var i=this.getDisplayNode();i.x=t,i.y=e,this.getParent()&&(i.y=-e)},i.prototype.getPositionX=function(){var t=this.getDisplayNode();return t.x},i.prototype.getPositionY=function(){var t=this.getDisplayNode(),e=t.y;return this.getParent()&&(e=-e),e},i.prototype._setFlags=function(t){this.mLogicFlags|=t},i.prototype._removeFlags=function(t){this.mLogicFlags&=~t},i.prototype._hasFlags=function(t){return(this.mLogicFlags&t)==t},i.prototype.setLogicInfo=function(t,e,i){this.mLogicInfo[t]=e,this._setFlags(i)},i.prototype._fireAnimEvent=function(e){if(this.report&t.AnimReportFlag.ANIM_NOTIFY){null==this.mAnimEvent&&(this.mAnimEvent=t.SpriteAnimEvent.newObj());var i=this.mAnimEvent;i.actor=this,i.actionId=this.getActionId(),i.notify=e,this.fireEvent(t.SpriteAnimEvent.AnimEvent,i)}},i.prototype._fireBoundEvent=function(){if(this.report&t.AnimReportFlag.BOUND_NOTIFY){var e=t.SpriteEvent.createObj();e.actor=this,this.fireEvent(t.SpriteEvent.BoundSizeEvent,e)}},i.prototype._updateMask=function(){var e=this.getBoundRect(),i=t.LogicBlock.getCellX(e.left),r=t.LogicBlock.getCellY(e.top),o=t.LogicBlock.getCellX(e.right),n=t.LogicBlock.getCellY(e.bottom),a=255,s=t.MapManager.getInstance().getLogicMask();s.IsMask(t.FLOOR((i+o)/2),n)&&s.IsMask(t.FLOOR((i+o)/2),t.FLOOR((r+n)/2))&&(a=128),this.setMaskAlpha(a)},i.prototype._removeChildNode=function(t){var e=t.getDisplayNode();e.parent&&e.parent.removeChild(e),t.setParent(null),t.release()},i.prototype.getDisplayNode=function(){return this.mRootNode},i.prototype.onUpdate=function(t){if(e.prototype.onUpdate.call(this,t),!this.isClip()){this._updateModel();for(var i=0;i<this.mChildSpriteList.length;i++){var r=this.mChildSpriteList[i];r.onUpdate(t)}}},i.prototype.isInCameraView=function(t){return this.mParentSprite?!this.mParentSprite.isClip():e.prototype.isInCameraView.call(this,t)},i.prototype.onCameraFound=function(){e.prototype.onCameraFound.call(this)},i.prototype.onCameraLost=function(){e.prototype.onCameraLost.call(this)},i.prototype._updateAlpha=function(){},i.prototype._updateScale=function(){},i.prototype._updateRotate=function(){},i.prototype._updateModel=function(){},i.prototype.hasActionId=function(t){return!1},i}(t.MovableSprite);t.LogicSprite=e,__reflect(e.prototype,"map.LogicSprite")}(map||(map={}));var gui;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.bg=new t.Grid9Image,this.addChild(this.bg),this.content=new eui.Label,this.addChild(this.content),this.addEventListener(t.TouchEvent.TOUCH_SHORT,this.onTouchEnd,this),this.content.textAlign="center",this.content.verticalAlign="middle",this.content.textColor=0},i.prototype.dataChanged=function(){"undefined"!=typeof this.data.content&&(this.content.text=this.data.content),"undefined"!=typeof this.data.width&&(this.width=this.data.width,this.content.width=this.data.width,this.bg.width=this.data.width),"undefined"!=typeof this.data.autoScale9Grid?this.bg.autoScale9Grid=this.data.autoScale9Grid:this.bg.autoScale9Grid=!1,"undefined"!=typeof this.data.bg?this.bg.source=this.data.bg:this.bg.source="","undefined"!=typeof this.data.height&&(this.height=this.data.height,this.bg.height=this.data.height,this.content.height=this.data.height),"undefined"!=typeof this.data.fontSize&&(this.content.size=this.data.fontSize),"undefined"!=typeof this.data.textAlign&&(this.content.textAlign=this.data.textAlign),"undefined"!=typeof this.data.textColor&&(this.content.textColor=this.data.textColor)},i.prototype.onTouchEnd=function(e){var i={};i.itemIndex=this.itemIndex,i.content=this.data.content||"",this.dispatchEventWith(t.ComboBox.onClick,!0,i)},i}(eui.ItemRenderer);t.ComboBoxItem=e,__reflect(e.prototype,"gui.ComboBoxItem")}(gui||(gui={}));var core;!function(t){var e=function(){function t(){}return t.TYPE_XML=RES.ResourceItem.TYPE_XML,t.TYPE_IMAGE=RES.ResourceItem.TYPE_IMAGE,t.TYPE_BIN=RES.ResourceItem.TYPE_BIN,t.TYPE_TEXT=RES.ResourceItem.TYPE_TEXT,t.TYPE_JSON=RES.ResourceItem.TYPE_JSON,t.TYPE_SOUND=RES.ResourceItem.TYPE_SOUND,t}();t.ResourceType=e,__reflect(e.prototype,"core.ResourceType");var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mGroupCallbackMap={},t.mItemCallbackMap={},t}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.init()},i.prototype.init=function(){this.initRES(),this.mRemotePath="",this.mRootPath="",this.mZipList={},this.mZipExpandList={},this.mbSearchZipFirst=!0,this.mResExplicitType={},this.mLangIncludePathList=[],this.mLangExcludePathList=[],this.mLanguagePath="",this.mPath2ResItem={},this.mErrorResPathMap={},this.mErrorMaxTryTimes=3,this.mLoadQueue=[],this.mLoadMaxCount=8,this.mLoadCount=0},i.prototype.destory=function(){},i.prototype.injectRESConfig=function(){var t={},e={getFile:function(e){return t[e]},addFile:function(e,i,r){i||(i=""),void 0==r&&(r=""),t[e]={name:e,type:i,url:e,root:r}},profile:function(){console.log(t)}},i=RES.ResourceItem;RES.resourceTypeSelector=function(t){var e=t.substr(t.lastIndexOf(".")+1);e&&(e=e.toLowerCase());var r;switch(e){case i.TYPE_XML:case i.TYPE_JSON:case i.TYPE_SHEET:r=e;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":r=i.TYPE_IMAGE;break;case"fnt":r=i.TYPE_FONT;break;case"txt":r=i.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":r=i.TYPE_SOUND;break;default:r=i.TYPE_BIN}return r};var r={alias:{},groups:{},resourceRoot:"",fileSystem:e};RES.native_init(),RES.config.parseConfig(r)},i.prototype.initRES=function(){RES.setMaxLoadingThread(8),this.injectRESConfig()},i.prototype.setRemotePath=function(t){this.mRemotePath=t},i.prototype.getRemotePath=function(){return this.mRemotePath},i.prototype.setRootPath=function(t){this.mRootPath=t},i.prototype.getRootPath=function(){return this.mRootPath},i.prototype.setSearchZipFirst=function(t){this.mbSearchZipFirst=t},i.prototype.setLanguagePath=function(t){this.mLanguagePath=t},i.prototype.getLanguagePath=function(){return this.mLanguagePath},i.prototype.addLanguageIncludePath=function(t){return-1==this.mLangIncludePathList.indexOf(t)?(this.mLangIncludePathList.push(t),!0):!1},i.prototype.addLanguageExcludePath=function(t){return-1==this.mLangExcludePathList.indexOf(t)?(this.mLangExcludePathList.push(t),!0):!1},i.prototype.getPathInterval=function(t){if(""==this.mLanguagePath)return t;for(var e=0,i=this.mLangExcludePathList;e<i.length;e++){var r=i[e];if(-1!=t.indexOf(r))return t}for(var o=0,n=this.mLangIncludePathList;o<n.length;o++){var r=n[o];if(-1!=t.indexOf(r))return this.mLanguagePath+t}return t},i.prototype.transfromZipObjectData=function(e,i,r){if(null!=r)switch(r){case t.ResourceType.TYPE_TEXT:return e.asText();case t.ResourceType.TYPE_BIN:return e.asArrayBuffer();case t.ResourceType.TYPE_JSON:return JsUtil.JsonDecode(e.asText())
}else{var o=i.substr(i.lastIndexOf(".")+1);if(o&&(o=o.toLowerCase()),"dat"==o||"bin"==o)return e.asArrayBuffer();if("json"==o)return JsUtil.JsonDecode(e.asText())}return e.asText()},i.prototype.loadZipRes=function(t){if(this.checkResItemCache(t,""))return!0;var e=this.mResExplicitType[t],i=this.getPathInterval(t);for(var r in this.mZipList){var o=null,n=this.mZipExpandList[r];if(n&&(o=n[i]),null==o){var a=this.mZipList[r];o=a.file(i)}if(o)return egret.$callAsync(this.onItemLoadSuccess,this,this.transfromZipObjectData(o,t,e),t,!0),!0}return!1},i.prototype.loadResAsynLocal=function(t,e,i){this._loadResAsyn(t,e,i,!1)},i.prototype.loadResAsyn=function(t,e,i){this._loadResAsyn(t,e,i,!0)},i.prototype._loadResAsyn=function(t,e,i,r){if(TLog.Assert(null!=t),t=t.replace(/\\/g,"/"),""!=this.mRootPath&&0==t.indexOf(this.mRootPath)&&(t=t.substring(this.mRootPath.length)),this.isErrorRes(t))return void egret.callLater(e.onResItemError,e,t);var o=this.mItemCallbackMap[t];if(null==o&&(o=this.mItemCallbackMap[t]=[]),-1==o.indexOf(e)&&(o.push(e),null!=i&&(this.mResExplicitType[t]=i),!this.mbSearchZipFirst||!this.loadZipRes(t)))if(RES.hasRes(t))RES.getResAsync(t,this.onItemLoadSuccess,this);else{var n=this.mRootPath+this.getPathInterval(t);if(this.checkResItemCache(t,this.mRootPath))return;r&&""!=this.mRemotePath&&(n=this.mRemotePath+n),this.mLoadQueue.push({path:n,type:i}),this.nextLoadQueue()}},i.prototype.releaseLoadThread=function(){this.mLoadCount>0&&this.mLoadCount--},i.prototype.nextLoadQueue=function(){for(;this.mLoadCount<this.mLoadMaxCount&&this.mLoadQueue.length>0;){var t=this.mLoadQueue.shift();if(null==t)break;RES.getResByUrl(t.path,this.onItemLoadSuccess,this,t.type),this.mLoadCount++}},i.prototype.destroyRes=function(t){RES.destroyRes(t,!0),this.clearResPath(t)},i.prototype.clearResPath=function(t){delete this.mPath2ResItem[t]},i.prototype.cancelResAsyn=function(t){for(var e in this.mItemCallbackMap){var i=this.mItemCallbackMap[e],r=i.indexOf(t);-1!=r&&i.splice(r,1)}},i.prototype.getRes=function(t){return RES.getRes(t)},i.prototype.setMaxThreadCount=function(t){this.mLoadMaxCount=t},i.prototype.setMaxErrorTimes=function(t){this.mErrorMaxTryTimes=t},i.prototype.clearErrorRes=function(){this.mErrorResPathMap={}},i.prototype.addZipPacket=function(e,i,r){e=e.replace(/\\/g,"/");var o=this.mZipList[e];if(o)return void(i&&i.onZipItemLoad(e,0));var n=this,a={onResItemLoad:function(t){var o=t.getKey(),a=JSZip(t.getData());if(a){if(r){var s=a.file(/.+/g);null==n.mZipExpandList[o]&&(n.mZipExpandList[o]={});for(var h=0,l=s;h<l.length;h++){var p=l[h];n.mZipExpandList[o][p.name]=p}}n.mZipList[o]=a,i&&i.onZipItemLoad(t.getKey(),0)}else i&&i.onZipItemLoad(e,-1)},onResItemError:function(t){i&&i.onZipItemLoad(t,-1)}};this.loadResAsyn(e,a,t.ResourceType.TYPE_BIN)},i.prototype.removeZipPacket=function(t){t=t.replace(/\\/g,"/"),t in this.mZipList&&delete this.mZipList[t],t in this.mZipExpandList&&delete this.mZipExpandList[t]},i.prototype.removeZipExpandCache=function(t){t in this.mZipExpandList&&delete this.mZipExpandList[t]},i.prototype.getZipPacketCount=function(){var t=0;for(var e in this.mZipList)t++;return t},i.prototype.checkResItemCache=function(t,e){var i=e+this.getPathInterval(t),r=this.mPath2ResItem[i];return null!=r?(r.retain(),egret.callLater(this.onResItemLoad,this,r),!0):!1},i.prototype.onResItemLoad=function(t){var e=t.getKey(),i=this.mItemCallbackMap[e];i&&(i.forEach(function(e){e.onResItemLoad(t)}),delete this.mItemCallbackMap[e]),delete this.mResExplicitType[e],t.release()},i.prototype.onItemLoadSuccess=function(e,i,r){if(null!=e){r=!!r;var o=i;""!=this.mRemotePath&&0==i.indexOf(this.mRemotePath)&&(i=i.substring(this.mRemotePath.length)),""!=this.mRootPath&&0==i.indexOf(this.mRootPath)&&(i=i.substring(this.mRootPath.length)),""!=this.mLanguagePath&&0==i.indexOf(this.mLanguagePath)&&(i=i.substring(this.mLanguagePath.length)),delete this.mErrorResPathMap[i];var n=this.mPath2ResItem[o];null==n&&(n=t.ResItem.createObj(i,o,e,r),this.mPath2ResItem[o]=n),n.retain(),this.onResItemLoad(n)}r||(this.releaseLoadThread(),this.nextLoadQueue())},i.prototype.isErrorRes=function(t){var e=this.mErrorResPathMap[t];return null!=e&&e>=this.mErrorMaxTryTimes?!0:!1},i.prototype.onResByUrlError=function(t,e){if(this.releaseLoadThread(),!e.__resource_manager_error__)throw console.error(e.stack),e;var i=t;""!=this.mRemotePath&&0==i.indexOf(this.mRemotePath)&&(i=i.substring(this.mRemotePath.length)),""!=this.mRootPath&&0==i.indexOf(this.mRootPath)&&(i=i.substring(this.mRootPath.length)),""!=this.mLanguagePath&&0==i.indexOf(this.mLanguagePath)&&(i=i.substring(this.mLanguagePath.length));var r=this.mErrorResPathMap[i];if(null==r&&(r=0),r+=1,this.mErrorResPathMap[i]=r,r<this.mErrorMaxTryTimes){RES.host.state[t]=0;var o=this.mResExplicitType[i];this.mLoadQueue.push({path:t,type:o}),this.nextLoadQueue()}else this.onItemLoadError(i)},i.prototype.onItemLoadError=function(t){if(0!=this.mbSearchZipFirst||!this.loadZipRes(t)){var e=this.mItemCallbackMap[t];e&&(e.forEach(function(e){e.onResItemError(t)}),delete this.mItemCallbackMap[t]),delete this.mResExplicitType[t],this.nextLoadQueue(),TLog.Error("onItemLoadError:"+t+" has failed to load")}},i}(TClass);t.ResManager=i,__reflect(i.prototype,"core.ResManager")}(core||(core={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mEffectResList=[],this.mMusicResList=[],this.mMaxEffectCacheCount=20,this.mMaxMusicCacheCount=3,this.mMusicChannel=null,this.mCurrentMusicName="",this.mLastMusicName="",this.mMusicLoop=!0,this.mSoundChannelMap={}},i.prototype.destory=function(){},i.prototype.setMaxCache=function(t,e){this.mMaxEffectCacheCount=t,this.mMaxMusicCacheCount=e},i.prototype.playSoundImp=function(t,e){if(null!=t)if(e){var i=this.mSoundChannelMap[t.hashCode];if(i)try{i.stop()}catch(r){}t.type=egret.Sound.EFFECT,this.mSoundChannelMap[t.hashCode]=t.play(0,1)}else{if(this.mMusicChannel){try{this.mMusicChannel.stop()}catch(r){}this.mMusicChannel=null}t.type=egret.Sound.MUSIC;var o=-1;0==this.mMusicLoop&&(o=1),this.mMusicChannel=t.play(0,o)}},i.prototype.playEffect=function(e){var i=this;this.mEffectResList.length>this.mMaxEffectCacheCount&&(this.mEffectResList.forEach(function(t){var e=t.getData(),r=i.mSoundChannelMap[e.hashCode];r&&(r.stop(),delete i.mSoundChannelMap[e.hashCode]),t.release()}),this.mEffectResList.length=0);for(var r=0;r<this.mEffectResList.length;r++){var o=this.mEffectResList[r];if(o.getKey()==e)return void this.playSoundImp(o.getData(),!0)}var n=this,a={onResItemLoad:function(t){var e=t.getData();t.retain(),n.mEffectResList.push(t),n.playSoundImp(e,!0)},onResItemError:function(t){}};t.ResManager.getInstance().loadResAsyn(e,a,t.ResourceType.TYPE_SOUND)},i.prototype.playMusic=function(e,i){if(this.mCurrentMusicName!=e){if(!e)return void TLog.Error("SoundManager.playMusic name == null");null==i&&(i=!0),this.mMusicLoop=i,this.mMusicResList.length>this.mMaxMusicCacheCount&&(this.mMusicResList.forEach(function(t){t.release()}),this.mMusicResList.length=0);for(var r=0;r<this.mMusicResList.length;r++){var o=this.mMusicResList[r];if(o.getKey()==e)return this.mCurrentMusicName=e,void this.playSoundImp(o.getData(),!1)}this.mLastMusicName=this.mCurrentMusicName,this.mCurrentMusicName=e,t.ResManager.getInstance().loadResAsyn(e,this,t.ResourceType.TYPE_SOUND)}},i.prototype.stop=function(){this.mMusicChannel&&(this.mMusicChannel.stop(),this.mMusicChannel=null),this.mCurrentMusicName=""},i.prototype.clear=function(){this.stop(),this.mEffectResList.length>this.mMaxEffectCacheCount&&(this.mEffectResList.forEach(function(t){var e=t.getData();e.close(),t.release()}),this.mEffectResList.length=0),this.mMusicResList.length>this.mMaxMusicCacheCount&&(this.mMusicResList.forEach(function(t){var e=t.getData();e.close(),t.release()}),this.mMusicResList.length=0)},i.prototype.onResItemLoad=function(t){t.retain(),this.mMusicResList.push(t),this.mCurrentMusicName==t.getKey()&&(this.stop(),this.playSoundImp(t.getData(),!1))},i.prototype.onResItemError=function(t){this.mCurrentMusicName=this.mLastMusicName},i}(TClass);t.SoundManager=e,__reflect(e.prototype,"core.SoundManager",["core.ResItemCallback"])}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.TextureDisposeEvent="TextureDisposeEvent",e.TextureWarnEvent="TextureWarnEvent",e}(t.EventArgs);t.TextureEvent=e,__reflect(e.prototype,"core.TextureEvent");var i=function(){function t(){}return t}();__reflect(i.prototype,"TextureRes");var r=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return __extends(o,r),o.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTextureResMap={},this.mCallbackMap={},this.mCheckTime=5e3,this.mDisposeTime=6e4,this.delayTime=0,this.mTextNodeCleanList=[],this.mTextNodeMaxCount=1e3,this.mTextNodeCleanTime=6e5,this.mTextNodeMaxCount=10,this.mTextNodeCleanTime=6e5,this.mMaxTextureMemorySize=0,this.mCheckMemoryTime=0,this.mCheckMemoryDuring=0,this.mGraphicCleanList=[]},o.prototype.destory=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.res.release()}this.mTextureResMap={}},o.prototype.setAutoDisposeTime=function(t,e){this.mCheckTime=t,this.mDisposeTime=e},o.prototype.setAutoTextAndGraphicsDispose=function(t,e,i,r){this.mTextNodeMaxCount=t,this.mTextNodeCleanTime=e,this.mGraphicMaxCount=i,this.mGraphicCleanTime=r},o.prototype.setMaxTextureMemory=function(t,e){this.mCheckMemoryTime=t,this.mMaxTextureMemorySize=e},o.prototype.loadTextureAsyn=function(e,i){e=e.replace(/\\/g,"/");var r=this.mTextureResMap[e];if(r){var o=r.res,n=o.getData();return void i.onAsynTextureSucceed(e,n,o)}var a=this.mCallbackMap[e];if(null==a&&(a=this.mCallbackMap[e]=[]),-1==a.indexOf(i)){a.push(i);var s=t.ResManager.getInstance();s.loadResAsyn(e,this,t.ResourceType.TYPE_IMAGE)}},o.prototype.cancelTextureAsyn=function(t,e){var i=this.mCallbackMap[t];if(i){var r=i.indexOf(e);-1!=r&&i.splice(r)}},o.prototype.cancelTextureAsynAll=function(t){for(var e in this.mCallbackMap)this.cancelTextureAsyn(e,t)},o.prototype.cleanUpCacheTexture=function(){this.onUpdate(!0)},o.prototype.getTextureWebGL=function(t){var e=Application.getInstance().getStageNode(),i=t.bitmapData;if(i&&null==i.webGLTexture){var r=e.$displayList.renderBuffer;if(null!=r&&null!=r.context&&null!=r.context.getWebGLTexture){var o=r.context;i.webGLTexture=o.getWebGLTexture.call(o,i)}}},o.prototype.onResItemLoad=function(t){var e=t.getKey(),r=t.getData(),o=this.mCallbackMap[e];if(o.length>0&&null!=r.bitmapData){if(null==this.mTextureResMap[e]){this.getTextureWebGL(r),t.retain();var n=new i;n.res=t,n.noUseBeginTime=-1,this.mTextureResMap[e]=n}o.forEach(function(i){i.onAsynTextureSucceed(e,r,t)}),delete this.mCallbackMap[e]}},o.prototype.onResItemError=function(t){delete this.mCallbackMap[t]},o.prototype.getTexture=function(t){var e=this.mTextureResMap[t];return e?e.res.getData():null},o.prototype.checkBitmapRefrence=function(t){var e=egret.BitmapData._displayList,i=e[t.hashCode];return i?i.length:0},o.prototype.onUpdateCleanTextAndGraphicNodeList=function(e){var i=this;if(this.mTextNodeCleanList.length>0){for(var r=[],o=0;o<this.mTextNodeCleanList.length;o++){var n=this.mTextNodeCleanList[o];if(null!=n.$texture){var a=n._beginTime_;(1==e||t.TimeStamp.CurrentTime-a>this.mTextNodeCleanTime)&&r.push(n)}else r.push(n)}r.length>0&&r.forEach(function(t){JsUtil.arrayRemoveVal(i.mTextNodeCleanList,t),t.clean()})}if(this.mGraphicCleanList.length>0){for(var r=[],s=[],o=0;o<this.mGraphicCleanList.length;o++){var h=this.mGraphicCleanList[o],l=h.$targetDisplay;if(null==l||null==l.stage){var a=h._beginTime_;(1==e||t.TimeStamp.CurrentTime-a>this.mGraphicCleanTime)&&r.push(h)}else s.push(h)}s.length>0&&s.forEach(function(t){JsUtil.arrayRemoveVal(i.mGraphicCleanList,t)}),r.length>0&&r.forEach(function(t){JsUtil.arrayRemoveVal(i.mGraphicCleanList,t),t.$renderNode&&t.$renderNode.clean()})}},o.prototype.caculateTextureMemory=function(){var t=4,e=0,i=0,r=0;for(var o in this.mTextureResMap){var n=this.mTextureResMap[o],a=n.res.getData(),s=a.$bitmapWidth*a.$bitmapHeight*t;e+=s}for(var h=0;h<this.mTextNodeCleanList.length;h++){var l=this.mTextNodeCleanList[h];if(null!=l.$texture){var p=l.$textureWidth*l.$textureHeight*t;i+=p}}for(var h=0;h<this.mGraphicCleanList.length;h++){var u=this.mGraphicCleanList[h],m=u.$renderNode;if(null!=m.$texture){var p=m.$textureWidth*m.$textureHeight*t;r+=p}}var c=e+i+r;return c},o.prototype.onUpdate=function(i){var r=this;if(void 0===i&&(i=!1),this.delayTime+=t.TimeStamp.DelayTime,1==i||this.delayTime>this.mCheckTime){var o=t.TimeStamp.CurrentTime-this.mDisposeTime,n=[];for(var a in this.mTextureResMap){var s=this.mTextureResMap[a],h=s.res.getData(),l=h.bitmapData;TLog.Assert(null!=l),0==this.checkBitmapRefrence(l)&&1==s.res.getReferenceCount()?s.noUseBeginTime<0&&(s.noUseBeginTime=t.TimeStamp.CurrentTime):s.noUseBeginTime=-1,s.noUseBeginTime>=0&&(i||s.noUseBeginTime<o)&&n.push(s)}n.length>0&&n.forEach(function(i){var o=i.res,n=o.getKey();delete r.mTextureResMap[n],o.release();var a=e.createObj();a.path=n,r.fireEvent(t.TextureEvent.TextureDisposeEvent,a)}),this.onUpdateCleanTextAndGraphicNodeList(i),this.delayTime=0}if(0==i&&this.mMaxTextureMemorySize>0&&(this.mCheckMemoryDuring+=t.TimeStamp.DelayTime,this.mCheckMemoryDuring>this.mCheckMemoryTime)){this.mCheckMemoryDuring=0;var p=this.caculateTextureMemory();if(p>this.mMaxTextureMemorySize){var u=e.createObj();this.fireEvent(t.TextureEvent.TextureWarnEvent,u)}}},o.prototype.addCleanGraphic=function(e){if(null!=e&&-1==this.mGraphicCleanList.indexOf(e)&&(e._beginTime_=t.TimeStamp.CurrentTime,this.mGraphicCleanList.push(e),this.mGraphicCleanList.length>this.mGraphicCleanTime)){for(var i=0,r=this.mGraphicCleanList;i<r.length;i++){var o=r[i],n=o.$targetDisplay;(null==n||null==n.stage)&&o.$renderNode&&o.$renderNode.clean()}this.mGraphicCleanList=[],TLog.Warn("=====auto clean:max [graphic texture] count has exceed limit: %d!",this.mGraphicMaxCount)}},o.prototype.addCleanTextNode=function(e){if(null!=e&&-1==this.mTextNodeCleanList.indexOf(e)&&(e._beginTime_=t.TimeStamp.CurrentTime,this.mTextNodeCleanList.push(e),this.mTextNodeCleanList.length>this.mTextNodeMaxCount)){for(var i=0,r=this.mTextNodeCleanList;i<r.length;i++){var o=r[i];o.clean()}this.mTextNodeCleanList=[],TLog.Warn("=====auto clean:max [text texture] count has exceed limit: %d!",this.mTextNodeMaxCount)}},o.prototype.removeCleanTextNode=function(t){if(null!=t){var e=this.mTextNodeCleanList.indexOf(t);-1!=e&&this.mTextNodeCleanList.splice(e,1)}},o}(t.EventSet);t.TextureManager=r,__reflect(r.prototype,"core.TextureManager",["core.ResItemCallback"])}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._managedObjectArray=[]},e.prototype.addObject=function(t){TLog.Assert(null!=t.retain&&null!=t.release),this._managedObjectArray.push(t)},e.prototype.clear=function(){this._managedObjectArray.length>0&&(this._managedObjectArray.forEach(function(t){t.release()}),this._managedObjectArray.length=0)},e}(TClass);t.AutoreleasePool=e,__reflect(e.prototype,"core.AutoreleasePool")}(core||(core={}));var BinaryStream=function(t){function e(e){var i=t.call(this,e)||this;return i.setNetMode(!1),i}return __extends(e,t),e.prototype.setNetMode=function(t){t?this.endian=egret.Endian.BIG_ENDIAN:this.endian=egret.Endian.LITTLE_ENDIAN},e.prototype.readString=function(){return this.readUTF()},e.prototype.readUInt=function(){return this.readUnsignedInt()},e.prototype.readUShort=function(){return this.readUnsignedShort()},e.prototype.readUChar=function(){return this.readUnsignedByte()},e.prototype.readChar=function(){return this.readByte()},e.prototype.writeString=function(t){this.writeUTF(t)},e.prototype.writeUInt=function(t){this.writeUnsignedInt(t)},e.prototype.writeUShort=function(t){this.writeUnsignedShort(t)},e.prototype.writeUChar=function(t){this.writeByte(t)},e.prototype.writeChar=function(t){this.writeByte(t)},e}(egret.ByteArray);__reflect(BinaryStream.prototype,"BinaryStream");var core;!function(t){var e=function(){function t(){this.mData={}}return t.prototype.initWithJson=function(t){TLog.Assert(null!=t);for(var e in t)this.mData[e]=t[e]},t.prototype.getString=function(t,e){var i=this.mData[t];return"string"==typeof i?i:i?i.toString():e||""},t.prototype.getNumber=function(t,e){var i=this.mData[t];if("number"==typeof i)return i;var r=Number(i).valueOf();return isNaN(r)?e||0:r},t.prototype.getBoolean=function(t,e){var i=this.mData[t];return void 0===i?!!e:!!i},t.prototype.getData=function(t,e){var i=this.mData[t];return void 0===i?e:i},t}();t.ConfigFile=e,__reflect(e.prototype,"core.ConfigFile")}(core||(core={}));var core;!function(t){var e=function(){function t(){}return t.Rectangle_setLTRB=function(t,e,i,r,o){t.left=e,t.top=i,t.right=r,t.bottom=o},t.nodeToStageXY=function(t,e,i){var r=new egret.Point,o=t.$getConcatenatedMatrix();return o.transformPoint(e,i,r),r},t.stageToNodeXY=function(t,e,i){var r=new egret.Point,o=t.$getInvertedConcatenatedMatrix();return o.transformPoint(e,i,r),r},t.hitTestRect=function(t,e,i){var r=new egret.Point,o=t.$getInvertedConcatenatedMatrix();return o.transformPoint(e,i,r),r.x>=0&&r.y>=0&&r.x<=t.width&&r.y<=t.height},t}();t.EgretUtil=e,__reflect(e.prototype,"core.EgretUtil")}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mUrl="",this.mParamMsg="",this.mbEnable=!1,this.mParamList={},this.mbSend=!1},e.prototype.destory=function(){},e.prototype.setReportUrl=function(t){this.mUrl=t},e.prototype.setUserParamMsg=function(t){this.mParamMsg=t},e.prototype.addUserParam=function(t,e){if(null!=t&&""!=t){null==e?delete this.mParamList[t]:this.mParamList[t]=e;var i="";for(var r in this.mParamList){var o=this.mParamList[r],n=r+"="+o;""!=i&&(n="&"+n),i+=n}this.setUserParamMsg(i)}},e.prototype.setReportEnable=function(t){this.mbEnable=!0},e.prototype.isReportEnable=function(){return this.mbEnable},e.prototype.captureError=function(t){if(TLog.Error(t.stack),0!=this.mbEnable&&""!=this.mUrl&&!this.mbSend){this.mbSend=!0;var e=new egret.HttpRequest;e.open(this.mUrl,egret.HttpMethod.POST),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var i=t.stack,r="";r=""==this.mParamMsg?String.format("luaError=%s",i):String.format("%s&luaError=%s",this.mParamMsg,i),e.send(r)}},e}(TClass);t.ErrorReport=e,__reflect(e.prototype,"core.ErrorReport")}(core||(core={}));var JsUtil=function(){function t(){}return t.arrayPush=function(t,e){return-1==t.indexOf(e)?(t.push(e),!0):!1},t.arrayInstert=function(t,e,i){null==i&&(i=e,e=t.length),t.splice(e,0,i)},t.arrayRemove=function(t,e){if(t.length<=0)return null;null==e&&(e=t.length-1);var i=t[e];return t.splice(e,1),i},t.arrayRemoveVal=function(t,e){var i=t.indexOf(e);return-1==i?!1:(t.splice(i,1),!0)},t.arrayExsit=function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(r==e)return!0}return!1},t.objectForEach=function(t,e){if(Array.isArray(t))for(var i=t,r=0;r<i.length;r++){var o=t[r],n=!!e(o,r);if(n)return}else for(var a in t){var o=t[a],n=!!e(o,a);if(n)return}},t.objectCopy=function(t){if(null==t)return null;if("object"!=typeof t)return t;var e=null;if(Array.isArray(t)){e=[];for(var i=0;i<t.length;i++){var r=t[i];"object"==typeof r&&null!=r?e[i]=this.objectCopy(r):e[i]=r}}else{e={};for(var i in t)if("prototype"!=i&&t.hasOwnProperty(i)){var r=t[i];"object"==typeof r&&null!=r?e[i]=this.objectCopy(r):e[i]=r}}return e},t.objectCopyEx=function(t,e){if(null==t||null==e)return!1;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=this.objectCopy(e[i]);else for(var i in e)"prototype"!=i&&e.hasOwnProperty(i)&&(t[i]=this.objectCopy(e[i]));return!0},t.objectFindIndexWithValue=function(t,e){for(var i in t){var r=t[i];if(r==e)return i}return null},t.JsonEncode=function(t){return JSON.stringify(t,null,1)},t.JsonDecode=function(t){return JSON.parse(t)},t.JsonDecodeSafeFormat=function(t){return t=t.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"),JSON.parse(t)},t.UrlEncode=function(t){return encodeURI(t)},t.UrlDecode=function(t){return decodeURI(t)},t.toString=function(t){return String(t)},t.toNumber=function(t,e){if(""==t)return e;var i=Number(t);return isNaN(i)?e:i},t.isNaN=function(t){return isNaN(t)},t.isFinite=function(t){return isFinite(t)},t.parseFloat=function(t){return parseFloat(t)},t.parseInt=function(t,e){return parseInt(t,e)},t.loadScript=function(t,e){if(egret.Capabilities.runtimeType!=egret.RuntimeType.WEB)return void TLog.Error("loadJsScript",t);var i=document.createElement("script");i.src=t;var r=null;r=function(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),e&&e()},i.addEventListener("load",r,!1),document.body.appendChild(i)},t}();__reflect(JsUtil.prototype,"JsUtil");var core;!function(t){function e(t){var e=(new i).hex_md5(t);return e}t.getMd5String=e;var i=function(){function t(){this.hexcase=0,this.b64pad=""}return t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var r=Array(16),o=Array(16),n=0;16>n;n++)r[n]=909522486^i[n],o[n]=1549556828^i[n];var a=this.binl_md5(r.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(o.concat(a),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,r=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",o="",n=0;n<t.length;n++)i=t.charCodeAt(n),o+=r.charAt(i>>>4&15)+r.charAt(15&i);return o},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",o=t.length,n=0;o>n;n+=3)for(var a=t.charCodeAt(n)<<16|(o>n+1?t.charCodeAt(n+1)<<8:0)|(o>n+2?t.charCodeAt(n+2):0),s=0;4>s;s++)r+=8*n+6*s>8*t.length?this.b64pad:i.charAt(a>>>6*(3-s)&63);return r},t.prototype.rstr2any=function(t,e){var i,r,o,n,a,s=e.length,h=Array(Math.ceil(t.length/2));for(i=0;i<h.length;i++)h[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var l=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),p=Array(l);for(r=0;l>r;r++){for(a=Array(),n=0,i=0;i<h.length;i++)n=(n<<16)+h[i],o=Math.floor(n/s),n-=o*s,(a.length>0||o>0)&&(a[a.length]=o);p[r]=n,h=a}var u="";for(i=p.length-1;i>=0;i--)u+=e.charAt(p[i]);return u},t.prototype.str2rstr_utf8=function(t){for(var e,i,r="",o=-1;++o<t.length;)e=t.charCodeAt(o),i=o+1<t.length?t.charCodeAt(o+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),o++),127>=e?r+=String.fromCharCode(e):2047>=e?r+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?r+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(r+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return r},t.prototype.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},t.prototype.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,r=-271733879,o=-1732584194,n=271733878,a=0;a<t.length;a+=16){var s=i,h=r,l=o,p=n;i=this.md5_ff(i,r,o,n,t[a+0],7,-680876936),n=this.md5_ff(n,i,r,o,t[a+1],12,-389564586),o=this.md5_ff(o,n,i,r,t[a+2],17,606105819),r=this.md5_ff(r,o,n,i,t[a+3],22,-1044525330),i=this.md5_ff(i,r,o,n,t[a+4],7,-176418897),n=this.md5_ff(n,i,r,o,t[a+5],12,1200080426),o=this.md5_ff(o,n,i,r,t[a+6],17,-1473231341),r=this.md5_ff(r,o,n,i,t[a+7],22,-45705983),i=this.md5_ff(i,r,o,n,t[a+8],7,1770035416),n=this.md5_ff(n,i,r,o,t[a+9],12,-1958414417),o=this.md5_ff(o,n,i,r,t[a+10],17,-42063),r=this.md5_ff(r,o,n,i,t[a+11],22,-1990404162),i=this.md5_ff(i,r,o,n,t[a+12],7,1804603682),n=this.md5_ff(n,i,r,o,t[a+13],12,-40341101),o=this.md5_ff(o,n,i,r,t[a+14],17,-1502002290),r=this.md5_ff(r,o,n,i,t[a+15],22,1236535329),i=this.md5_gg(i,r,o,n,t[a+1],5,-165796510),n=this.md5_gg(n,i,r,o,t[a+6],9,-1069501632),o=this.md5_gg(o,n,i,r,t[a+11],14,643717713),r=this.md5_gg(r,o,n,i,t[a+0],20,-373897302),i=this.md5_gg(i,r,o,n,t[a+5],5,-701558691),n=this.md5_gg(n,i,r,o,t[a+10],9,38016083),o=this.md5_gg(o,n,i,r,t[a+15],14,-660478335),r=this.md5_gg(r,o,n,i,t[a+4],20,-405537848),i=this.md5_gg(i,r,o,n,t[a+9],5,568446438),n=this.md5_gg(n,i,r,o,t[a+14],9,-1019803690),o=this.md5_gg(o,n,i,r,t[a+3],14,-187363961),r=this.md5_gg(r,o,n,i,t[a+8],20,1163531501),i=this.md5_gg(i,r,o,n,t[a+13],5,-1444681467),n=this.md5_gg(n,i,r,o,t[a+2],9,-51403784),o=this.md5_gg(o,n,i,r,t[a+7],14,1735328473),r=this.md5_gg(r,o,n,i,t[a+12],20,-1926607734),i=this.md5_hh(i,r,o,n,t[a+5],4,-378558),n=this.md5_hh(n,i,r,o,t[a+8],11,-2022574463),o=this.md5_hh(o,n,i,r,t[a+11],16,1839030562),r=this.md5_hh(r,o,n,i,t[a+14],23,-35309556),i=this.md5_hh(i,r,o,n,t[a+1],4,-1530992060),n=this.md5_hh(n,i,r,o,t[a+4],11,1272893353),o=this.md5_hh(o,n,i,r,t[a+7],16,-155497632),r=this.md5_hh(r,o,n,i,t[a+10],23,-1094730640),i=this.md5_hh(i,r,o,n,t[a+13],4,681279174),n=this.md5_hh(n,i,r,o,t[a+0],11,-358537222),o=this.md5_hh(o,n,i,r,t[a+3],16,-722521979),r=this.md5_hh(r,o,n,i,t[a+6],23,76029189),i=this.md5_hh(i,r,o,n,t[a+9],4,-640364487),n=this.md5_hh(n,i,r,o,t[a+12],11,-421815835),o=this.md5_hh(o,n,i,r,t[a+15],16,530742520),r=this.md5_hh(r,o,n,i,t[a+2],23,-995338651),i=this.md5_ii(i,r,o,n,t[a+0],6,-198630844),n=this.md5_ii(n,i,r,o,t[a+7],10,1126891415),o=this.md5_ii(o,n,i,r,t[a+14],15,-1416354905),r=this.md5_ii(r,o,n,i,t[a+5],21,-57434055),i=this.md5_ii(i,r,o,n,t[a+12],6,1700485571),n=this.md5_ii(n,i,r,o,t[a+3],10,-1894986606),o=this.md5_ii(o,n,i,r,t[a+10],15,-1051523),r=this.md5_ii(r,o,n,i,t[a+1],21,-2054922799),i=this.md5_ii(i,r,o,n,t[a+8],6,1873313359),n=this.md5_ii(n,i,r,o,t[a+15],10,-30611744),o=this.md5_ii(o,n,i,r,t[a+6],15,-1560198380),r=this.md5_ii(r,o,n,i,t[a+13],21,1309151649),i=this.md5_ii(i,r,o,n,t[a+4],6,-145523070),n=this.md5_ii(n,i,r,o,t[a+11],10,-1120210379),o=this.md5_ii(o,n,i,r,t[a+2],15,718787259),r=this.md5_ii(r,o,n,i,t[a+9],21,-343485551),i=this.safe_add(i,s),r=this.safe_add(r,h),o=this.safe_add(o,l),n=this.safe_add(n,p)}return[i,r,o,n]},t.prototype.md5_cmn=function(t,e,i,r,o,n){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(r,n)),o),i)},t.prototype.md5_ff=function(t,e,i,r,o,n,a){return this.md5_cmn(e&i|~e&r,t,e,o,n,a)},t.prototype.md5_gg=function(t,e,i,r,o,n,a){return this.md5_cmn(e&r|i&~r,t,e,o,n,a)},t.prototype.md5_hh=function(t,e,i,r,o,n,a){return this.md5_cmn(e^i^r,t,e,o,n,a)},t.prototype.md5_ii=function(t,e,i,r,o,n,a){return this.md5_cmn(i^(e|~r),t,e,o,n,a)},t.prototype.safe_add=function(t,e){var i=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(i>>16);return r<<16|65535&i},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(i.prototype,"md5")}(core||(core={}));var core;!function(t){function e(){return egret.getTimer()}var i=function(){function t(){}return t.DelayTime=0,t.CurrentTime=0,t.CurrentFrame=0,t}();t.TimeStamp=i,__reflect(i.prototype,"core.TimeStamp"),t.getCpuTime=e}(core||(core={}));var TLog=function(){function t(){}return t.Debug=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.s_bEnable&&console.log.apply(console,["Debug:"+t].concat(e))},t.Warn=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.s_bEnable&&console.warn.apply(console,["Warn:"+t].concat(e))},t.Error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error.apply(console,["Error:"+t].concat(e))},t.Assert=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!this.s_bEnable)return!0;if(0!==t){if(!t)throw new Error(String.format(e,i));return!0}},t.Throw=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.s_bEnable)throw new Error(String.format(t,e))},t.SetEnable=function(t){this.s_bEnable=t},t.s_bEnable=!0,t}();__reflect(TLog.prototype,"TLog");var TXML=function(){function t(){}return t.parse=function(t,e){e&&(t="<root>"+t+"</root>");var i=null;try{i=egret.XML.parse(t)}catch(r){TLog.Error("xml error:"+t),i=null}return i},t.findChild=function(t,e){for(var i=t.children.length,r=0;i>r;r++){var o=t.children[r];if(1==o.nodeType){var n=o;if(n.name==e)return n}}return null},t.queryText=function(t){for(var e=t.children.length,i=0;e>i;i++){var r=t.children[i];if(3==r.nodeType){var o=r;return o.text}}return""},t.queryIntText=function(e,i){var r=t.queryText(e),o=parseInt(r);return 1==isNaN(o)?i:o},t.queryAttribute=function(t,e,i){return null==i&&(i=""),e in t.attributes?t.attributes[e]:i},t.queryIntAttribute=function(e,i,r){var o=t.queryAttribute(e,i),n=parseInt(o);return 1==isNaN(n)?r:n},t.forEach=function(t,e){for(var i=t.children.length,r=0;i>r;r++){var o=t.children[r];1==o.nodeType&&e(o)}},t}();__reflect(TXML.prototype,"TXML");var core;!function(t){function e(t,e,i){for(var r,o,n,a=e-1,s=t[a],h=t[0],l=2654435769,p=Math.floor(6+52/(a+1)),u=0;0<p--;){for(u=u+l&4294967295,o=u>>>2&3,n=0;a>n;n++)h=t[n+1],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(u^h)+(i[3&n^o]^s),s=t[n]=t[n]+r&4294967295;h=t[0],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(u^h)+(i[3&n^o]^s),s=t[a]=t[a]+r&4294967295}}function i(t,e,i){for(var r,o,n,a=e-1,s=t[a-1],h=t[0],l=2654435769,p=Math.floor(6+52/(a+1)),u=p*l&4294967295;0!=u;){for(o=u>>>2&3,n=a;n>0;n--)s=t[n-1],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(u^h)+(i[3&n^o]^s),h=t[n]=t[n]-r&4294967295;s=t[a],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(u^h)+(i[3&n^o]^s),h=t[0]=t[0]-r&4294967295,u=u-l&4294967295}}function r(t,e,i,r){var o=null,n=0,a=i>>2;a=0==(3&i)?a:a+1,r?(o=t?new Uint32Array(t.buffer):new Uint32Array(a+1<<2),o[a]=i,n=a+1):(o=t?new Uint32Array(t.buffer):new Uint32Array(a<<2),n=a);for(var s=0;i>s;s++)o[s>>2]|=e[s]<<((3&s)<<3);return[o,n]}function o(t,e,i){var r=0,o=0,n=0;if(o=e<<2,i){if(n=t[e-1],o-7>n||n>o-4)return null;o=n}var a=new Uint8Array(o);for(r=0;o>r;r++)a[r]=t[r>>2]>>((3&r)<<3)&255;return a}function n(t,i,n){var a=new Uint8Array(32),s=r(null,t,i,1),h=s[0],l=s[1],p=r(a,n,16,0),u=p[0];p[1];e(h,l,u);var m=o(h,l,0);return m}function a(t,e,n){var a=new Uint8Array(32),s=r(null,t,e,0),h=s[0],l=s[1],p=r(a,n,16,0),u=p[0];p[1];i(h,l,u);var m=o(h,l,1);return m}new Uint32Array(1);t.xxteaEncrypt=n,t.xxteaDecrypt=a}(core||(core={}));var gui;!function(t){function e(e){if(null==t.ColorTable&&i(),e in t.ColorNameIndexMap){var r=t.ColorNameIndexMap[e];return t.ColorTable[r]}return TLog.Error("GetColorFromName can not get color %s error",e),0
}function i(){t.ColorTable=[],t.ColorNameIndexMap={},t.ColorTable[0]=r.aliceblue,t.ColorTable[1]=r.antiquewhite,t.ColorTable[2]=r.aqua,t.ColorTable[3]=r.aquamarine,t.ColorTable[4]=r.azure,t.ColorTable[5]=r.beige,t.ColorTable[6]=r.bisque,t.ColorTable[7]=r.black,t.ColorTable[8]=r.blanchedalmond,t.ColorTable[9]=r.blue,t.ColorTable[10]=r.blueviolet,t.ColorTable[11]=r.brown,t.ColorTable[12]=r.burlywood,t.ColorTable[13]=r.cadetblue,t.ColorTable[14]=r.chartreuse,t.ColorTable[15]=r.chocolate,t.ColorTable[16]=r.coral,t.ColorTable[17]=r.cornflowerblue,t.ColorTable[18]=r.cornsilk,t.ColorTable[19]=r.crimson,t.ColorTable[20]=r.cyan,t.ColorTable[21]=r.darkblue,t.ColorTable[22]=r.darkcyan,t.ColorTable[23]=r.darkgoldenrod,t.ColorTable[24]=r.darkgray,t.ColorTable[25]=r.darkgreen,t.ColorTable[26]=r.darkkhaki,t.ColorTable[27]=r.darkmagenta,t.ColorTable[28]=r.darkolivegreen,t.ColorTable[29]=r.darkorange,t.ColorTable[30]=r.darkorchid,t.ColorTable[31]=r.darkred,t.ColorTable[32]=r.darksalmon,t.ColorTable[33]=r.darkseagreen,t.ColorTable[34]=r.darkslateblue,t.ColorTable[35]=r.darkslategray,t.ColorTable[36]=r.darkturquoise,t.ColorTable[37]=r.darkviolet,t.ColorTable[38]=r.deeppink,t.ColorTable[39]=r.deepskyblue,t.ColorTable[40]=r.dimgray,t.ColorTable[41]=r.dodgerblue,t.ColorTable[42]=r.firebrick,t.ColorTable[43]=r.floralwhite,t.ColorTable[44]=r.forestgreen,t.ColorTable[45]=r.fuchsia,t.ColorTable[46]=r.gainsboro,t.ColorTable[47]=r.ghostwhite,t.ColorTable[48]=r.gold,t.ColorTable[49]=r.goldenrod,t.ColorTable[50]=r.gray,t.ColorTable[51]=r.green,t.ColorTable[52]=r.greenyellow,t.ColorTable[53]=r.honeydew,t.ColorTable[54]=r.hotpink,t.ColorTable[55]=r.indianred,t.ColorTable[56]=r.indigo,t.ColorTable[57]=r.ivory,t.ColorTable[58]=r.khaki,t.ColorTable[59]=r.lavender,t.ColorTable[60]=r.lavenderblush,t.ColorTable[61]=r.lawngreen,t.ColorTable[62]=r.lemonchiffon,t.ColorTable[63]=r.lightblue,t.ColorTable[64]=r.lightcoral,t.ColorTable[65]=r.lightcyan,t.ColorTable[66]=r.lightgoldenrodyellow,t.ColorTable[67]=r.lightgreen,t.ColorTable[68]=r.lightgrey,t.ColorTable[69]=r.lightpink,t.ColorTable[70]=r.lightsalmon,t.ColorTable[71]=r.lightseagreen,t.ColorTable[72]=r.lightskyblue,t.ColorTable[73]=r.lightslategray,t.ColorTable[74]=r.lightsteelblue,t.ColorTable[75]=r.lightyellow,t.ColorTable[76]=r.lime,t.ColorTable[77]=r.limegreen,t.ColorTable[78]=r.linen,t.ColorTable[79]=r.magenta,t.ColorTable[80]=r.maroon,t.ColorTable[81]=r.mediumaquamarine,t.ColorTable[82]=r.mediumblue,t.ColorTable[83]=r.mediumorchid,t.ColorTable[84]=r.mediumpurple,t.ColorTable[85]=r.mediumseagreen,t.ColorTable[86]=r.mediumslateblue,t.ColorTable[87]=r.mediumspringgreen,t.ColorTable[88]=r.mediumturquoise,t.ColorTable[89]=r.mediumvioletred,t.ColorTable[90]=r.midnightblue,t.ColorTable[91]=r.mintcream,t.ColorTable[92]=r.mistyrose,t.ColorTable[93]=r.moccasin,t.ColorTable[94]=r.navajowhite,t.ColorTable[95]=r.navy,t.ColorTable[96]=r.oldlace,t.ColorTable[97]=r.olive,t.ColorTable[98]=r.olivedrab,t.ColorTable[99]=r.orange,t.ColorTable[100]=r.orangered,t.ColorTable[101]=r.orchid,t.ColorTable[102]=r.palegoldenrod,t.ColorTable[103]=r.palegreen,t.ColorTable[104]=r.paleturquoise,t.ColorTable[105]=r.palevioletred,t.ColorTable[106]=r.papayawhip,t.ColorTable[107]=r.peachpuff,t.ColorTable[108]=r.peru,t.ColorTable[109]=r.pink,t.ColorTable[110]=r.plum,t.ColorTable[111]=r.powderblue,t.ColorTable[112]=r.purple,t.ColorTable[113]=r.red,t.ColorTable[114]=r.rosybrown,t.ColorTable[115]=r.royalblue,t.ColorTable[116]=r.saddlebrown,t.ColorTable[117]=r.salmon,t.ColorTable[118]=r.sandybrown,t.ColorTable[119]=r.seagreen,t.ColorTable[120]=r.seashell,t.ColorTable[121]=r.sienna,t.ColorTable[122]=r.silver,t.ColorTable[123]=r.skyblue,t.ColorTable[124]=r.slateblue,t.ColorTable[125]=r.slategray,t.ColorTable[126]=r.snow,t.ColorTable[127]=r.springgreen,t.ColorTable[128]=r.steelblue,t.ColorTable[129]=r.tan,t.ColorTable[130]=r.teal,t.ColorTable[131]=r.thistle,t.ColorTable[132]=r.tomato,t.ColorTable[133]=r.turquoise,t.ColorTable[134]=r.violet,t.ColorTable[135]=r.wheat,t.ColorTable[136]=r.white,t.ColorTable[137]=r.whitesmoke,t.ColorTable[138]=r.yellow,t.ColorTable[139]=r.yellowgreen,t.ColorTable[140]=r.zongse,t.ColorTable[141]=r.zongse02,t.ColorTable[142]=r.rouse,t.ColorTable[143]=r.rouse02,t.ColorTable[144]=r.lvse,t.ColorTable[145]=r.hongse,t.ColorTable[146]=r.lvse02,t.ColorTable[147]=r.ublack,t.ColorNameIndexMap.aliceblue=0,t.ColorNameIndexMap.antiquewhite=1,t.ColorNameIndexMap.aqua=2,t.ColorNameIndexMap.aquamarine=3,t.ColorNameIndexMap.azure=4,t.ColorNameIndexMap.beige=5,t.ColorNameIndexMap.bisque=6,t.ColorNameIndexMap.black=7,t.ColorNameIndexMap.blanchedalmond=8,t.ColorNameIndexMap.blue=9,t.ColorNameIndexMap.blueviolet=10,t.ColorNameIndexMap.brown=11,t.ColorNameIndexMap.burlywood=12,t.ColorNameIndexMap.cadetblue=13,t.ColorNameIndexMap.chartreuse=14,t.ColorNameIndexMap.chocolate=15,t.ColorNameIndexMap.coral=16,t.ColorNameIndexMap.cornflowerblue=17,t.ColorNameIndexMap.cornsilk=18,t.ColorNameIndexMap.crimson=19,t.ColorNameIndexMap.cyan=20,t.ColorNameIndexMap.darkblue=21,t.ColorNameIndexMap.darkcyan=22,t.ColorNameIndexMap.darkgoldenrod=23,t.ColorNameIndexMap.darkgray=24,t.ColorNameIndexMap.darkgreen=25,t.ColorNameIndexMap.darkkhaki=26,t.ColorNameIndexMap.darkmagenta=27,t.ColorNameIndexMap.darkolivegreen=28,t.ColorNameIndexMap.darkorange=29,t.ColorNameIndexMap.darkorchid=30,t.ColorNameIndexMap.darkred=31,t.ColorNameIndexMap.darksalmon=32,t.ColorNameIndexMap.darkseagreen=33,t.ColorNameIndexMap.darkslateblue=34,t.ColorNameIndexMap.darkslategray=35,t.ColorNameIndexMap.darkturquoise=36,t.ColorNameIndexMap.darkviolet=37,t.ColorNameIndexMap.deeppink=38,t.ColorNameIndexMap.deepskyblue=39,t.ColorNameIndexMap.dimgray=40,t.ColorNameIndexMap.dodgerblue=41,t.ColorNameIndexMap.firebrick=42,t.ColorNameIndexMap.floralwhite=43,t.ColorNameIndexMap.forestgreen=44,t.ColorNameIndexMap.fuchsia=45,t.ColorNameIndexMap.gainsboro=46,t.ColorNameIndexMap.ghostwhite=47,t.ColorNameIndexMap.gold=48,t.ColorNameIndexMap.goldenrod=49,t.ColorNameIndexMap.gray=50,t.ColorNameIndexMap.green=51,t.ColorNameIndexMap.greenyellow=52,t.ColorNameIndexMap.honeydew=53,t.ColorNameIndexMap.hotpink=54,t.ColorNameIndexMap.indianred=55,t.ColorNameIndexMap.indigo=56,t.ColorNameIndexMap.ivory=57,t.ColorNameIndexMap.khaki=58,t.ColorNameIndexMap.lavender=59,t.ColorNameIndexMap.lavenderblush=60,t.ColorNameIndexMap.lawngreen=61,t.ColorNameIndexMap.lemonchiffon=62,t.ColorNameIndexMap.lightblue=63,t.ColorNameIndexMap.lightcoral=64,t.ColorNameIndexMap.lightcyan=65,t.ColorNameIndexMap.lightgoldenrodyellow=66,t.ColorNameIndexMap.lightgreen=67,t.ColorNameIndexMap.lightgrey=68,t.ColorNameIndexMap.lightpink=69,t.ColorNameIndexMap.lightsalmon=70,t.ColorNameIndexMap.lightseagreen=71,t.ColorNameIndexMap.lightskyblue=72,t.ColorNameIndexMap.lightslategray=73,t.ColorNameIndexMap.lightsteelblue=74,t.ColorNameIndexMap.lightyellow=75,t.ColorNameIndexMap.lime=76,t.ColorNameIndexMap.limegreen=77,t.ColorNameIndexMap.linen=78,t.ColorNameIndexMap.magenta=79,t.ColorNameIndexMap.maroon=80,t.ColorNameIndexMap.mediumaquamarine=81,t.ColorNameIndexMap.mediumblue=82,t.ColorNameIndexMap.mediumorchid=83,t.ColorNameIndexMap.mediumpurple=84,t.ColorNameIndexMap.mediumseagreen=85,t.ColorNameIndexMap.mediumslateblue=86,t.ColorNameIndexMap.mediumspringgreen=87,t.ColorNameIndexMap.mediumturquoise=88,t.ColorNameIndexMap.mediumvioletred=89,t.ColorNameIndexMap.midnightblue=90,t.ColorNameIndexMap.mintcream=91,t.ColorNameIndexMap.mistyrose=92,t.ColorNameIndexMap.moccasin=93,t.ColorNameIndexMap.navajowhite=94,t.ColorNameIndexMap.navy=95,t.ColorNameIndexMap.oldlace=96,t.ColorNameIndexMap.olive=97,t.ColorNameIndexMap.olivedrab=98,t.ColorNameIndexMap.orange=99,t.ColorNameIndexMap.orangered=100,t.ColorNameIndexMap.orchid=101,t.ColorNameIndexMap.palegoldenrod=102,t.ColorNameIndexMap.palegreen=103,t.ColorNameIndexMap.paleturquoise=104,t.ColorNameIndexMap.palevioletred=105,t.ColorNameIndexMap.papayawhip=106,t.ColorNameIndexMap.peachpuff=107,t.ColorNameIndexMap.peru=108,t.ColorNameIndexMap.pink=109,t.ColorNameIndexMap.plum=110,t.ColorNameIndexMap.powderblue=111,t.ColorNameIndexMap.purple=112,t.ColorNameIndexMap.red=113,t.ColorNameIndexMap.rosybrown=114,t.ColorNameIndexMap.royalblue=115,t.ColorNameIndexMap.saddlebrown=116,t.ColorNameIndexMap.salmon=117,t.ColorNameIndexMap.sandybrown=118,t.ColorNameIndexMap.seagreen=119,t.ColorNameIndexMap.seashell=120,t.ColorNameIndexMap.sienna=121,t.ColorNameIndexMap.silver=122,t.ColorNameIndexMap.skyblue=123,t.ColorNameIndexMap.slateblue=124,t.ColorNameIndexMap.slategray=125,t.ColorNameIndexMap.snow=126,t.ColorNameIndexMap.springgreen=127,t.ColorNameIndexMap.steelblue=128,t.ColorNameIndexMap.tan=129,t.ColorNameIndexMap.teal=130,t.ColorNameIndexMap.thistle=131,t.ColorNameIndexMap.tomato=132,t.ColorNameIndexMap.turquoise=133,t.ColorNameIndexMap.violet=134,t.ColorNameIndexMap.wheat=135,t.ColorNameIndexMap.white=136,t.ColorNameIndexMap.whitesmoke=137,t.ColorNameIndexMap.yellow=138,t.ColorNameIndexMap.yellowgreen=139,t.ColorNameIndexMap.zongse=140,t.ColorNameIndexMap.zongse02=141,t.ColorNameIndexMap.rouse=142,t.ColorNameIndexMap.rouse02=143,t.ColorNameIndexMap.lvse=144,t.ColorNameIndexMap.hongse=145,t.ColorNameIndexMap.lvse02=146,t.ColorNameIndexMap.ublack=147}var r;!function(t){t[t.aliceblue=15792383]="aliceblue",t[t.antiquewhite=16444375]="antiquewhite",t[t.aqua=65535]="aqua",t[t.aquamarine=8388564]="aquamarine",t[t.azure=15794175]="azure",t[t.beige=16119260]="beige",t[t.bisque=16770244]="bisque",t[t.black=0]="black",t[t.blanchedalmond=16772045]="blanchedalmond",t[t.blue=255]="blue",t[t.blueviolet=9055202]="blueviolet",t[t.brown=10824234]="brown",t[t.burlywood=14596231]="burlywood",t[t.cadetblue=6266528]="cadetblue",t[t.chartreuse=8388352]="chartreuse",t[t.chocolate=13789470]="chocolate",t[t.coral=16744272]="coral",t[t.cornflowerblue=6591981]="cornflowerblue",t[t.cornsilk=16775388]="cornsilk",t[t.crimson=14423100]="crimson",t[t.cyan=65535]="cyan",t[t.darkblue=139]="darkblue",t[t.darkcyan=35723]="darkcyan",t[t.darkgoldenrod=12092939]="darkgoldenrod",t[t.darkgray=11119017]="darkgray",t[t.darkgreen=25600]="darkgreen",t[t.darkkhaki=12433259]="darkkhaki",t[t.darkmagenta=9109643]="darkmagenta",t[t.darkolivegreen=5597999]="darkolivegreen",t[t.darkorange=16747520]="darkorange",t[t.darkorchid=10040012]="darkorchid",t[t.darkred=9109504]="darkred",t[t.darksalmon=15308410]="darksalmon",t[t.darkseagreen=9419915]="darkseagreen",t[t.darkslateblue=4734347]="darkslateblue",t[t.darkslategray=3100495]="darkslategray",t[t.darkturquoise=52945]="darkturquoise",t[t.darkviolet=9699539]="darkviolet",t[t.deeppink=16716947]="deeppink",t[t.deepskyblue=49151]="deepskyblue",t[t.dimgray=6908265]="dimgray",t[t.dodgerblue=2003199]="dodgerblue",t[t.firebrick=11674146]="firebrick",t[t.floralwhite=16775920]="floralwhite",t[t.forestgreen=2263842]="forestgreen",t[t.fuchsia=16711935]="fuchsia",t[t.gainsboro=14474460]="gainsboro",t[t.ghostwhite=16316671]="ghostwhite",t[t.gold=16766720]="gold",t[t.goldenrod=14329120]="goldenrod",t[t.gray=8421504]="gray",t[t.green=32768]="green",t[t.greenyellow=11403055]="greenyellow",t[t.honeydew=15794160]="honeydew",t[t.hotpink=16738740]="hotpink",t[t.indianred=13458524]="indianred",t[t.indigo=4915330]="indigo",t[t.ivory=16777200]="ivory",t[t.khaki=15787660]="khaki",t[t.lavender=15132410]="lavender",t[t.lavenderblush=16773365]="lavenderblush",t[t.lawngreen=8190976]="lawngreen",t[t.lemonchiffon=16775885]="lemonchiffon",t[t.lightblue=11393254]="lightblue",t[t.lightcoral=15761536]="lightcoral",t[t.lightcyan=14745599]="lightcyan",t[t.lightgoldenrodyellow=16448210]="lightgoldenrodyellow",t[t.lightgreen=9498256]="lightgreen",t[t.lightgrey=13882323]="lightgrey",t[t.lightpink=16758465]="lightpink",t[t.lightsalmon=16752762]="lightsalmon",t[t.lightseagreen=2142890]="lightseagreen",t[t.lightskyblue=8900346]="lightskyblue",t[t.lightslategray=7833753]="lightslategray",t[t.lightsteelblue=11584734]="lightsteelblue",t[t.lightyellow=16777184]="lightyellow",t[t.lime=65280]="lime",t[t.limegreen=3329330]="limegreen",t[t.linen=16445670]="linen",t[t.magenta=16711935]="magenta",t[t.maroon=8388608]="maroon",t[t.mediumaquamarine=6737322]="mediumaquamarine",t[t.mediumblue=205]="mediumblue",t[t.mediumorchid=12211667]="mediumorchid",t[t.mediumpurple=9662683]="mediumpurple",t[t.mediumseagreen=3978097]="mediumseagreen",t[t.mediumslateblue=8087790]="mediumslateblue",t[t.mediumspringgreen=64154]="mediumspringgreen",t[t.mediumturquoise=4772300]="mediumturquoise",t[t.mediumvioletred=13047173]="mediumvioletred",t[t.midnightblue=1644912]="midnightblue",t[t.mintcream=16121850]="mintcream",t[t.mistyrose=16770273]="mistyrose",t[t.moccasin=16770229]="moccasin",t[t.navajowhite=16768685]="navajowhite",t[t.navy=128]="navy",t[t.oldlace=16643558]="oldlace",t[t.olive=8421376]="olive",t[t.olivedrab=7048739]="olivedrab",t[t.orange=16753920]="orange",t[t.orangered=16729344]="orangered",t[t.orchid=14315734]="orchid",t[t.palegoldenrod=15657130]="palegoldenrod",t[t.palegreen=10025880]="palegreen",t[t.paleturquoise=11529966]="paleturquoise",t[t.palevioletred=14381203]="palevioletred",t[t.papayawhip=16773077]="papayawhip",t[t.peachpuff=16767673]="peachpuff",t[t.peru=13468991]="peru",t[t.pink=16761035]="pink",t[t.plum=14524637]="plum",t[t.powderblue=11591910]="powderblue",t[t.purple=8388736]="purple",t[t.red=16711680]="red",t[t.rosybrown=12357519]="rosybrown",t[t.royalblue=4286945]="royalblue",t[t.saddlebrown=9127187]="saddlebrown",t[t.salmon=16416882]="salmon",t[t.sandybrown=16032864]="sandybrown",t[t.seagreen=3050327]="seagreen",t[t.seashell=16774638]="seashell",t[t.sienna=10506797]="sienna",t[t.silver=12632256]="silver",t[t.skyblue=8900331]="skyblue",t[t.slateblue=6970061]="slateblue",t[t.slategray=7372944]="slategray",t[t.snow=16775930]="snow",t[t.springgreen=65407]="springgreen",t[t.steelblue=4620980]="steelblue",t[t.tan=13808780]="tan",t[t.teal=32896]="teal",t[t.thistle=14204888]="thistle",t[t.tomato=16737095]="tomato",t[t.turquoise=4251856]="turquoise",t[t.violet=15631086]="violet",t[t.wheat=16113331]="wheat",t[t.white=16777215]="white",t[t.whitesmoke=16119285]="whitesmoke",t[t.yellow=16776960]="yellow",t[t.yellowgreen=10145074]="yellowgreen",t[t.ublack=4535083]="ublack",t[t.zongse=4530441]="zongse",t[t.zongse02=4535083]="zongse02",t[t.rouse=15190421]="rouse",t[t.rouse02=16703170]="rouse02",t[t.lvse=14151544]="lvse",t[t.hongse=16658223]="hongse",t[t.lvse02=107265]="lvse02"}(r=t.Color||(t.Color={})),t.GetColorFromName=e,t.InitColorTable=i}(gui||(gui={}));var gui;!function(t){function e(t){var e=0;return"LEFT"==t?e|=o.LEFT:"LEFT"==t?e|=o.LEFT:"RIGHT"==t?e|=o.RIGHT:"TOP"==t?e|=o.TOP:"BOTTOM"==t?e|=o.BOTTOM:"V_CENTER"==t?e|=o.V_CENTER:"H_CENTER"==t?e|=o.H_CENTER:"V_REVERSE"==t?e|=o.V_REVERSE:"H_REVERSE"==t&&(e|=o.H_REVERSE),e}function i(t,e){if(e){var i=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(i);t.filters=[r]}else t.filters=null}var r=function(){function t(){}return t.TOUCH_LONG="LongTouchEvent",t.TOUCH_SHORT="ShortTouchEvent",t}();t.TouchEvent=r,__reflect(r.prototype,"gui.TouchEvent");var o;!function(t){t[t.LEFT=0]="LEFT",t[t.H_CENTER=1]="H_CENTER",t[t.RIGHT=2]="RIGHT",t[t.TOP=0]="TOP",t[t.V_CENTER=4]="V_CENTER",t[t.BOTTOM=8]="BOTTOM",t[t.LEFT_TOP=0]="LEFT_TOP",t[t.LEFT_CENTER=4]="LEFT_CENTER",t[t.LEFT_BOTTOM=8]="LEFT_BOTTOM",t[t.CENTER_TOP=1]="CENTER_TOP",t[t.CENTER_CENTER=5]="CENTER_CENTER",t[t.CENTER_BOTTOM=9]="CENTER_BOTTOM",t[t.RIGHT_TOP=2]="RIGHT_TOP",t[t.RIGHT_CENTER=6]="RIGHT_CENTER",t[t.RIGHT_BOTTOM=10]="RIGHT_BOTTOM",t[t.V_REVERSE=16]="V_REVERSE",t[t.H_REVERSE=32]="H_REVERSE"}(o=t.Flag||(t.Flag={}));var n;!function(t){t[t.BOLD=65536]="BOLD",t[t.ITALIC=131072]="ITALIC",t[t.UNDER_LINE=262144]="UNDER_LINE",t[t.FREE_TYPE_ALL=983040]="FREE_TYPE_ALL",t[t.SHADOW=1048576]="SHADOW",t[t.STROKE=2097152]="STROKE"}(n=t.FontFlag||(t.FontFlag={})),t.GetFlagFromName=e,t.GrayComponent=i}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(e,i){var r=t.call(this,e)||this;return r.window=i,r}return __extends(e,t),e}(egret.Event);t.GUIEvent=e,__reflect(e.prototype,"gui.GUIEvent");var i=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.link="",r}return __extends(e,t),e.prototype.getHyperlink=function(){return this.link},e.prototype.setHyperlink=function(t){this.link=t},e}(e);t.GUIHyperlinkEvent=i,__reflect(i.prototype,"gui.GUIHyperlinkEvent");var r=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.word="",r}return __extends(e,t),e.prototype.getTranslateWord=function(){return this.word},e.prototype.setTranslateWord=function(t){this.word=t},e}(e);t.GUITranslateWordEvent=r,__reflect(r.prototype,"gui.GUITranslateWordEvent");var o=function(t){function e(e,i){var r=t.call(this,e)||this;return r.handler=0,r.hoverTarget=i,r.showDriveTarget=null,r.userData=null,r}return __extends(e,t),e.prototype.setDriveBegin=function(t){t&&this.handler++},e.prototype.isDriveBegin=function(){return this.handler>0},e.prototype.setDriveOffXY=function(t,e){this.driveOffStageX=t,this.driveOffStageY=e},e.prototype.setShowDriveTarget=function(t){this.showDriveTarget=t},e.prototype.setUserData=function(t){this.userData=t},e.BeginDriveEvent="BeginDriveEvent",e.EndDriveEvent="EndDriveEvent",e}(egret.TouchEvent);t.GUIDriveEvent=o,__reflect(o.prototype,"gui.GUIDriveEvent")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTickList=[],this.mTouchTarget=null,this.mTouchId=-1,this.mTouchBeginTime=-1,this.mbFireLongTouch=!1,this.mbTouchMove=!1,this.mDriveTargetSaveData=null,this.mbTouchDown=!1,this.mbInputEnableDelay=!0,this.mbInputEnable=this.mbInputEnableDelay,this.mDefaultFont=""},i.prototype.init=function(e,i){this.mStage=i,this.mUIRootNode=new egret.DisplayObjectContainer,this.mUIRootNode.name="UIRootNode",e.addChild(this.mUIRootNode),this.mBottomLayer=new eui.UILayer,this.mNormalLayer=new eui.UILayer,this.mModalLayer=new t.ModalLayer,this.mTopLayer=new eui.UILayer,this.mBottomLayer.name="BottomLayer",this.mBottomLayer.touchEnabled=!1,this.mNormalLayer.touchEnabled=!1,this.mNormalLayer.name="NormalLayer",this.mTopLayer.touchEnabled=!1,this.mTopLayer.name="TopLayer",this.mModalLayer.name="ModalLayer",this.mUIRootNode.addChild(this.mBottomLayer),this.mUIRootNode.addChild(this.mNormalLayer),this.mUIRootNode.addChild(this.mModalLayer),this.mUIRootNode.addChild(this.mTopLayer),egret.registerImplementation("eui.IAssetAdapter",new t.AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new t.ThemeAdapter),this.initGuiTouchEvent(),this.mDriveDisplayerObject=new egret.DisplayObjectContainer},i.prototype.loadTheme=function(t,e,i){var r=new eui.Theme(t,this.mStage);r.addEventListener(eui.UIEvent.COMPLETE,function(r){e.call(i,t)},this)},i.prototype.parseLayoutString=function(t){var e=t.trim();if("<"==e.charAt(0)){var i=EXML.parse(e),r=new i;return r}return null},i.prototype.loadLayoutAsyn=function(t,e,i){function r(t,r){n++,n==o&&egret.callLater(e,i)}for(var o=t.length,n=0,a=0;o>a;a++)EXML.load(t[a],r,this,!0)},i.prototype.setDefaultFontName=function(t){this.mDefaultFont=t},i.prototype.getDefaultFontName=function(){return this.mDefaultFont},i.prototype.isRootNode=function(t){return-1==this.mUIRootNode.getChildIndex(t)?!1:!0},i.prototype.setNodeLayer=function(t,e){if(null!=t){var i=this.getLayerNode(e);i.addChild(t)}},i.prototype.getLayerNode=function(t){if(null==t)return this.mNormalLayer;var e=this.mNormalLayer;switch(t){case 0:e=this.mBottomLayer;break;case 1:e=this.mNormalLayer;break;case 3:e=this.mTopLayer;break;case 2:e=this.mModalLayer}return e},i.prototype.addTickCallback=function(t){var e=this.mTickList.indexOf(t);0>e&&this.mTickList.push(t)},i.prototype.removeTickCallback=function(t){var e=this.mTickList.indexOf(t);e>=0&&this.mTickList.splice(e,1)},i.prototype.onUpdate=function(){for(var t=0;t<this.mTickList.length;t++){var e=this.mTickList[t];e.onTick()}if(this.mTouchBeginTime>0&&0==this.mbFireLongTouch){var i=core.getCpuTime();i-this.mTouchBeginTime>=200&&this.onLongTouchEvent()}},i.prototype.setUIVisible=function(t){this.mUIRootNode.visible=t},i.prototype.isUIVisible=function(){return this.mUIRootNode.visible},i.prototype.getPathFromChild=function(t){if(0==this.mUIRootNode.contains(t))return"";if(this.mUIRootNode.getChildIndex(t)>0)return"";for(var e=t,i=[];e&&(i.push(e),e=e.parent,!(this.mUIRootNode.getChildIndex(e)>=0)););var r="";if(i.length>0){for(var o=[],n=i.length-1;n>=0;n--){var a=i[n];o.push(a.name)}r=o.join("/")}return r},i.prototype.getChildFromPathImp=function(t,e){for(var i=t,r=0,o=0,n=e;o<n.length;o++){var a=n[o],s=i.getChildByName(a);if(null==s)return null;if(r++,i=s,!(i instanceof egret.DisplayObjectContainer))break}return r!=e.length?null:i},i.prototype.getChildFromPath=function(t){if(!t)return null;var e=t.split("/");if(0==e.length)return null;var i=this.getChildFromPathImp(this.mTopLayer,e);return null!=i?i:(i=this.getChildFromPathImp(this.mModalLayer,e),null!=i?i:(i=this.getChildFromPathImp(this.mNormalLayer,e),null!=i?i:(i=this.getChildFromPathImp(this.mBottomLayer,e),null!=i?i:null)))},i.prototype.setInputEnable=function(t){this.mbTouchDown&&0==t?(this.mbInputEnableDelay=!1,this.mbInputEnable=!0):(this.mbInputEnable=t,this.mbInputEnableDelay=t)},i.prototype.isInputEnable=function(){return this.mbInputEnable},i.prototype.startDriveTouch=function(){var e=new t.GUIDriveEvent(t.GUIDriveEvent.BeginDriveEvent,this.mTouchTarget);if(e.$initTo(this.mTouchX,this.mTouchY,this.mTouchId),this.mTouchTarget.dispatchEvent(e),e.isDriveBegin()){var i=this.mTouchTarget;null!=e.showDriveTarget&&(i=e.showDriveTarget);var r=i.parent.getChildIndex(i);this.mDriveTargetSaveData={target:this.mTouchTarget,parent:i.parent,x:i.x,y:i.y,showTarget:i,userData:e.userData,childIndex:r},TLog.Assert(null!=this.mDriveTargetSaveData.parent&&null==this.mDriveDisplayerObject.parent);var o=core.EgretUtil.nodeToStageXY(i,0,0),n=10;this.mDriveOffsetX=this.mTouchX-o.x+n,this.mDriveOffsetY=this.mTouchY-o.y+n,this.mDriveDisplayerObject.x=this.mTouchX-this.mDriveOffsetX,this.mDriveDisplayerObject.y=this.mTouchY-this.mDriveOffsetY,i.x=0,i.y=0,this.mDriveDisplayerObject.addChild(i),this.mTopLayer.addChild(this.mDriveDisplayerObject)}},i.prototype.stopDriveTouch=function(e,i,r){if(null!=this.mDriveTargetSaveData){var o=this.mDriveTargetSaveData.showTarget;o.x=this.mDriveTargetSaveData.x,o.y=this.mDriveTargetSaveData.y;var n=this.mDriveTargetSaveData.target;if(null==n.stage)return void(this.mDriveTargetSaveData=null);var a=this.mDriveTargetSaveData.userData;this.mDriveTargetSaveData.parent.addChildAt(o,this.mDriveTargetSaveData.childIndex),this.mTopLayer.removeChild(this.mDriveDisplayerObject);var s=this.mStage.$hitTest(e,i);if(s){var h=new t.GUIDriveEvent(t.GUIDriveEvent.EndDriveEvent,s);h.$initTo(e,i,r),h.setDriveOffXY(this.mDriveOffsetX,this.mDriveOffsetY),h.userData=a,n.dispatchEvent(h)}this.mDriveTargetSaveData=null}},i.prototype.moveDriveTouch=function(t,e,i){null!=this.mDriveTargetSaveData&&(this.mDriveDisplayerObject.x=t-this.mDriveOffsetX,this.mDriveDisplayerObject.y=e-this.mDriveOffsetY)},i.prototype.startTouch=function(t,e,i){-1==this.mTouchId&&(this.mTouchTarget=this.mStage.$hitTest(t,e),this.mTouchBeginTime=-1,this.mTouchTarget&&(this.mTouchBeginTime=core.getCpuTime()),this.mTouchX=t,this.mTouchY=e,this.mTouchId=i,this.mbTouchMove=!1,this.mbFireLongTouch=!1)},i.prototype.stopTouch=function(t){return t!=this.mTouchId?!1:(this.mTouchTarget&&(this.mTouchTarget=null,this.mTouchBeginTime=-1),this.mbFireLongTouch=!1,this.mbTouchMove=!1,this.mTouchId=-1,!0)},i.prototype.isTouchMove=function(){return this.mbTouchMove},i.prototype.onLongTouchEvent=function(){this.mbFireLongTouch||null==this.mTouchTarget||(this.mbFireLongTouch=!0,egret.TouchEvent.dispatchTouchEvent(this.mTouchTarget,t.TouchEvent.TOUCH_LONG,!0,!0,this.mTouchX,this.mTouchY,this.mTouchId,!0),this.startDriveTouch())},i.prototype.initGuiTouchEvent=function(){var e=this.mStage,i=this,r=3,o=egret.sys.TouchHandler.prototype.onTouchBegin;egret.sys.TouchHandler.prototype.onTouchBegin=function(t,e,r){i.mbInputEnable&&(i.mbTouchDown=!0,o.call(this,t,e,r),i.startTouch(t,e,r))};var n=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(t,e,o){i.mbInputEnable&&(n.call(this,t,e,o),(this.mTouchId==o&&Math.abs(i.mTouchX-t)>r||Math.abs(i.mTouchY-e)>r)&&(i.moveDriveTouch(t,e,o),i.mbTouchMove=!0))};var a=egret.sys.TouchHandler.prototype.onTouchEnd;egret.sys.TouchHandler.prototype.onTouchEnd=function(r,o,n){if(!i.mbInputEnable)return void i.stopTouch(n);var s=e.$hitTest(r,o);a.call(this,r,o,n),null!=s&&0==i.mbFireLongTouch&&0==i.mbTouchMove&&null==i.mDriveTargetSaveData&&i.mTouchTarget==s&&egret.TouchEvent.dispatchTouchEvent(s,t.TouchEvent.TOUCH_SHORT,!0,!0,r,o,n,!1),null!=i.mDriveTargetSaveData&&i.stopDriveTouch(r,o,n),i.stopTouch(n),i.mbTouchDown=!1,0==i.mbInputEnableDelay&&(i.mbInputEnable=i.mbInputEnableDelay)}},i}(TClass);t.GuiManager=e,__reflect(e.prototype,"gui.GuiManager")}(gui||(gui={}));var eui;!function(t){var e;!function(e){function i(){var e=t.Image.prototype.$onAddToStage;t.Image.prototype.$onAddToStage=function(t,i){e.call(this,t,i),this.sourceChanged=!0,this.invalidateProperties()};var i=t.Image.prototype.$measureContentBounds;t.Image.prototype.$measureContentBounds=function(t){i.call(this,t);var e=this.$bitmapData;if(!e){var r=this.$UIComponent,o=r[8],n=r[9];isNaN(o)||isNaN(n)||t.setTo(0,0,o,n)}},Object.defineProperty(t.Image.prototype,"enabled",{get:function(){return!!this._enabled},set:function(t){null==this._enabled&&(this._enabled=!0),null==this.lastTouchEnabled&&(this.lastTouchEnabled=!0),t!=this._enabled&&(this._enabled=t,gui.GrayComponent(this,!t),t?this.touchEnabled=this.lastTouchEnabled:(this.lastTouchEnabled=this.touchEnabled,this.touchEnabled=!1))},enumerable:!0,configurable:!0}),t.Image.prototype.isVisibleOnStage=function(){if(null==this.$stage||0==this.visible)return!1;for(var t=!0,e=this.parent;e&&e!=this.$stage;){if(0==e.visible){t=!1;break}e=e.parent}return t},t.Image.prototype.onVisibleChange=function(){if(this._visibleChange=!1,null!=this.$stage)if(this.isVisibleOnStage()){var t=this.$texture;t&&egret.BitmapData.$addDisplayObject(this,t.$bitmapData),(this.sourceChanged||t&&null==t.$bitmapData)&&this.parseSource()}else{var t=this.$texture;t&&egret.BitmapData.$removeDisplayObject(this,t.$bitmapData)}};var r=t.Image.prototype.parseSource;t.Image.prototype.parseSource=function(){return 0==this.isVisibleOnStage()?void(null!=this.$stage&&(this.sourceChanged=!0)):void r.call(this)},t.Image.prototype.onParentVisible=function(t){this._visibleChange||(this._visibleChange=!0,egret.callLater(this.onVisibleChange,this))};var o=t.Image.prototype.$setVisible;t.Image.prototype.$setVisible=function(t){var e=this.$visible;o.call(this,t),e!=t&&(this._visibleChange||(this._visibleChange=!0,egret.callLater(this.onVisibleChange,this)))},t.Button.prototype.invalidateState=function(){var e=t.Component;e.prototype.invalidateState.call(this);var i=this.getCurrentState();gui.GrayComponent(this,"disabled"==i)};var n=gui.GuiManager.getInstance(),a=t.RadioButton.prototype.buttonReleased;t.RadioButton.prototype.buttonReleased=function(){this.shortSelected&&n.isTouchMove()||a.call(this)},Object.defineProperty(t.RadioButton.prototype,"shortSelected",{get:function(){return!!this.$shortSelected},set:function(t){this.$shortSelected=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.ItemRenderer.prototype,"name",{get:function(){if(null==this.parent)return"";var t=this.parent.getChildIndex(this);return"item"+t},set:function(t){this.$name=t},enumerable:!0,configurable:!0}),t.Scroller.prototype.onTouchEndCapture=function(t){if(this.$Scroller[12]){t.stopPropagation(),this.onTouchEnd(t),t.$isPropagationStopped=!1,t.$bubbles=!1;var e=t.$target;this.dispatchEvent(t),t.$setTarget(e)}},t.Scroller.prototype.onTouchTapCapture=function(t){if(this.$Scroller[12]){t.stopPropagation(),t.$isPropagationStopped=!1,t.$bubbles=!1;var e=t.$target;this.dispatchEvent(t),t.$setTarget(e)}};var s=t.DataGroup.prototype.onCollectionChange;t.DataGroup.prototype.onCollectionChange=function(t){s.call(this,t),this._collectionChange=!0};var h=t.DataGroup.prototype.updateDisplayList;t.DataGroup.prototype.updateDisplayList=function(e,i){if(h.call(this,e,i),1==this._collectionChange){this._collectionChange=!1;var r=this,o=r.parent;if(o instanceof t.Scroller){var n=r.contentHeight-o.height;r.scrollV>n&&(r.scrollV=n>0?n:0);var a=r.contentWidth-o.width;r.scrollH>a&&(r.scrollH=a>0?a:0)}}};var l=gui.GuiManager.getInstance(),p=l.getDefaultFontName(),u=!1,m=t.Theme.prototype.$getStyleConfig;t.Theme.prototype.$getStyleConfig=function(t){if(0==u&&""!=p){u=!0;for(var e in this.$styles){var i=this.$styles[e];i.fontFamily=p}}return m.call(this,t)}}e._init=i}(e=t.override||(t.override={}))}(eui||(eui={}));var gui;!function(t){var e=function(){function e(){}return e.prototype.getAsset=function(e,i,r){var o={onAsynTextureSucceed:function(t,o){i.call(r,o,e)}};t.ImageSet.getInstance().loadTextureAsyn(e,o)},e}();t.AssetAdapter=e,__reflect(e.prototype,"gui.AssetAdapter",["eui.IAssetAdapter"])}(gui||(gui={}));var gui;!function(t){var e=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){var o=core.ResManager.getInstance();if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2){var n={onResItemLoad:function(t){window.JSONParseClass.setData(t.getData()),e.call(r,generateEUI2)},onResItemError:function(t){i.call(r)}},a="";"undefined"!=typeof _EuiJsonVersion_&&(a=_EuiJsonVersion_),o.loadResAsyn("gameEui"+a+".json",n,core.ResourceType.TYPE_JSON)}else{var n={onResItemLoad:function(t){e.call(r,t.getData())},onResItemError:function(t){i.call(r)}},o=core.ResManager.getInstance();o.loadResAsyn(t,n,core.ResourceType.TYPE_TEXT)}},t}();t.ThemeAdapter=e,__reflect(e.prototype,"gui.ThemeAdapter",["eui.IThemeAdapter"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.mContainer=new egret.DisplayObjectContainer,t.addChild(t.mContainer),t.mActorList=[],t}return __extends(i,e),i.prototype.updateDisplayList=function(t,e){this.mContainer.x=t/2,this.mContainer.y=e/2},i.prototype.addActor=function(t){if(null!=t){var e=this.mActorList.indexOf(t);if(-1==e){0==this.mActorList.length&&this._regsterTimer();var i=t.getDisplayNode();TLog.Assert(null==i.parent),this.mContainer.addChild(i),t.setInCameraView(null,!0),t.retain(),this.mActorList.push(t)}}},i.prototype.removeActor=function(t){if(null==t)return!1;var e=this.mActorList.indexOf(t);return-1==e?!1:(-1!=this.mContainer.getChildIndex(t.getDisplayNode())&&this.mContainer.removeChild(t.getDisplayNode()),t.setInCameraView(null,!1),t.release(),this.mActorList.splice(e,1),0==this.mActorList.length&&this.clearTimer(),!0)},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),0!=this.mActorList.length&&this._regsterTimer()},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.clearTimer();for(var t=0,i=this.mActorList;t<i.length;t++){var r=i[t];r.setInCameraView(null,!1)}},i.prototype.$hitTest=function(t,i){if(!this.$visible)return null;var r=this.$getInvertedConcatenatedMatrix(),o=r.a*t+r.c*i+r.tx,n=r.b*t+r.d*i+r.ty;return 0>o||o>this.width||0>n||n>this.height?null:e.prototype.$hitTest.call(this,t,i)},i.prototype._regsterTimer=function(){t.GuiManager.getInstance().addTickCallback(this)},i.prototype.clearTimer=function(){t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.onTick=function(){if(0!=this.mActorList.length)for(var t=0,e=this.mActorList;t<e.length;t++){var i=e[t];i.onUpdate(null)}},i}(eui.Component);t.ActorView=e,__reflect(e.prototype,"gui.ActorView",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;
t.m_intervalTime=200,t.m_frameIndex=-1,t.m_intervalCurrentTime=0,t.m_bLoop=!0,t.m_bPlaying=!0,t.m_bReverse=!1,t.m_AnimName="",t.m_AnimInfo=null,t.m_AnimChanged=!1;var i=new eui.Image;return i.percentWidth=100,i.percentHeight=100,t.addChild(i),t.m_image=i,t.touchChildren=!1,t}return __extends(i,e),i.prototype.$onAddToStage=function(i,r){e.prototype.$onAddToStage.call(this,i,r),t.GuiManager.getInstance().addTickCallback(this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.setAnimName=function(e){if(null!=e&&""!=e){var i=t.AnimSet.getInstance().getAnimInfo(e);if(null==i||i.count<=0)return void TLog.Error("AnimBox::SetName %s Error",e);this.m_AnimInfo=i,this.m_AnimName=e,this.setAnimInterval(i.interval)}},i.prototype.play=function(){this.m_bPlaying=!0,this.reset()},i.prototype.pause=function(){this.m_bPlaying=!1},i.prototype.reset=function(){this.m_frameIndex=-1},i.prototype.setLoop=function(t){this.m_bLoop=t},i.prototype.setAnimInterval=function(t){0>t&&(t=100),this.m_intervalTime=t},i.prototype.setReverse=function(t){this.m_bReverse=t},i.prototype.updateAnimImage=function(){var t=String.format("%s_%02d",this.m_AnimName,this.m_frameIndex+1);this.m_image.source=t},i.prototype.onTick=function(){if(0!=this.visible){if(0==this.m_bPlaying||null==this.m_AnimInfo)return 0;for(this.m_intervalCurrentTime+=core.TimeStamp.DelayTime,-1==this.m_frameIndex&&(this.m_frameIndex=this.m_bReverse?this.m_AnimInfo.count:-1,this.m_intervalCurrentTime=this.m_intervalTime,this.m_AnimChanged=!0);this.m_intervalCurrentTime>=this.m_intervalTime;){var e=!1;if(this.m_bReverse?(this.m_frameIndex--,this.m_frameIndex<0&&(e=!0,this.m_frameIndex=this.m_AnimInfo.count-1)):(this.m_frameIndex++,this.m_frameIndex>this.m_AnimInfo.count-1&&(e=!0,this.m_frameIndex=0)),this.m_AnimChanged=!0,e){0==this.m_bLoop&&(this.m_bPlaying=!1);var r=new t.GUIEvent(i.AnimEndEvent,this);this.dispatchEvent(r)}this.m_intervalCurrentTime-=this.m_intervalTime}return this.m_AnimChanged&&this.updateAnimImage(),0}},Object.defineProperty(i.prototype,"animName",{get:function(){return this.m_AnimName},set:function(t){this.setAnimName(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animInterval",{get:function(){return this.m_intervalTime},set:function(t){this.setAnimInterval(t)},enumerable:!0,configurable:!0}),i.AnimEndEvent="AnimEndEvent",i}(eui.Component);t.AnimBox=e,__reflect(e.prototype,"gui.AnimBox",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.$beginDraw=!1,t.touchChildren=!1,t.mCacheImageList=[],t.mCacheMaxCount=30,t}return __extends(i,e),i.prototype.beginDraw=function(){TLog.Assert(0==this.$beginDraw),this.mCacheImageList=[];var t=this.numChildren;if(t<this.mCacheMaxCount)for(var e=0;t>e;e++){var i=this.getChildAt(e);i.visible=!1,this.mCacheImageList.push(i)}else this.removeChildren();this.$beginDraw=!0},i.prototype.endDraw=function(){TLog.Assert(this.$beginDraw),this.$beginDraw=!1,this.$invalidateContentBounds()},i.prototype._renderImage=function(e,i,r){var o=null,n=t.ImageSet.getInstance().getImageInfo(e);return n&&(this.mCacheImageList.length>0?o=this.mCacheImageList.shift():(o=new t.Grid9Image,this.addChild(o)),o.visible=!0,o.source=e,o.x=i,o.y=r,o.fillMode=egret.BitmapFillMode.SCALE,o.width=o.height=0/0),[n,o]},i.prototype._renderProgress=function(t,e,i,r,o){var n=this._renderImage(t,e,i),a=n[0],s=n[1];return a&&(s.fillMode=egret.BitmapFillMode.CLIP,o?s.height=a.h*r:s.width=a.w*r,s.visible=0!=r),a},i.prototype.drawNumberString=function(t,e,i,r,o){if(void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),TLog.Assert(this.$beginDraw),null==t)return 0;"number"==typeof e&&(e=String(e));for(var n=0,a=0;a<e.length;a++){var s=e.charAt(a),h=t+s,l=this._renderImage(h,i,r)[0];l&&(i+=l.w+o,n+=l.w)}return n},i.prototype.drawImage=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),TLog.Assert(this.$beginDraw),null==t)return 0;var r=this._renderImage(t,e,i)[0];return r.w},i.prototype.drawImageProgress=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),TLog.Assert(e>=0&&1>=e),null!=t&&this._renderProgress(t,i,r,e,!1)},i.prototype.drawImageVProgress=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),TLog.Assert(e>=0&&1>=e),null!=t&&this._renderProgress(t,i,r,e,!0)},i.prototype.$invalidateContentBounds=function(){this.invalidateSize()},i}(eui.Component);t.BatchImage=e,__reflect(e.prototype,"gui.BatchImage")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.COMPLETE,e.onCompleteHandler,e),e}return __extends(e,t),e.prototype.onCompleteHandler=function(t){if(null==this.backgroupImage){var e=this.getChildAt(0);e&&e instanceof eui.Image&&(this.backgroupImage=e)}},e.prototype.invalidateState=function(){t.prototype.invalidateState.call(this);var e=this.getCurrentState();if("disabled"==e){var i=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(i);this.filters=[r]}else"down"==e?this.smallButton():"up"==e&&this.normalButton()},e.prototype.smallButton=function(){null!=this.backgroupImage&&(this.backgroupImage.percentWidth=90,this.backgroupImage.percentHeight=90)},e.prototype.normalButton=function(){null!=this.backgroupImage&&(this.backgroupImage.percentWidth=100,this.backgroupImage.percentHeight=100)},Object.defineProperty(e.prototype,"labelColor",{set:function(t){null!=this.labelDisplay&&(this.labelDisplay.textColor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{set:function(t){this.backgroupImage&&(this.backgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroupImage",{get:function(){return this.mBackgroupImage},set:function(t){this.mBackgroupImage=t,this.mBackgroupImage&&(this.mBackgroupImage.verticalCenter=0,this.mBackgroupImage.horizontalCenter=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this.backgroupImage?this.backgroupImage.source:""},set:function(t){this.backgroupImage&&(this.backgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.label},set:function(t){this.label=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{set:function(t){this.labelColor=t},enumerable:!0,configurable:!0}),e}(eui.Button);t.Button=e,__reflect(e.prototype,"gui.Button")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.bAutoScale9Grid=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"autoScale9Grid",{get:function(){return this.bAutoScale9Grid},set:function(t){this.bAutoScale9Grid=t},enumerable:!0,configurable:!0}),e.prototype.$setTexture=function(e){var i=t.prototype.$setTexture.call(this,e);if(this.$UIComponent&&1==this.bAutoScale9Grid&&(this.scale9Grid=null,e)){var r=Math.ceil(e.$bitmapWidth/2),o=Math.ceil(e.$bitmapHeight/2);this.scale9Grid=new egret.Rectangle(r,o,1,1)}return i},e}(eui.Image);t.Grid9Image=e,__reflect(e.prototype,"gui.Grid9Image")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.mbModal=!1,t.mLayerId=1,t.visible=!1,t.mbCanDrag=!1,t.mbModalMask=!1,t.mModalGroupId=0,t}return __extends(i,e),i.prototype.removeFromtParent=function(){this.parent&&this.parent.removeChild(this)},i.prototype.$setX=function(t){return this.dispatchEventWith(egret.Event.CHANGE),e.prototype.$setX.call(this,t)},i.prototype.$setY=function(t){return this.dispatchEventWith(egret.Event.CHANGE),e.prototype.$setY.call(this,t)},i.prototype.$setVisible=function(i){this.visible!=i&&(null==this.mOriginalParent&&(this.mOriginalParent=this.parent),i?this.mOriginalParent?this.mOriginalParent.addChild(this):t.GuiManager.getInstance().setNodeLayer(this,this.mLayerId):(this.mOriginalParent=this.parent,this.removeFromtParent())),1!=this.mbModalMask&&e.prototype.$setVisible.call(this,i)},i.prototype.getComponent=function(t){return this[t]},i.prototype.setDoModal=function(t,e){this.mbModal!=t&&(this.mbModal=t,this.mModalGroupId=e||0,this.mbModal?this.setLayer(2):this.setLayer(1))},i.prototype.isDoModal=function(){return this.mbModal},i.prototype.getModalGroupId=function(){return this.mModalGroupId},i.prototype.setDoModalMask=function(t){t!=this.mbModalMask&&(this.mbModalMask=t,this.mbModalMask&&e.prototype.$setVisible.call(this,!1),this.dispatchEventWith(egret.Event.CHANGE))},i.prototype.isDoModalMask=function(){return this.mbModalMask},i.prototype.moveToFront=function(){if(null!=this.parent){var t=this.parent.numChildren,e=this.parent.getChildIndex(this);if(e!=t-1){var i=this.parent;this.parent.removeChild(this),i.addChildAt(this,-1)}}},i.prototype.moveToBack=function(){if(null!=this.parent){var t=this.parent.getChildIndex(this);if(0!=t){var e=this.parent;this.parent.removeChild(this),e.addChildAt(this,0)}}},i.prototype.setLayer=function(e){this.mLayerId=e,this.visible&&t.GuiManager.getInstance().setNodeLayer(this,this.mLayerId)},i.prototype.getLayer=function(){return this.mLayerId},i.prototype.setCanDrag=function(e){this.mbCanDrag!=e&&(this.mbCanDrag=e,e?(this.addEventListener(t.GUIDriveEvent.BeginDriveEvent,this.onBeginDrive,this),this.addEventListener(t.GUIDriveEvent.EndDriveEvent,this.onEndDrive,this)):(this.removeEventListener(t.GUIDriveEvent.BeginDriveEvent,this.onBeginDrive,this),this.removeEventListener(t.GUIDriveEvent.EndDriveEvent,this.onEndDrive,this)))},i.prototype.onBeginDrive=function(t){t.setDriveBegin(!0),TLog.Debug("LayoutNode::onBeginDrive",this.name)},i.prototype.onEndDrive=function(t){TLog.Debug("LayoutNode::onEndDrive",this.name);var e=this.parent,i=core.EgretUtil.stageToNodeXY(e,t.stageX-t.driveOffStageX,t.stageY-t.driveOffStageY);this.x=i.x,this.y=i.y,this.left=0/0,this.top=0/0,this.right=0/0,this.bottom=0/0,this.verticalCenter=0/0,this.horizontalCenter=0/0},i}(eui.Component);t.LayoutNode=e,__reflect(e.prototype,"gui.LayoutNode")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.mColorNode=new eui.Rect,i.mColorNode.fillColor=t.Color.black,i.mColorNode.alpha=.5,i.addChild(i.mColorNode),i.touchChildren=!1,i.touchEnabled=!1,i.mRenderNode=new egret.Bitmap,i.mLayoutNodeList=[],i.mbMaskNodeChanged=!1,i.mMaskNodeSaveDataList=null,i.mbUpdateLock=!1,i}return __extends(i,e),i.prototype.$onAddToStage=function(i,r){e.prototype.$onAddToStage.call(this,i,r),t.GuiManager.getInstance().addTickCallback(this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.$cacheDirtyUp=function(){e.prototype.$cacheDirtyUp.call(this),this.setNodeChange()},i.prototype.addLayoutNode=function(t){return TLog.Assert(null!=t),-1!=this.mLayoutNodeList.indexOf(t)?!1:(t.addEventListener(egret.Event.CHANGE,this.onModalMaskChange,this),this.mLayoutNodeList.push(t),void this.setNodeChange())},i.prototype.removeLayoutNode=function(t){return 0==JsUtil.arrayRemoveVal(this.mLayoutNodeList,t)?!1:(t.removeEventListener(egret.Event.CHANGE,this.onModalMaskChange,this),this.setNodeChange(),!0)},i.prototype.getMaskNodeList=function(){for(var t=[],e=0;e<this.mLayoutNodeList.length;e++){var i=this.mLayoutNodeList[e];i.isDoModalMask()&&t.push(i)}return t},i.prototype.isUpdateLock=function(){return this.mbUpdateLock},i.prototype.setNodeChange=function(){this.mbUpdateLock||(this.mbMaskNodeChanged=!0)},i.prototype.removeChildSafe=function(t){null!=t.parent&&t.parent.removeChild(t)},i.prototype.addChildSafe=function(t){t.parent!=this&&this.addChild(t)},i.prototype.onBeginMask=function(t){this.mMaskNodeSaveDataList=[];for(var e=0;e<t.length;e++){var i=t[e],r={node:i,parent:i.parent,childIndex:i.parent.getChildIndex(i)};this.mMaskNodeSaveDataList.push(r)}},i.prototype.onUpdateMask=function(t){null==this.mMaskNodeContainer&&(this.mMaskNodeContainer=new egret.DisplayObjectContainer),this.mColorNode.width=this.width,this.mColorNode.height=this.height,this.mMaskNodeContainer.removeChildren(),this.mMaskNodeContainer.addChild(this.mColorNode);for(var e=0;e<t.length;e++){var i=t[e];i.$visible=!0,i.blendMode=egret.BlendMode.ERASE,this.mMaskNodeContainer.addChild(i)}null==this.mRenderTexture&&(this.mRenderTexture=new egret.RenderTexture),this.mRenderTexture.drawToTexture(this.mMaskNodeContainer),this.mRenderNode.texture=this.mRenderTexture},i.prototype.onFinshMask=function(){for(var t=0;t<this.mMaskNodeSaveDataList.length;t++){var e=this.mMaskNodeSaveDataList[t];e.node.$visible=!1,e.parent.addChildAt(e.node,e.childIndex)}this.mMaskNodeSaveDataList=null},i.prototype.onTick=function(){if(0!=this.mbMaskNodeChanged){this.mbMaskNodeChanged=!1,this.mbUpdateLock=!0;for(var t=[],e=0;e<this.mLayoutNodeList.length;e++){var i=this.mLayoutNodeList[e];i.isDoModalMask()&&t.push(i)}t.length>0?(this.removeChildSafe(this.mColorNode),this.onBeginMask(t),this.onUpdateMask(t),this.onFinshMask(),this.addChildSafe(this.mRenderNode)):(this.mColorNode.width=this.width,this.mColorNode.height=this.height,this.removeChildSafe(this.mRenderNode),this.addChildSafe(this.mColorNode)),this.mbUpdateLock=!1}},i.prototype.onModalMaskChange=function(t){this.setNodeChange()},i}(eui.UILayer);t.ModalColorLayer=e,__reflect(e.prototype,"gui.ModalColorLayer",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.colorLayer=new t.ModalColorLayer,i.touchEnabled=!0,i.addChild(i.colorLayer),i.visible=!1,i}return __extends(i,e),i.prototype.$doAddChild=function(i,r,o){return void 0===o&&(o=!0),e.prototype.$doAddChild.call(this,i,r,o),this.colorLayer==i?i:(TLog.Assert(i instanceof t.LayoutNode),this.colorLayer.isUpdateLock()?void 0:(this.colorLayer.addLayoutNode(i),this.updateLayer(),i))},i.prototype.$doRemoveChild=function(i,r){void 0===r&&(r=!0);var o=e.prototype.$doRemoveChild.call(this,i,r);if(this.colorLayer==o)return o;if(!this.colorLayer.isUpdateLock())return o instanceof t.LayoutNode&&this.colorLayer.removeLayoutNode(o),this.updateLayer(),o},i.prototype.$hitTest=function(t,i){if(this.numChildren<=1)return null;var r=this.colorLayer.getMaskNodeList();if(0==r.length){var o=this.getChildAt(this.numChildren-1);TLog.Assert(o!=this.colorLayer);var n=o.$hitTest(t,i);return n?n:this}for(var a=e.prototype.$hitTest.call(this,t,i),s=this.getChildIndex(this.colorLayer),h=!1,l=0;l<r.length;l++){var p=r[l],u=this.getChildIndex(p);if(s>u)break;p.$visible=!0;var m=p.$hitTest(t,i);if(p.$visible=!1,null!=m){h=!0;break}}return 1==h?a==this?null:a:this},i.prototype.updateLayer=function(){var t=this.numChildren;if(1==t){var e=this.getChildAt(0);return TLog.Assert(e==this.colorLayer),void(this.visible=!1)}this.visible=!0;for(var i=0,r=-1,o=!1,n=t-1;n>=0;n--){var e=this.getChildAt(n);if(e!=this.colorLayer){var a=e;if(-1==r&&0==a.getModalGroupId()){i=n,o&&i++;break}var s=a.getModalGroupId();if(-1!=r&&s!=r){var h=o?2:1;i=n+h;break}r=s,o=!1}else o=!0}i>0?this.setChildIndex(this.colorLayer,i-1):this.setChildIndex(this.colorLayer,0)},i}(eui.UILayer);t.ModalLayer=e,__reflect(e.prototype,"gui.ModalLayer")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCompleteHandler=function(t){if(null==this.mBackgroupImage){var e=this.getChildAt(0);e&&e instanceof eui.Image&&(this.mBackgroupImage=e)}},Object.defineProperty(e.prototype,"image",{set:function(t){this.mBackgroupImage&&(this.mBackgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroupImage",{get:function(){return this.mBackgroupImage},set:function(t){this.mBackgroupImage=t,this.mBackgroupImage&&(this.mBackgroupImage.verticalCenter=0,this.mBackgroupImage.horizontalCenter=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{set:function(t){if(this.thumb){var e=this.thumb;e.source=t}},enumerable:!0,configurable:!0}),e}(eui.ProgressBar);t.ProgressBar=e,__reflect(e.prototype,"gui.ProgressBar")}(gui||(gui={}));var gui;!function(t){var e=function(){function t(){this.type=0,this.id=0,this.text="",this.name="",this.link="",this.color=0,this.border=0,this.value=0,this.flag=0}return t}();__reflect(e.prototype,"LogicInfo");var i=function(){function t(){this.width=0,this.height=0,this.logicInfo=null,this.param1=null,this.param2=null,this.window=null}return t}();__reflect(i.prototype,"PosInfo");var r=function(){function t(){this.contentH=0,this.contentW=0,this.mPosInfoList=[],this.full=!1}return t}();__reflect(r.prototype,"RowInfo");var o=function(o){function n(){var e=o.call(this)||this;return e.mRowInfoList=[],e.mLogicInfoList=[],e.mTempXmlList=[],e.mDefaultValue=16,e.mDefaultFontFlag=t.Flag.LEFT_CENTER,e.mReplaceArr=[],e.mReplaceArr.push([/&lt;/g,"<"]),e.mReplaceArr.push([/&gt;/g,">"]),e.mReplaceArr.push([/&amp;/g,"&"]),e.mReplaceArr.push([/&quot;/g,'"']),e.mReplaceArr.push([/&apos;/g,"'"]),e.mContainer=e,e.mAlignFlag=0,e.mContentChanged=!1,e.mSizeChanged=!1,e.mRowDistance=0,e.mCacheCtrlList={},e.mbShowLast=!1,e.mTempXmlNodeList=[],e}return __extends(n,o),n.prototype.translateWord=function(e){var i=e.split("##");if(i.length<=2)return e;var r=i.length;if(r%2==0){var o=i[r-1];i[r-1]="##"+o}for(var a=0;r>a;a++){var o=i[a];if(a%2==1&&a!=r-1&&""!=o){var s=new t.GUITranslateWordEvent(n.RichDisplayerTranslateEvent,this);s.setTranslateWord(o),this.dispatchEvent(s);var h=s.getTranslateWord();if(""==h)return e;i[a]=h}}return i.join("")},n.prototype.replaceSpecial=function(t){for(var e=0;e<this.mReplaceArr.length;e++){var i=this.mReplaceArr[e][0],r=this.mReplaceArr[e][1];t=t.replace(i,r)}return t},n.prototype.fillLogicInfo=function(e,i){switch(e.type){case 4:case 6:case 5:e.value=TXML.queryIntAttribute(i,n.AttValue,this.mDefaultValue);break;case 1:case 3:case 2:var r=TXML.queryText(i);if(r=this.replaceSpecial(r),1==e.type){if(""==r)return void TLog.Error("RichDisplayer::FillLogicElemInfo TextType can not get text");e.text=this.translateWord(r)}else e.text=r;if(e.link=TXML.queryAttribute(i,n.AttLink),e.name=TXML.queryAttribute(i,n.AttName),""==e.name&&(3==e.type||2==e.type))return void TLog.Error("RichDisplayer::FillLogicElemInfo AnimType or ImageType can not get name");var o=TXML.queryAttribute(i,n.AttColor);""!=o&&(e.color=t.GetColorFromName(o));var a=TXML.queryAttribute(i,n.AttFlag);""!=a?e.flag=t.GetFlagFromName(a):e.flag=this.mDefaultFontFlag}},n.prototype.setRowDistance=function(t){this.mRowDistance=t},n.prototype.showFirstRow=function(){this.mbShowLast=!1},n.prototype.showLastRow=function(){this.mbShowLast=!0},n.prototype._addXmlNodeImp=function(){for(var t=this,i=0;i<this.mTempXmlNodeList.length;i++){var r=this.mTempXmlNodeList[i];TXML.forEach(r,function(i){var r=i.name,o=-1;if(r==n.TagText?o=1:r==n.TagBR?o=4:r==n.TagHorBlank?o=6:r==n.TagVerBlank?o=5:r==n.TagImage?o=2:r==n.TagAnim&&(o=3),-1!=o){var a=new e;a.type=o,t.fillLogicInfo(a,i),t.mLogicInfoList.push(a)}})}},n.prototype._addXmlStringImp=function(t){var i=this;t="<root>"+t+"</root>";var r=TXML.parse(t);return null==r?void TLog.Error("addXmlString %s",t):void TXML.forEach(r,function(t){var r=t.name,o=-1;if(r==n.TagText?o=1:r==n.TagBR?o=4:r==n.TagHorBlank?o=6:r==n.TagVerBlank?o=5:r==n.TagImage?o=2:r==n.TagAnim&&(o=3),-1!=o){var a=new e;a.type=o,i.fillLogicInfo(a,t),i.mLogicInfoList.push(a)}})},n.prototype.addXmlString=function(t){""!=t&&(this.mTempXmlList.push(t),this.mContentChanged=!0,this.invalidateDisplayList())},n.prototype.addXmlNode=function(t){null!=t&&(this.mTempXmlNodeList.push(t),this.mContentChanged=!0,this.invalidateDisplayList())},n.prototype.finishCurrentRow=function(){var t=this.getCurrentRow();t.full=!0},n.prototype.getCurrentRow=function(){var t=null;return this.mRowInfoList.length>0&&(t=this.mRowInfoList[this.mRowInfoList.length-1],t.full&&(t=null)),null==t&&(t=new r,this.mRowInfoList.push(t)),t},n.prototype.addPosInfo=function(t,e,r){var o=new i;o.logicInfo=t,o.width=e,o.height=r;var n=this.getCurrentRow();return n.contentW=n.contentW+e,n.contentH=Math.max(n.contentH,r),n.mPosInfoList.push(o),o},n.prototype.insertImage=function(e){var i=t.ImageSet.getInstance().getImageInfo(e.name);if(!(null==i||i.w>this.width)){var r=this.getCurrentRow();r.contentW+i.w>this.width&&(this.finishCurrentRow(),r=this.getCurrentRow()),this.addPosInfo(e,i.w,i.h)}},n.prototype.insertAnim=function(e){var i=t.AnimSet.getInstance().getAnimInfo(e.name);if(!(null==i||i.w>this.width)){var r=this.getCurrentRow();r.contentW+i.w>this.width&&(this.finishCurrentRow(),r=this.getCurrentRow()),this.addPosInfo(e,i.w,i.h)}},n.prototype.insertText=function(e){if(""!=e.text){var i=e.name,r=t.FontSet.getInstance().getFont(i);if(null==r)return void TLog.Error("RichDisplayer::insertText font:%s == null",i);for(var o=this.width,n=0,a=0,s=0,h=0;h<e.text.length;h++){var l=e.text[h],p=egret.sys.measureText(l,r.fontName,r.fontSize,r.isBold(),r.isItalic()),u=this.getCurrentRow();if(u.contentW+s+p<=o)a=h,s+=p;else{if(s>0){var m=this.addPosInfo(e,s,r.fontSize);m.param1=n,m.param2=a,n=h,a=h,s=p}this.finishCurrentRow()}}if(s>0){var m=this.addPosInfo(e,s,r.fontSize);m.param1=n,m.param2=a}}},n.prototype.clear=function(){this.mContentChanged=!0,this.mTempXmlList=[],this.mTempXmlNodeList=[],this.mLogicInfoList=[],this.invalidateDisplayList()},n.prototype.setAlignFlag=function(t){this.mAlignFlag=t},n.prototype.getLogicWidth=function(){this.refreshLogicShow();for(var t=0,e=0;e<this.mRowInfoList.length;e++){var i=this.mRowInfoList[e];t=Math.max(t,i.contentW)}return t},n.prototype.getLogicHeight=function(){this.refreshLogicShow();for(var t=0,e=0;e<this.mRowInfoList.length;e++){var i=this.mRowInfoList[e];t+=i.contentH+this.mRowDistance}return t},n.prototype.getLogicRowCount=function(){return this.refreshLogicShow(),this.mRowInfoList.length},n.prototype.refreshLogicShow=function(){var t=this;if(0!=this.mContentChanged){if(this.mContentChanged=!1,this.mSizeChanged=!0,this.mTempXmlList.length>0){var e=this.mTempXmlList.join();this.mTempXmlList=[],this._addXmlStringImp(e)}if(this.mTempXmlNodeList.length>0&&(this._addXmlNodeImp(),this.mTempXmlNodeList=[]),this.mRowInfoList.length>0&&(this.mRowInfoList.forEach(function(e){e.mPosInfoList.forEach(function(e){null!=e.window&&(t.releaseCtrl(e.logicInfo.type,e.window),e.window=null)})}),this.mRowInfoList.length=0),this.mLogicInfoList.length>0)for(var i=this.width,r=(this.height,0);r<this.mLogicInfoList.length;r++){var o=this.mLogicInfoList[r];if(4==o.type){var n=this.getCurrentRow();n.full=!0,0==n.contentH&&(n.contentH=o.value)}else if(5==o.type){this.finishCurrentRow();var n=this.getCurrentRow();n.contentH=o.value,this.finishCurrentRow()}else if(6==o.type){var n=this.getCurrentRow();this.addPosInfo(o,o.value,0),n.contentW>i&&(n.contentW=i,this.finishCurrentRow())}else 2==o.type?this.insertImage(o):3==o.type?this.insertAnim(o):1==o.type&&this.insertText(o)}}},n.prototype.updateDisplayList=function(e,i){do{if(0==this.width||0==this.height){TLog.Error("RichDisplayer::refreshShow this.width == 0 || this.height == 0");break}if((this.width!=e||this.height!=i)&&(this.mSizeChanged=!0),this.refreshLogicShow(),1==this.mSizeChanged){this.mSizeChanged=!1;var r=0,n=0,a=this.getLogicWidth(),s=this.getLogicHeight();(this.mAlignFlag&t.Flag.H_CENTER)==t.Flag.H_CENTER?r=(this.width-a)/2:(this.mAlignFlag&t.Flag.RIGHT)==t.Flag.RIGHT&&(r=this.width-a),(this.mAlignFlag&t.Flag.V_CENTER)==t.Flag.V_CENTER&&(n=(this.height-s)/2);for(var h=n,l=0;l<this.mRowInfoList.length;l++){var p=this.mRowInfoList[l],u=p.contentH,m=p.contentW,c=0;(this.mAlignFlag&t.Flag.H_CENTER)==t.Flag.H_CENTER?c=(a-m)/2:(this.mAlignFlag&t.Flag.RIGHT)==t.Flag.RIGHT&&(c=a-m);for(var d=c+r,f=0;f<p.mPosInfoList.length;f++){var g=p.mPosInfoList[f],y=g.logicInfo,v=u-g.height+2;if(1==y.type){var T=y.text.substring(g.param1,g.param2+1),C=g.window;null==C&&(C=g.window=this.getSaveLabel(T)),t.FontSet.getInstance().updateTextField(y.name,C,!1),C.textColor=y.color,C.text=T}else if(2==y.type){var L=g.window;null==L&&(L=g.window=this.getSaveImage()),L.source=y.name,L.touchEnabled=!1}else if(3==y.type){var _=g.window;null==_&&(_=g.window=this.getSaveAnimBox()),_.setAnimName(y.name),_.play(),_.touchEnabled=!1}var I=g.window;I&&(I.x=d,I.y=h+v,I.width=g.width,I.height=g.height),d+=g.width}d=0,h=h+p.contentH+this.mRowDistance}}}while(!1);if(o.prototype.updateDisplayList.call(this,e,i),this.mbShowLast){var b=(this.scrollV,this.contentHeight-this.height);0>b&&(b=0),this.scrollV=b}},n.prototype.setCtrlVisible=function(t,e){t.visible=e,t.includeInLayout=e},n.prototype.releaseCtrl=function(t,e){null==this.mCacheCtrlList[t]&&(this.mCacheCtrlList[t]=[]),this.setCtrlVisible(e,!1),this.mCacheCtrlList[t].push(e)},n.prototype.getSaveLabel=function(t){var e=1,i=this.mCacheCtrlList[e];if(null==i&&(i=this.mCacheCtrlList[e]=[]),0==i.length){var r=new eui.Label;r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRdTouchTapCapture,this,!0),this.mContainer.addChild(r),i.push(r)}for(var o=null,n=0;n<i.length;n++){var r=i[n];if(r.text==t){i.splice(n,1),o=r;break}}return null==o&&(o=i.pop()),this.setCtrlVisible(o,!0),o},n.prototype.getSaveImage=function(){var t=2,e=this.mCacheCtrlList[t];if(null==e&&(e=this.mCacheCtrlList[t]=[]),0==e.length){var i=new eui.Image;this.mContainer.addChild(i),e.push(i)}var r=e.pop();return this.setCtrlVisible(r,!0),r},n.prototype.getSaveAnimBox=function(){var e=3,i=this.mCacheCtrlList[e];if(null==i&&(i=this.mCacheCtrlList[e]=[]),0==i.length){var r=new t.AnimBox;this.mContainer.addChild(r),i.push(r)}var o=i.pop();return this.setCtrlVisible(o,!0),o},n.prototype.getLogicInfoFromWindow=function(t){for(var e=0;e<this.mRowInfoList.length;e++)for(var i=this.mRowInfoList[e],r=0;r<i.mPosInfoList.length;r++){var o=i.mPosInfoList[r];if(o.window==t)return o.logicInfo}return null},n.prototype.onRdTouchTapCapture=function(e){var i=this.getLogicInfoFromWindow(e.target);if(i&&""!=i.link){var r=new t.GUIHyperlinkEvent(n.RichDisplayerLinkCmdEvent,this);r.setHyperlink(i.link),this.dispatchEvent(r)}},n.TagBR="br",n.TagVerBlank="ver_blank",n.TagHorBlank="hor_blank",n.TagText="text",n.TagImage="image",n.TagAnim="anim",n.AttName="name",n.AttColor="color",n.AttLink="link",n.AttValue="value",n.AttFlag="flag",n.RichDisplayerLinkCmdEvent="RichDisplayerLinkCmdEvent",n.RichDisplayerTranslateEvent="RichDisplayerTranslateEvent",n}(eui.Group);t.RichDisplayer=o,__reflect(o.prototype,"gui.RichDisplayer")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchScrollH=e.$Scroller[8],e.touchScrollV=e.$Scroller[9],e}return __extends(e,t),e.prototype.scrollToXY=function(t,e,i){var r=this.viewport;if(null!=r){r.validateNow(),this.stopAnimation();var o=r.contentWidth-this.width;0>o&&(o=0),t>o&&(t=o),0>t&&(t=0);var n=r.contentHeight-this.height;0>n&&(n=0),e>n&&(e=n),0>e&&(e=0),0==i?(r.scrollH=t,r.scrollV=e):(this.touchScrollH.maxScrollPos=o,this.touchScrollV.maxScrollPos=n,this.touchScrollH.throwTo(t,300),this.touchScrollV.throwTo(e,300))}},e}(eui.Scroller);t.Scroller=e,__reflect(e.prototype,"gui.Scroller")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isPullDown=!0,t.maxItemCount=10,t._itemData={},t.initPullView(),t}return __extends(i,e),i.prototype.updateData=function(t,e){if(null!=this._data)for(var i=0;i<this._data.length;i++)this._data[i][t]=e},i.prototype.initPullView=function(){var e=30;this.bg=new eui.Image,this.addChild(this.bg),this.bg.width=this.width,this.bg.height=e,this.titleLabel=new eui.Label,this.addChild(this.titleLabel),this.titleLabel.width=this.width,this.titleLabel.height=e,this.titleLabel.textColor=0,this.titleLabel.verticalAlign="middle",this.titleLabel.textAlign="center",this.titleLabel.text="ComboBox",this.titleLabel.size=20,this.titleLabel.addEventListener(egret.TouchEvent.TOUCH_END,this.onRightIconBg,this);var r=new eui.ArrayCollection(this._data);this.Scroller=new eui.Scroller,this.scrollY=e,this.Scroller.width=this.width,this.setMaxItem(this.maxItemCount),this.DataGroup=new eui.DataGroup,this.Scroller.addChild(this.DataGroup),this.DataGroup.dataProvider=r,this.DataGroup.itemRenderer=t.ComboBoxItem,this.Scroller.viewport=this.DataGroup,this.DataGroup.useVirtualLayout=!0,this.Scroller.addEventListener(i.onClick,this.onItemClick,this),this.hide()},i.prototype.onRightIconBg=function(t){this.isPullDown?this.hide():this.show()},i.prototype.getTitleLabe=function(){return this.titleLabel},i.prototype.setItemWidth=function(t){this.width=t,this.bg.width=t,this.titleLabel.width=t,this.Scroller.width=t,this.updateData("width",t),this._itemData.width=t},i.prototype.setItemHeight=function(t){this.updateData("height",t),this._itemData.height=t},i.prototype.setItemFontSize=function(t){void 0===t&&(t=25),this.updateData("fontSize",t),this._itemData.fontSize=t},i.prototype.setTitleHeight=function(t){this.bg.height=t,this.titleLabel.height=t,this.scrollY=t,this.updatePos()},i.prototype.setTitleBackground=function(t){this.bg.source=t},i.prototype.setTitleFontSize=function(t){this.titleLabel.size=t},i.prototype.setTitle=function(t){this.titleLabel.text=t},i.prototype.updatePos=function(){if(null!=this.Scroller&&null!=this.Scroller.parent){var t=this.$getConcatenatedMatrix(),e=t.transformPoint(0,this.scrollY);this.Scroller.x=e.x,this.Scroller.y=e.y}},i.prototype.show=function(){this.isPullDown=!0,this.stage.addChild(this.Scroller),this.updatePos()},i.prototype.hide=function(){this.isPullDown=!1,this.Scroller.parent&&this.Scroller.parent.removeChild(this.Scroller)},i.prototype.setItemTextAlign=function(t){this.titleLabel.textAlign=t,this.updateData("textAlign",t),this._itemData.textAlign=t},i.prototype.$setWidth=function(t){e.prototype.$setWidth.call(this,t),this.Scroller&&(this.Scroller.width=t,this.bg.width=t,this.titleLabel.width=t)},i.prototype.$setHeight=function(t){e.prototype.$setHeight.call(this,t)},i.prototype.setMaxItem=function(t){if(this.maxItemCount=t,this.Scroller){var e=this._itemData.height;null==e&&(e=this.height),this.Scroller.height=this.maxItemCount*e}},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){if(this._data=t,this._itemData)for(var e in this._itemData){var i=this._itemData[e];this.updateData(e,i)}if(this.DataGroup){var r=new eui.ArrayCollection(this._data);this.DataGroup.dataProvider=r}},enumerable:!0,configurable:!0}),i.prototype.onItemClick=function(t){this.hide(),this.dispatchEvent(t)},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMouseDown,this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMouseDown,this)},i.prototype.onStageMouseDown=function(t){0==this.contains(t.target)&&0==this.Scroller.contains(t.target)&&this.hide()},i.onClick="ComboBoxOnClick",i}(eui.Component);t.ComboBox=e,__reflect(e.prototype,"gui.ComboBox")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(TClass);t.AnimInfo=e,__reflect(e.prototype,"gui.AnimInfo");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mInfoList={}},i.prototype.destory=function(){},i.prototype.insertInfo=function(t,i,r,o,n){TLog.Assert(""!=t&&null!=i&&null!=r&&null!=o&&null!=n);var a=e.newObj();return a.w=i,a.h=r,a.count=o,a.interval=n,this.mInfoList[t]=a,!0},i.prototype.getAnimInfo=function(t){return this.mInfoList[t]},i.prototype.getAnimSize=function(t){var e=this.getAnimInfo(t);return null==e?null:{w:e.w,h:e.h}},i.prototype.getAnimFrameNum=function(t){var e=this.getAnimInfo(t);if(null!=e)return e.count},i}(TClass);t.AnimSet=i,__reflect(i.prototype,"gui.AnimSet")
}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},i.prototype.destory=function(){},i.prototype.init=function(t,e,i){this.fontName=t,this.fontSize=e,this.flag=i},i.prototype.setColor=function(t){this.color=t},i.prototype.setShadowColor=function(t){this.shadowColor=t},i.prototype.setShadowOffset=function(t){this.shadownOffset=t},i.prototype.setSpace=function(t,e){this.space_x=t,this.space_y=e},i.prototype.setStroke=function(t){this.stroke=t},i.prototype.isBold=function(){return 0!=(this.flag&t.FontFlag.BOLD)},i.prototype.isItalic=function(){return 0!=(this.flag&t.FontFlag.ITALIC)},i}(TClass);t.FontInfo=e,__reflect(e.prototype,"gui.FontInfo");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mFontList={}},r.prototype.destory=function(){this.clearAllFont()},r.prototype.insertFont=function(t,i,r,o,n,a,s,h,l,p){var u=this.mFontList[t];return u?(u.init(i,r,a),u.setColor(o),u.setShadowColor(n),u.setSpace(s,h),u.setStroke(l),u.setShadowOffset(p),!1):(u=e.newObj(),u.init(i,r,a),u.setColor(o),u.setShadowColor(n),u.setSpace(s,h),u.setStroke(l),u.setShadowOffset(p),void(this.mFontList[t]=u))},r.prototype.getFont=function(t){var e=this.mFontList[t];return null==e?(TLog.Error("FontSet.getFont %s not exist",t),null):e},r.prototype.clearAllFont=function(){for(var t in this.mFontList){var e=this.mFontList[t];e.deleteObj()}this.mFontList=null},r.prototype.hasFlag=function(t,e){return 0!=(t&e)},r.prototype.updateTextField=function(e,i,r){null==r&&(r=!0);var o=this.getFont(e);if(null!=o){var n=o.flag;i.fontFamily=o.fontName,i.size=o.fontSize,r&&(i.textColor=o.color),i.lineSpacing=o.space_y,i.italic=this.hasFlag(n,t.FontFlag.ITALIC),i.bold=this.hasFlag(n,t.FontFlag.BOLD),this.hasFlag(n,t.FontFlag.STROKE)?(i.stroke=o.stroke,i.strokeColor=o.shadowColor):i.stroke=0;var a=egret.HorizontalAlign.LEFT,s=egret.VerticalAlign.TOP;this.hasFlag(n,t.Flag.H_CENTER)?a=egret.HorizontalAlign.CENTER:this.hasFlag(n,t.Flag.RIGHT)&&(a=egret.HorizontalAlign.RIGHT),this.hasFlag(n,t.Flag.V_CENTER)?s=egret.VerticalAlign.MIDDLE:this.hasFlag(n,t.Flag.BOTTOM)&&(s=egret.VerticalAlign.BOTTOM),a&&s&&(i.textAlign=a,i.verticalAlign=s)}},r}(TClass);t.FontSet=i,__reflect(i.prototype,"gui.FontSet")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.subTexture=null,this.baseTexture=null},e.prototype.destory=function(){this.subTexture=null,this.baseTexture=null},e}(TClass);t.ImageInfo=e,__reflect(e.prototype,"gui.ImageInfo");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResMgr=core.ResManager.getInstance(),this.mTextureMgr=core.TextureManager.getInstance(),this.mTextureMgr.addEventListener(core.TextureEvent.TextureDisposeEvent,this.onTextureDispose,this),this.mInfoList={}},i.prototype.destory=function(){this.clearInfo(),this.mTextureMgr.removeEventListener(core.TextureEvent.TextureDisposeEvent,this.onTextureDispose,this)},i.prototype.loadImageSet=function(t,e){var i=this,r={onResItemLoad:function(r){i.onImageSetInfoLoad(t,r.getData()),e.onImageSetLoad(t)},onResItemError:function(i){e.onImageSetLoad(t)}};this.mResMgr.loadResAsyn(t,r,core.ResourceType.TYPE_JSON)},i.prototype.onImageSetInfoLoad=function(t,i){var r=i.file;t=t.split("\\").join("/");var o=t.match(/#.*|\?.*/),n="";o&&(n=o[0]);var a=t.lastIndexOf("/");t=-1!=a?t.substring(0,a+1)+r:r;var s=t+n,h=i.frames,l=e.createObj();for(var p in h){var u=h[p];l.x=u.x,l.y=u.y,l.w=u.w,l.h=u.h,l.offX=u.offX,l.offY=u.offY,l.sourceW=u.sourceW,l.sourceH=u.sourceH,this.insertInfo(p,s,l)}},i.prototype.insertInfo=function(t,i,r){if(""==t||""==i||null==r)return!1;if(null!=this.mInfoList[t])return!1;var o=e.newObj();return o.x=r.x,o.y=r.y,o.w=r.w,o.h=r.h,o.offX=r.offX,o.offY=r.offY,o.sourceW=r.sourceW,o.sourceH=r.sourceH,o.name=r.name,o.fileName=i,this.mInfoList[t]=o,!0},i.prototype.clearInfo=function(){for(var t in this.mInfoList){var e=this.mInfoList[t];e.deleteObj()}this.mInfoList={}},i.prototype.getImageInfo=function(t){if(null==t||""==t)return null;var e=this.mInfoList[t];if(null==e){var i=t.lastIndexOf(".");if(-1!=i){var r=t.substring(i+1);e=this.mInfoList[r]}}return e},i.prototype.createSubTexture=function(t,e,i,r,o,n,a,s,h){void 0===n&&(n=0),void 0===a&&(a=0),void 0==s&&(s=n+r),void 0==h&&(h=a+o);var l=new egret.Texture;return l.$bitmapData=t.$bitmapData,l.$initData(e,i,r,o,n,a,s,h,t.$sourceWidth,t.$sourceHeight),l},i.prototype.loadTextureAsyn=function(t,e){var i=this,r=i.getImageInfo(t);if(null!=r)if(null!=r.subTexture)e.onAsynTextureSucceed(t,r.subTexture);else{var o={onAsynTextureSucceed:function(o,n){r.baseTexture=n,r.subTexture=i.createSubTexture(n,r.x,r.y,r.w,r.h,r.offX,r.offY,r.sourceW,r.sourceH),e.onAsynTextureSucceed(t,r.subTexture)}};i.mTextureMgr.loadTextureAsyn(r.fileName,o)}else i.mTextureMgr.loadTextureAsyn(t,e)},i.prototype.onTextureDispose=function(t){var e=t.path;for(var i in this.mInfoList){var r=this.mInfoList[i];r.fileName==e&&(r.subTexture&&(r.subTexture.$bitmapData=null,r.subTexture=null),r.baseTexture&&(r.baseTexture.$bitmapData=null,r.baseTexture=null))}},i}(TClass);t.ImageSet=i,__reflect(i.prototype,"gui.ImageSet")}(gui||(gui={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.userData=t[0]},e.LOAD_MAP_FINISH="LOAD_MAP_FINISH",e}(core.EventArgs);t.MapEvent=e,__reflect(e.prototype,"map.MapEvent");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t.mFileName="",t.mResMgr=null,t.mMapData=null,t}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mResMgr=core.ResManager.getInstance(),this.mMapLayerList=[],this.mbLayersOrderChange=!1,this.m_pPathMgr=t.PathMgr.newObj(),this.m_pLogicMask=t.LogicMask.newObj(),this.m_pLogicBlock=this.m_pPathMgr.getLogicBlock(),this.m_loadingMapPathList=[],this.mStaticImageMap={},this.mAreaAnimMap={},this.mAreaParticleMap={},this.m_bBeginLoadTileImage=!1,this.m_loadingTileImageList=[]},r.prototype.destory=function(){this.m_pPathMgr&&(this.m_pPathMgr.deleteObj(),this.m_pPathMgr=null)},r.prototype.init=function(e){TLog.Assert(null==this.mTileMap,"initWithRootNode this.mTileMap == null"),this.mTileMap=new t.TileMap(e);var i=this.mTileMap.getCamera();i.setViewSize(e.stage.stageWidth,e.stage.stageHeight),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this),i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.onMouseUp,this)},r.prototype.onMouseDown=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseDownEvent(t)},r.prototype.onMouseMove=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseMoveEvent(t)},r.prototype.onMouseUp=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseUpEvent(t)},r.prototype.setInputCallback=function(t){this.mInputCallback=t},r.prototype.getTileMap=function(){return this.mTileMap},r.prototype.getCamera=function(){return this.mTileMap.getCamera()},r.prototype.onUpdate=function(){this.mbLayersOrderChange&&(this.mbLayersOrderChange=!1,this.mTileMap.sortLayers()),this.mTileMap.onUpdate()},r.prototype.addLoadingTileImage=function(t){var e=this.m_loadingTileImageList.indexOf(t);-1==e&&(this.m_bBeginLoadTileImage=!0,this.m_loadingTileImageList.push(t))},r.prototype.removeLoadingTileImage=function(t){var e=this.m_loadingTileImageList.indexOf(t);-1!=e&&this.m_loadingTileImageList.splice(e,1)},r.prototype.getLoadingTileImageCount=function(){return 0==this.m_bBeginLoadTileImage?-1:this.m_loadingTileImageList.length},r.prototype.loadMap=function(t,e){if(""==t)return!1;if(t.lastIndexOf("/")!=t.length-1&&(t+="/"),this.m_loadingMapPathList.push(t),this.m_loadingMapPathList.length>1)return!1;if(this.mFileName==t)return egret.callLater(this.onLoadMapFinish,this),!0;this.mFileName=t,this.mUserData=e,this.m_bBeginLoadTileImage=!1,this.m_loadingTileImageList=[];var i=this.mFileName.concat("index.xml"),r=this,o={onResItemLoad:function(e){r.onLoadMapXml(e.getData(),t)},onResItemError:function(t){}};return this.mResMgr.loadResAsyn(i,o,core.ResourceType.TYPE_TEXT),!0},r.prototype.onLoadMapXml=function(e,i){TLog.Assert(this.mFileName==i);var r=new t.MapData;this.mMapData=r;var o=TXML.parse(e);r.mapId=TXML.queryIntText(TXML.findChild(o,"id"),-1),r.mapName=TXML.queryText(TXML.findChild(o,"name")),r.colNum=TXML.queryIntText(TXML.findChild(o,"colNum"),-1),r.rowNum=TXML.queryIntText(TXML.findChild(o,"rowNum"),-1),r.tileWidth=TXML.queryIntText(TXML.findChild(o,"tileWidth"),-1),r.tileHeight=TXML.queryIntText(TXML.findChild(o,"tileHeight"),-1),r.layerNum=TXML.queryIntText(TXML.findChild(o,"layerNum"),-1);for(var n=this,a={onResItemLoad:function(t){for(var e=n.mMapData.layerDataList,i=e.length,r=!0,o=0;i>o;o++){var a=e[o];a.layerFileName==t.getKey()&&(a.layerStream=new BinaryStream(t.getData()),a.layerStream.setNetMode(!1),a.resItem=t,t.retain()),null==a.layerStream&&(r=!1)}r&&n.onLoadMapImp()},onResItemError:function(t){TLog.Error("LoadMapError:"+t)}},s=0;s<r.layerNum;s++){var h=TXML.queryIntText(TXML.findChild(o,"type"+s)),l=TXML.queryIntText(TXML.findChild(o,"id"+s)),p=this.mFileName.concat(h+"_"+l+".dat"),u=new t.MapLayerData(l,h,p);r.layerDataList.push(u),this.mResMgr.loadResAsyn(p,a,core.ResourceType.TYPE_BIN)}},r.prototype._loadMapMetaData=function(t){var e=(t.readByte(),t.readShort(),t.readString()),i=4294918945,r=t.readUInt();if(r!=i)return!1;for(var o=(t.readUInt(),t.readUInt(),t.readUInt()),n=t.readUInt(),a=(t.readUShort(),t.readByte(),t.readShort()),s=0;a>s;s++){t.readInt(),t.readByte()}var h=[];h.length=o*n;for(var s=0;o*n>s;s++)h[s]=t.readByte();return"block"==e?this.m_pPathMgr.RefreshLogicBlock(o,n,h):"mask"==e&&this.m_pLogicMask.ReloadMask(o,n,h),!0},r.prototype.onLoadMapImp=function(){var e=this,i=this.mTileMap,r=this.mMapData;i.setId(r.mapId),i.setName(r.mapName),i.setMapSize(r.colNum,r.rowNum,r.tileWidth,r.tileHeight);for(var o=0;o<this.mMapLayerList.length;o++){var n=this.mMapLayerList[o];i.removeLayer(n),n.deleteObj()}this.mMapLayerList.length=0;var a=i.getMapWidth(),s=i.getMapHeight(),h=t.LogicBlock.getCellX(a),l=t.LogicBlock.getCellX(s);this.m_pPathMgr.ResetLogicBlock(h,l),this.m_pLogicMask.ResetMask(h,l),r.layerDataList.forEach(function(r){var o=r.layerStream,n=o.readByte();o.position=0;var a=0,s=null;switch(n){case t.MapLayerType.TileLayerType:s=t.MapTileLayer.newObj(i),s.load(o),s.setZOrder(a),a++;break;case t.MapLayerType.MetaLayerType:e._loadMapMetaData(o);break;case t.MapLayerType.AreaLayerType:s=t.MapAreaElemLayer.newObj(i),s.load(o),s.setZOrder(a),a++}s&&(s.initEyeshot(i.getMapWidth(),i.getMapHeight(),t.EyeGridSize,t.EyeGridSize),i.addLayer(s),e.mMapLayerList.push(s))}),this.mbLayersOrderChange=!0,this.getCamera().setViewChanged(!0),i.updateCameraView(),this.mMapData.clear(),this.mMapData=null,this.onLoadMapFinish()},r.prototype.onLoadMapFinish=function(){var i=this.m_loadingMapPathList.indexOf(this.mFileName);if(-1!=i&&this.m_loadingMapPathList.splice(i,1),this.m_loadingMapPathList.length>0){var r=this.m_loadingMapPathList.pop();this.m_loadingMapPathList=[],this.loadMap(r)}else this.fireEvent(t.MapEvent.LOAD_MAP_FINISH,e.newObj(this.mUserData))},r.prototype.addSpriteLayer=function(t,e){e.setTag(t),e.setZOrder(t),this.mTileMap.addLayer(e),this.mbLayersOrderChange=!0},r.prototype.removeSpriteLayer=function(t){this.mTileMap.removeLayer(t)&&t.setTag(-1),this.mbLayersOrderChange=!0},r.prototype.getSpriteLayer=function(e){for(var i=this.mTileMap.mLayerList,r=i.length,o=0;r>o;o++){var n=i[o];if(n instanceof t.SpriteLayer){var a=n;if(a.getTag()==e)return a}}return null},r.prototype.enterMap=function(t,e){var i=this.getSpriteLayer(e);return i?i.addSprite(t):!1},r.prototype.leaveMap=function(t){var e=t.getLayer();return e?e.removeSprite(t):!1},r.prototype.changeMapLayer=function(t,e){var i=this.getSpriteLayer(e);TLog.Assert(null!=i);var r=t.getLayer();return null==i||null==r||i==r?!1:(r.removeSprite(t),void i.addSprite(t))},r.prototype.getPathMgr=function(){return this.m_pPathMgr},r.prototype.getLogicMask=function(){return this.m_pLogicMask},r.prototype.getLogicBlock=function(){return this.m_pLogicBlock},r.prototype.setStaticImage=function(t,e,i,r){this.mStaticImageMap[t]={path:e,width:e,height:r}},r.prototype.getStaticImagePath=function(t){var e=this.mStaticImageMap[t];return e?e.path:""},r.prototype.addAreaAnimConfig=function(t,e,i,r){0>=r&&(r=1),this.mAreaAnimMap[t]={path:e,delay:i,scale:r}},r.prototype.getAreaAnimConfig=function(t){return this.mAreaAnimMap[t]},r.prototype.addAreaParticleConfig=function(t,e){this.mAreaParticleMap[t]={path:e}},r.prototype.getAreaParticleConfig=function(t){return this.mAreaParticleMap[t]},r}(core.EventSet);t.MapManager=i,__reflect(i.prototype,"map.MapManager")}(map||(map={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.url=t[0],this.bSucceed=t[1]==egret.Event.COMPLETE,this.response=t[2],this.listen_list=t[3]},e.prototype.destory=function(){this.listen_list=null,this.response=null},e}(TClass);t.HttpResult=e,__reflect(e.prototype,"core.HttpResult");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._dataFormat=i.FORMAT_TEXT,this._resultList=[],this._recycler=[],this.mRequestId2Url={},this.mUrl2ListernList={}},i.prototype.destory=function(){},i.prototype.send=function(t,e,i){var r=this.mUrl2ListernList[t];null==r&&(this.mUrl2ListernList[t]=r=[]);for(var o=r.length,n=0;o>n;n++){var a=r[n];if(a.callback==e&&a.userData==i)return void TLog.Debug("HttpClient send already exsit:%s",t)}if(r.push({callback:e,userData:i}),!(r.length>1)){var s=this.getRequest();s.open(t),s.send(),this.mRequestId2Url[s.hashCode]=t}},i.prototype.cancel=function(t){for(var e in this.mUrl2ListernList){var i=this.mUrl2ListernList[e];if(i)for(var r=0;r<i.length;r++){var o=i[r];o.callback==t&&(o.callback=null)}}},i.prototype.setDataFormat=function(t){this._dataFormat=t},i.prototype.getRequest=function(){var t=this._recycler.pop();return t||(t=new egret.HttpRequest,t.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},i.prototype.onLoadFinish=function(t){var i=t.target,r=this.mRequestId2Url[i.hashCode],o=this.mUrl2ListernList[r];delete this.mRequestId2Url[i.hashCode],delete this.mUrl2ListernList[r],TLog.Assert(o);t.type==egret.Event.COMPLETE;this._resultList.push(e.newObj(r,t.type,i.response,o)),this._recycler.push(i)},i.prototype.onUpdate=function(){if(this._resultList.length>0){for(var t=this._resultList,e=0,i=t;e<i.length;e++){var r=i[e],o=r.url,n=r.response,a=r.bSucceed;r.listen_list.forEach(function(t){var e=t.callback;if(e){var i=t.userData;a?e.onHttpResponse(o,n,i):e.onHttpError(o,i)}}),r.deleteObj()}this._resultList.length=0}},i.FORMAT_BINARY=egret.HttpResponseType.ARRAY_BUFFER,i.FORMAT_TEXT=egret.HttpResponseType.TEXT,i}(TClass);t.HttpClient=i,__reflect(i.prototype,"core.HttpClient")}(core||(core={}));var map;!function(t){function e(t){return Math.floor(t)}t.FLOOR=e,t.EyeGridSize=256;var i;!function(t){t[t.NullLayerType=0]="NullLayerType",t[t.TileLayerType=1]="TileLayerType",t[t.AdornmentLayerType=2]="AdornmentLayerType",t[t.MetaLayerType=3]="MetaLayerType",t[t.AreaLayerType=4]="AreaLayerType"}(i=t.MapLayerType||(t.MapLayerType={}));var r=function(){function t(t,e,i){this.layerFileName=i,this.layerId=t,this.layerType=e,this.layerStream=null,this.resItem=null}return t}();t.MapLayerData=r,__reflect(r.prototype,"map.MapLayerData");var o=function(){function t(){this.layerDataList=[]}return t.prototype.clear=function(){this.layerDataList.forEach(function(t){t.layerStream.clear(),t.resItem.release()}),this.layerDataList=null},t}();t.MapData=o,__reflect(o.prototype,"map.MapData")}(map||(map={}));var map;!function(t){function e(t){var e=t>>31;return t^=e,t-=e}function i(t){var e=t>>31,i=-t>>31;return e|-i}var r;!function(t){t[t.CellWidth=16]="CellWidth",t[t.CellHeight=16]="CellHeight",t[t.HalfCellWidth=8]="HalfCellWidth",t[t.HalfCellHeight=8]="HalfCellHeight"}(r||(r={}));var o=function(o){function n(){return null!==o&&o.apply(this,arguments)||this}return __extends(n,o),n.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bufferSize=0,this.buffer=[],this.width=0,this.height=0},n.prototype.destory=function(){},n.getCellX=function(e){return t.FLOOR(e/r.CellWidth)},n.getCellY=function(e){return t.FLOOR(e/r.CellHeight)},n.getXFromCell=function(t){return t*r.CellWidth+r.HalfCellWidth},n.getYFromCell=function(t){return t*r.CellHeight+r.HalfCellHeight},n.prototype.InitAreaLimit=function(){if(0!=this.width&&0!=this.height){var t=this.width*this.height,e=0,i=0;this.buffer.length=t;for(var r=0;t>r;r++)0==e||0==i||e==this.width-1||i==this.height-1?this.buffer[r]=1:this.buffer[r]=0,e++,e>=this.width&&(e=0,i++)}},n.prototype.SetBlock=function(t,e,i){0>t||0>e||t>=this.width||e>=this.height||(this.buffer[t+e*this.width]=i)},n.prototype.ClearBlock=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=0},n.prototype.IsBlock=function(t){return null!=this.buffer&&this.IsValid(t)?0!=this.buffer[t.x+t.y*this.width]:!0},n.prototype.IsValid=function(t){return t.x<0||t.x>=this.width||t.y<0||t.y>=this.height?!1:!0},n.prototype.HaveBlock=function(t,e){var i={};return this.FirstBlock(t,e,i)},n.prototype.FirstBlock=function(t,r,o){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var n=r.x-t.x,a=r.y-t.y,s=i(n),h=i(a);if(n=2*e(n),a=2*e(a),o.x=t.x,o.y=t.y,n>=a){var l=-(n>>1)+(a>>1);for(o.x+=s;o.x!=r.x;o.x+=s){if(0!=l&&this.IsBlock(o))return!0;if(l+=a,l>0&&(o.y+=h,l-=n,this.IsBlock(o)))return!0}}else{var l=-(a>>1)+(n>>1);for(o.y+=h;o.y!=r.y;o.y+=h){if(0!=l&&this.IsBlock(o))return!0;if(l+=n,l>0&&(o.x+=s,l-=a,this.IsBlock(o)))return!0}}return!1},n.prototype.FirstNotBlock=function(t,r,o){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var n=r.x-t.x,a=r.y-t.y,s=i(n),h=i(a);if(n=2*e(n),a=2*e(a),o.x=t.x,o.y=t.y,n>=a){var l=-(n>>1)+(a>>1);for(o.x+=s;o.x!=r.x;o.x+=s){if(0!=l&&!this.IsBlock(o))return!0;if(l+=a,l>0&&(o.y+=h,l-=n,!this.IsBlock(o)))return!0}}else{var l=-(a>>1)+(n>>1);for(o.y+=h;o.y!=r.y;o.y+=h){if(0!=l&&!this.IsBlock(o))return!0;if(l+=n,l>0&&(o.x+=s,l-=a,!this.IsBlock(o)))return!0}}return!1},n.prototype.LastBlock=function(t,r,o){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;if(!this.IsBlock(t))return!1;o=t;var n=t,a=r.x-t.x,s=r.y-t.y,h=i(a),l=i(s);if(a=2*e(a),s=2*e(s),a>=s){var p=-(a>>1)+(s>>1);for(n.x+=h;n.x!=r.x;n.x+=h){if(0!=p){if(!this.IsBlock(n))return!0;o=n}if(p+=s,p>0){if(n.y+=l,p-=a,!this.IsBlock(n))return!0;o=n}}}else{var p=-(s>>1)+(a>>1);for(n.y+=l;n.y!=r.y;n.y+=l){if(0!=p){if(!this.IsBlock(n))return!0;o=n}if(p+=a,p>0){if(n.x+=h,p-=s,!this.IsBlock(n))return!0;o=n}}}return!1},n.prototype.LastNotBlock=function(t,r,o){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var n=t.x-r.x,a=t.y-r.y,s=i(n),h=i(a);if(n=2*e(n),a=2*e(a),o.x=r.x,o.y=r.y,n>=a){var l=-(n>>1)+(a>>1);for(o.x+=s;o.x!=r.x;o.x+=s){if(0!=l&&!this.IsBlock(o))return!0;if(l+=a,l>0&&(o.y+=h,l-=n,!this.IsBlock(o)))return!0}}else{var l=-(a>>1)+(n>>1);for(o.y+=h;o.y!=r.y;o.y+=h){if(0!=l&&!this.IsBlock(o))return!0;if(l+=n,l>0&&(o.x+=s,l-=a,!this.IsBlock(o)))return!0}}return!1},n.prototype.MaxBlock=function(t,e){},n}(TClass);t.LogicBlock=o,__reflect(o.prototype,"map.LogicBlock")}(map||(map={}));var map;!function(t){function e(t){var e=t>>31;return t^=e,t-=e}function i(t,e){var i=t-e>>31;return t&=i,e&=~i,t|e}var r=function(){function t(){this.clear()}return t.prototype.clear=function(){this.h=0,this.x=0,this.y=0,this.f=0,this.next=null,this.father=null,this.next=null},t}();__reflect(r.prototype,"TLink");var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.distanceBuffer=[],this.closeListBuffer=[],this.openListBuffer=[],this.openNodeList=null,this.blockBuffer=[],this.linkBuffer={}},o.prototype.destory=function(){},o.prototype.ReLoad=function(t){this.distanceBuffer.length=0,this.closeListBuffer.length=0,this.openListBuffer.length=0,this.width=t.width,this.height=t.height;var e=this.width*this.height;return this.distanceBuffer.length=e,this.closeListBuffer.length=e,this.openListBuffer.length=e,this.blockBuffer=t.buffer,!0},o.prototype.memset=function(t,e){for(var i=0;i<t.length;i++)t[i]=e},o.prototype.Find=function(t,e,i){if(t.y<=0||e.y<=0)return 0;if(t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||e.x<0||e.x>=this.width||e.y<0||e.y>=this.height)return 0;this.memset(this.distanceBuffer,0),this.memset(this.closeListBuffer,!1),this.memset(this.openListBuffer,0),this.linkBuffer={};var r=t.x,o=t.y;this.endX=e.x,this.endY=e.y,this.openNodeList=null,this.iUsed=1,this.rootLink=null;var n=this.addOpenList(r,o);return n.h=0,n.father=null,n.f=this.judge(r,o),n.next=null,this.FindNext(i)},o.prototype.FindNext=function(t){for(var e=null,i=0;;){if(i>t)return 4294967295;if(e=this.getOpenLowestCostNode(),null==e)return 0;var r=e.x,n=e.y;if(r==this.endX&&n==this.endY)break;this.removeOpenList(r,n),this.addCloseList(r,n);var a=e.h+5;r+(n-1)*this.width;if(this.addNeighborNode(r,n-1,a,e),a+=2,this.addNeighborNode(r+1,n-1,a,e),this.addNeighborNode(r-1,n-1,a,e),a-=2,this.addNeighborNode(r-1,n,a,e),this.addNeighborNode(r+1,n,a,e),a+=2,this.addNeighborNode(r+1,n+1,a,e),this.addNeighborNode(r-1,n+1,a,e),a-=2,this.addNeighborNode(r,n+1,a,e),this.iUsed>=o.MAX_NODE-10)return 0;i++}this.rootLink=e;for(var s=e,h=0;s;)h++,s=s.father;return this.linkBuffer={},h},o.prototype.judge=function(t,r){var o=e(this.endX-t),n=e(this.endY-r);return 5*e(o-n)+7*i(o,n)},o.prototype.addNeighborNode=function(t,e,i,r){var o=t+e*this.width;if(!this.closeListBuffer[o]&&!this.blockBuffer[o])if(this.openListBuffer[o]){if(i<this.distanceBuffer[o]){var n=this.getOpenNode(t,e);n.father=r,n.h=i,n.f=i+this.judge(t,e),this.distanceBuffer[o]=i}}else{var a=this.addOpenList(t,e);a.father=r,a.h=i,a.f=i+this.judge(t,e),this.distanceBuffer[o]=i}},o.prototype.addCloseList=function(t,e){this.closeListBuffer[t+this.width*e]=!0},o.prototype.removeOpenList=function(t,e){var i=t+this.width*e,r=this.openListBuffer[i];if(0!=r){var o=this.linkBuffer[r];o.index=0,this.openListBuffer[i]=0}},o.prototype.addOpenList=function(t,e){var i=this.iUsed,o=this.linkBuffer[i];return null==o&&(o=new r,this.linkBuffer[i]=o),o.index=i,o.x=t,o.y=e,o.next=null,this.openListBuffer[t+this.width*e]=i,null==this.openNodeList?this.openNodeList=o:(o.next=this.openNodeList.next,this.openNodeList.next=o),this.iUsed++,o},o.prototype.getOpenNode=function(t,e){var i=t+this.width*e,r=this.openListBuffer[i];if(0==r)return null;var o=this.linkBuffer[r];return 0==o.index?null:o},o.prototype.getOpenLowestCostNode=function(){if(null==this.openNodeList)return null;for(var t=null,e=2147483647,i=this.openNodeList,r=null;i;)0!=i.index?(i.f<e&&(e=i.f,t=i),r=i,i=i.next):null==r?(this.openNodeList=i.next,i=this.openNodeList):(r.next=i.next,i=i.next);return t},o.prototype.GetPoint=function(t){if(null==this.rootLink)return!1;for(var e=this.rootLink,i=0;e;)i++,e=e.father;e=this.rootLink;var r;for(r=i-1;e;r--)t[r]={},t[r].x=e.x,t[r].y=e.y,e=e.father;return-1!=r?!1:!0},o.MAX_NODE=9e4,o}(TClass);t.LogicFinder=o,__reflect(o.prototype,"map.LogicFinder")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bufferSize=0,this.buffer=null,this.width=0,this.height=0,this.enable=!0},e.prototype.destory=function(){},e.prototype.ResetMask=function(t,e){this.buffer=null,this.width=t,this.height=e},e.prototype.ReloadMask=function(t,e,i){this.buffer=null,this.width=t,this.height=e,this.buffer=i},e.prototype.IsMask=function(t,e){return this.enable&&null!=this.buffer&&this.IsValid(t,e)?0!=this.buffer[t+e*this.width]:!1},e.prototype.IsValid=function(t,e){return 0>t||t>=this.width||0>e||e>=this.height?!1:!0},e.prototype.SetMaskEnable=function(t){this.enable=t},e}(TClass);t.LogicMask=e,__reflect(e.prototype,"map.LogicMask")}(map||(map={}));var map;!function(t){var e,i=1e3,r=0,o=0;!function(t){t[t.WLT_NORMAL=0]="WLT_NORMAL",t[t.WLT_START=1]="WLT_START",t[t.WLT_END=2]="WLT_END"}(e||(e={}));var n;!function(t){t[t.CP_NOTNEED=-1]="CP_NOTNEED",t[t.CP_FAIL=0]="CP_FAIL",t[t.CP_FINE=1]="CP_FINE",t[t.CP_FINDNEXT=2]="CP_FINDNEXT",t[t.CP_LOCKFIND=3]="CP_LOCKFIND"}(n||(n={}));var a=function(){function t(){}return t}();__reflect(a.prototype,"TWalkLine");var s=function(n){function s(){return null!==n&&n.apply(this,arguments)||this}return __extends(s,n),s.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.m_ptLastSend={},this.m_ptEnd={},this.m_pLine=null,this.m_bSended=!1,this.m_dwLastSendPosTime=0,this.m_ptLastSend.x=0,this.m_ptLastSend.y=0,this.m_iMidX=0,this.m_iMidY=0,this.m_bFindNext=!1,this.m_bSendPos=!1,this.m_iSpeed=12,this.m_iDropStep=0,this.m_iMaxStep=i,this.m_iDirNum=8,this.mFindPathState=0},s.prototype.destory=function(){},s.prototype.init=function(t,e){this.m_pBlock=t,this.m_pPathFinder=e},s.prototype.CreatePathLine=function(i,r,o,n,s){var h=r,l=i.length;this.m_iMaxLine=l-1,this.m_pLine=[],this.m_pLine.length=this.m_iMaxLine+1;for(var p=0;p<this.m_pLine.length;p++)this.m_pLine[p]=new a;this.firstUpdateTime=!0,this.timeOffset=0,this.m_pLine[0].iType|=e.WLT_START,this.m_pLine[0].uTimeStart=s,this.m_pLine[0].iDirStart=n,this.m_pLine[0].ptStart=r,this.m_pLine[this.m_iMaxLine-1].iType|=e.WLT_END;for(var p=0,u=1;u<i.length;u++){var m=i[u];m.x=t.LogicBlock.getXFromCell(m.x),m.y=t.LogicBlock.getYFromCell(m.y),0!=p&&(this.m_pLine[p].uTimeStart=this.m_pLine[p-1].uTimeEnd,this.m_pLine[p].iDirStart=this.m_pLine[p-1].iDir,this.m_pLine[p].ptStart=h),this.SetLine(m,this.m_iSpeed,this.m_pLine[p]),p++,h=m}i.length=0,this.m_ptEnd=h,this.m_iCurLine=0,this.m_iCurThousand=0},s.prototype.UpdateTime=function(t){this.m_iCurrentTime+=t},s.prototype.UpdatePos=function(t){return this._GetStateIsEnd(t,this.m_iCurrentTime)?(null!=this.m_pLine&&(t.dir=this.m_pLine[this.m_iMaxLine-1].iDir,t.x=this.m_ptEnd.x,t.y=this.m_ptEnd.y,this.m_pLine=null),!0):!1},s.prototype.Clear=function(){this.m_pLine=null,this.m_iMaxLine=0,this.firstUpdateTime=!1,this.timeOffset=0},s.prototype.SetSpeed=function(t){this.m_iSpeed=t},s.prototype.GetSpeed=function(){return this.m_iSpeed},s.prototype.SetLine=function(i,r,n){var a=i.x-n.ptStart.x,s=i.y-n.ptStart.y,h=Math.atan2(1.4142135623731*s,a),l=57.29577951307855*h,p=l;0>p&&(p+=360),n.iDir=p%360;var u=1600*r;n.dx=t.FLOOR(Math.cos(h)*u),n.dy=t.FLOOR(Math.sin(h)*u*.70710678118654);var m;if(m=0!=a?1e5*a/n.dx:0!=s?1e5*s/n.dy:1,n.iRotateSign=0,n.iDirStart!=n.iDir){var c=(n.iDir-n.iDirStart+360)%360;n.iRotateSign=1,c>360-c&&(n.iRotateSign=-1,c=360-c),n.iType&e.WLT_START&&(m+=c*o)}n.uTimeEnd=n.uTimeStart+m},s.prototype._GetStateIsEnd=function(i,n){if(null==this.m_pLine)return!0;var a=n;for(this.firstUpdateTime&&(this.timeOffset=a-this.m_pLine[0].uTimeStart,this.firstUpdateTime=!1),a-=this.timeOffset;this.m_iCurLine!=this.m_iMaxLine&&this.m_pLine[this.m_iCurLine].uTimeEnd<=a;)if(this.m_iCurThousand=0,this.m_iCurLine++,this.m_iCurLine==this.m_iMaxLine)return!0;var s=a-this.m_pLine[this.m_iCurLine].uTimeStart;if(0>s)return!0;var h=this.m_pLine[this.m_iCurLine].uTimeEnd-this.m_pLine[this.m_iCurLine].uTimeStart;h>0&&(this.m_iCurThousand=1e3*s/h);var l=this.m_pLine[this.m_iCurLine],p=((l.iDir-l.iDirStart)*l.iRotateSign+360)%360;if(i.x=l.ptStart.x,i.y=l.ptStart.y,l.iType&e.WLT_START){var u=p*o;if(!(s>=u)){var m=s/o;return 4==this.m_iDirNum&&(m=4294967294&m),i.dir=(l.iDirStart+m*l.iRotateSign+360)%360,!1}i.dir=l.iDir,s-=u}else{var u=p*r;if(s>=u)i.dir=l.iDir;else{var m=s/r;4==this.m_iDirNum&&(m=4294967294&m),i.dir=t.FLOOR(l.iDirStart+m*l.iRotateSign+360)%360}}i.x=i.x+l.dx*s/1e5,i.y=i.y+l.dy*s/1e5},s}(TClass);t.LogicPath=s,__reflect(s.prototype,"map.LogicPath")}(map||(map={}));var map;!function(t){var e;!function(t){t[t.eFindPathType_Succeed=1]="eFindPathType_Succeed",t[t.eFindPathType_FindNext=2]="eFindPathType_FindNext",t[t.eFindPathType_Fail=3]="eFindPathType_Fail",t[t.eFindPathType_Findind=4]="eFindPathType_Findind",t[t.eFindPathType_FindNotHandle=5]="eFindPathType_FindNotHandle"}(e=t.FindPathType||(t.FindPathType={}));var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.m_pPathFinder=t.LogicFinder.newObj(),this.m_pBlock=t.LogicBlock.newObj(),this.m_bBusy=!1},r.prototype.destory=function(){},r.prototype.createLogicPath=function(){var e=t.LogicPath.newObj();return e.init(this.m_pBlock,this.m_pPathFinder),e},r.prototype.releaseLogicPath=function(t){t&&(this.clearPath(t),t.deleteObj())},r.prototype.createPath=function(t,i,r,o,n,a){t.m_iStartX=i.x,t.m_iStartY=i.y,t.m_iEndX=r.x,t.m_iEndY=r.y,t.m_iMaxStep=n,t.m_bIgnoreBlock=a,t.m_iStartDir=o,t.m_iCurrentTime=0,this.m_pCurLogicPath==t&&(this.m_pCurLogicPath.Clear(),this.m_pCurLogicPath=null);var s={};if(t.mFindPathState=this.TryNoBlockPath(i,r,a,s),e.eFindPathType_Fail==t.mFindPathState)return e.eFindPathType_Fail;if(s.bNoBlock){var h=i,l=r,p=[];return p.push(s.ptTrueStart),p.push(s.ptTrueEnd),t.CreatePathLine(p,h,l,o,t.m_iCurrentTime),e.eFindPathType_Succeed}return this.CheckFindPathState(t)},r.prototype.updatePath=function(i,r){return i.mFindPathState==e.eFindPathType_Succeed?r.bStop=i.UpdatePos(r):i.mFindPathState!=e.eFindPathType_Fail&&this.CheckFindPathState(i),null!=r.x&&null!=r.y&&(r.x=t.FLOOR(r.x),r.y=t.FLOOR(r.y)),i.mFindPathState},r.prototype.clearPath=function(t){this.m_pCurLogicPath&&this.m_pCurLogicPath==t&&(t.Clear(),this.m_pCurLogicPath=null)},r.prototype.getLogicBlock=function(){return this.m_pBlock},r.prototype.TryNoBlockPath=function(i,r,o,n){var a={},s={};if(a.x=t.LogicBlock.getCellX(i.x),a.y=t.LogicBlock.getCellX(i.y),s.x=t.LogicBlock.getCellX(r.x),s.y=t.LogicBlock.getCellX(r.y),n.ptTrueStart=a,n.ptTrueEnd=s,n.bNoBlock=!1,o);else{if(!this.m_pBlock.IsValid(a))return e.eFindPathType_Fail;if(!this.m_pBlock.IsValid(s))return e.eFindPathType_Fail;if(this.m_pBlock.IsBlock(a)){var h={};this.m_pBlock.FirstNotBlock(a,s,h)&&(a.x=h.x,a.y=h.y)}if(this.m_pBlock.IsBlock(a))return e.eFindPathType_Fail;if(this.m_pBlock.IsBlock(s)){var l={};this.m_pBlock.LastNotBlock(a,s,l)&&(s.x=l.x,s.y=l.y)}if(this.m_pBlock.IsBlock(s))return e.eFindPathType_Fail}return a.x==s.x&&a.y==s.y?e.eFindPathType_Fail:((o||!this.m_pBlock.HaveBlock(a,s))&&(n.bNoBlock=!0),e.eFindPathType_Succeed)},r.prototype.CheckFindPathState=function(t){var i={},r={};i.x=t.m_iStartX,i.y=t.m_iStartY,r.x=t.m_iEndX,r.y=t.m_iEndY;var o=t.m_iMaxStep,n=t.m_bIgnoreBlock,a=t.m_iStartDir,s=!1,h=!1;
if(0==this.m_bBusy?(TLog.Assert(null==this.m_pCurLogicPath),s=!0):this.m_pCurLogicPath!=t?t.mFindPathState=e.eFindPathType_FindNotHandle:t.mFindPathState==e.eFindPathType_FindNext&&(h=!0,s=!0),s){var l=!1,p=null,u=[],m=0;m=h?this.FindPathNext(o,u):this.FindPathPointList(i,r,o,n,u),m==e.eFindPathType_Succeed?(t.CreatePathLine(u,i,r,a,t.m_iCurrentTime),t.mFindPathState=e.eFindPathType_Succeed):m==e.eFindPathType_FindNext?(t.mFindPathState=e.eFindPathType_FindNext,p=t,l=!0):t.mFindPathState=e.eFindPathType_Fail,this.m_pCurLogicPath=p,this.m_bBusy=l}return t.mFindPathState},r.prototype.FindPathPointList=function(t,i,r,o,n){var a={};return e.eFindPathType_Fail==this.TryNoBlockPath(t,i,o,a)?e.eFindPathType_Fail:(n.length=0,a.bNoBlock?(n.push(a.ptTrueStart),n.push(a.ptTrueEnd),e.eFindPathType_Succeed):this.FindPath(a.ptTrueStart,a.ptTrueEnd,r,n))},r.prototype.FindPath=function(t,i,r,o){var n=this.m_pPathFinder.Find(t,i,r);return 0==n?e.eFindPathType_Fail:4294967295==n?e.eFindPathType_FindNext:0==this.GetPathPoint(n,o)?e.eFindPathType_Fail:e.eFindPathType_Succeed},r.prototype.FindPathNext=function(t,i){var r=this.m_pPathFinder.FindNext(t);return 0==r?e.eFindPathType_Fail:4294967295==r?e.eFindPathType_FindNext:0==this.GetPathPoint(r,i)?e.eFindPathType_Fail:e.eFindPathType_Succeed},r.prototype.GetPathPoint=function(t,e){var i=[];if(!this.m_pPathFinder.GetPoint(i))return!1;if(e.push(i[0]),this.m_pBlock.HaveBlock(i[0],i[t-1])){var r=void 0,o=void 0,n=void 0,a=void 0;for(r=0;t-1>r;){if(o=r+1,n=t-1,0==r||this.m_pBlock.HaveBlock(i[r],i[n])){for(;n>o;)a=o+n>>1,this.m_pBlock.HaveBlock(i[r],i[a])?n=a-1:o=a+1;this.m_pBlock.HaveBlock(i[r],i[n])&&n--}e.push(i[n]),r=n}}else e.push(i[t-1]);return!0},r.prototype.ResetLogicBlock=function(t,e){this.m_pBlock.width=t,this.m_pBlock.height=e,this.m_pBlock.InitAreaLimit(),this.m_pPathFinder.ReLoad(this.m_pBlock)},r.prototype.RefreshLogicBlock=function(t,e,i){var r=t*e;0!=r&&(this.m_pBlock.buffer.length=0,this.m_pBlock.width=t,this.m_pBlock.height=e,this.m_pBlock.buffer=i,this.m_pPathFinder.ReLoad(this.m_pBlock))},r}(TClass);t.PathMgr=i,__reflect(i.prototype,"map.PathMgr")}(map||(map={}));var RES;!function(t){var e;!function(e){function i(){var e=core.ResManager.getInstance(),i=t.Resource.prototype.getResByUrl;t.Resource.prototype.getResByUrl=function(t,r,o,n){return void 0===n&&(n=""),i.call(this,t,r,o,n)["catch"](function(i){e.onResByUrlError(t,i)})}}e._init=i}(e=t.override||(t.override={}))}(RES||(RES={}));var egret;!function(t){var e;!function(e){function i(){var e=core.ErrorReport.getInstance();window.onerror=function(t,e,i,r,o){console.error("=== unexception ===",o),core.ErrorReport.getInstance().captureError(o)};var i=t.sys.SystemTicker.prototype.update;t.sys.SystemTicker.prototype.update=function(){var t=e.isReportEnable();if(t)try{i.call(this)}catch(r){core.ErrorReport.getInstance().captureError(r)}else i.call(this)};var o=t.EventDispatcher.prototype.$notifyListener;t.EventDispatcher.prototype.$notifyListener=function(t,i){var r=!1,n=e.isReportEnable();if(n)try{o.call(this,t,i)}catch(a){core.ErrorReport.getInstance().captureError(a)}else o.call(this,t,i);return r};var n=t.ImageLoader.prototype.onBlobLoaded;t.ImageLoader.prototype.onBlobLoaded=function(t){this.request&&n.call(this,t)};var a=t.DisplayObject,s=core.TextureManager.getInstance(),h=t.TextField.prototype.$onAddToStage;t.TextField.prototype.$onAddToStage=function(t,e){h.call(this,t,e),s.removeCleanTextNode(this.textNode)};t.TextField.prototype.$onRemoveFromStage;t.TextField.prototype.$onRemoveFromStage=function(){a.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&(s.addCleanTextNode(this.textNode),t.nativeRender&&egret_native.NativeDisplayObject.disposeTextData(this))};var l=core.TextureManager.getInstance();t.Graphics.prototype.$onRemoveFromStage;t.Graphics.prototype.$onRemoveFromStage=function(){this.$renderNode&&l.addCleanGraphic(this),t.nativeRender&&egret_native.NativeDisplayObject.disposeGraphicData(this)};var p=t.DisplayObjectContainer.prototype.$setVisible;t.DisplayObjectContainer.prototype.$setVisible=function(t){var e=this.$visible;p.call(this,t),e!=t&&this.onParentVisible(t)},t.DisplayObjectContainer.prototype.onParentVisible=function(t){for(var e=0;e<this.$children.length;e++){var i=this.$children[e];null!=i.onParentVisible&&i.onParentVisible.call(i,t)}},r(t.web),r(t.wxgame)}function r(t){if(t&&t.WebGLRenderTarget){var e=null,i=t.WebGLRenderTarget.prototype.initFrameBuffer;t.WebGLRenderTarget.prototype.initFrameBuffer=function(){null==e&&(e=t.WebGLRenderContext.getInstance(0,0)),e.contextLost||i.call(this)}}}e._init=i}(e=t.override||(t.override={}))}(egret||(egret={}));var map;!function(t){var e;!function(t){t[t.OPTIMIZE_UPDATE_ONSEE=1]="OPTIMIZE_UPDATE_ONSEE",t[t.OPTIMIZE_MOVEMENT_ONSEE=2]="OPTIMIZE_MOVEMENT_ONSEE",t[t.OPTIMIZE_HIDE_ONMAXACTOR=4]="OPTIMIZE_HIDE_ONMAXACTOR",t[t.OPTIMIZE_LOAD_SYN=8]="OPTIMIZE_LOAD_SYN"}(e=t.OptimizeFlag||(t.OptimizeFlag={}));var i;!function(t){t[t.MOVEMENT_PIXEL_CHANGED=1]="MOVEMENT_PIXEL_CHANGED",t[t.MOVEMENT_CELL_CHANGED=2]="MOVEMENT_CELL_CHANGED",t[t.MOVEMENT_DIR_CHANGED=4]="MOVEMENT_DIR_CHANGED",t[t.MOVEMENT_BEGIN_RUN=256]="MOVEMENT_BEGIN_RUN",t[t.MOVEMENT_STOPING=512]="MOVEMENT_STOPING",t[t.MOVEMENT_TRACE_PATH=1024]="MOVEMENT_TRACE_PATH",t[t.ANIM_NOTIFY=262144]="ANIM_NOTIFY"}(i=t.MoveReportFlag||(t.MoveReportFlag={}));var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actor=null,this.pathList=null,this.pathListMaxNum=0,this.pathListNum=0,this.walkOnPathIndex=0,this.walkOnPathThousand=0},e.prototype.destory=function(){},e.prototype.pixelChanged=function(){return 0!=(this.flag&i.MOVEMENT_PIXEL_CHANGED)},e.prototype.dirChanged=function(){return 0!=(this.flag&i.MOVEMENT_DIR_CHANGED)},e.prototype.cellChanged=function(){return 0!=(this.flag&i.MOVEMENT_CELL_CHANGED)},e.prototype.isStoping=function(){return 0!=(this.flag&i.MOVEMENT_STOPING)},e.prototype.beginRun=function(){return 0!=(this.flag&i.MOVEMENT_BEGIN_RUN)},e.MovementEvent="MovementEvent",e}(core.EventArgs);t.SpriteMovEvent=r,__reflect(r.prototype,"map.SpriteMovEvent")}(map||(map={}));var core;!function(t){var e;!function(t){t[t.Connect=0]="Connect",t[t.Close=1]="Close",t[t.Normal=2]="Normal"}(e=t.NetWorkResultState||(t.NetWorkResultState={}));var i;!function(t){t[t.MSG_NULL=0]="MSG_NULL",t[t.CMSG_PING=1]="CMSG_PING",t[t.SMSG_PONG=2]="SMSG_PONG",t[t.CMSG_REGION_NOTICE=9]="CMSG_REGION_NOTICE",t[t.CMSG_COMM=10]="CMSG_COMM",t[t.CMSG_LOGIN=11]="CMSG_LOGIN",t[t.SMSG_LOGIN=12]="SMSG_LOGIN",t[t.CMSG_LOGOUT=13]="CMSG_LOGOUT",t[t.SMSG_LOGOUT=14]="SMSG_LOGOUT",t[t.CMSG_LOGIN_USER=15]="CMSG_LOGIN_USER",t[t.SMSG_LOGIN_USER=16]="SMSG_LOGIN_USER"}(i||(i={}));var r;!function(t){t[t.C2L_CONNECT=17]="C2L_CONNECT",t[t.L2C_CONNECT=18]="L2C_CONNECT",t[t.C2L_STATE=22]="C2L_STATE",t[t.L2C_STATE=23]="L2C_STATE",t[t.C2L_VERSION=24]="C2L_VERSION",t[t.L2C_VERSION=25]="L2C_VERSION",t[t.C2L_VERVIFY_CODE=26]="C2L_VERVIFY_CODE",t[t.L2C_VERVIRY_CODE=27]="L2C_VERVIRY_CODE",t[t.C2L_ROLE_SELECT=28]="C2L_ROLE_SELECT",t[t.L2C_ROLE_SELECT=29]="L2C_ROLE_SELECT",t[t.C2L_ROLE_LIST=30]="C2L_ROLE_LIST",t[t.L2C_ROLE_LIST=31]="L2C_ROLE_LIST",t[t.C2L_ROLE_CREATE=32]="C2L_ROLE_CREATE",t[t.L2C_ROLE_CREATE=33]="L2C_ROLE_CREATE",t[t.C2L_ROLE_DELETE=34]="C2L_ROLE_DELETE",t[t.L2C_ROLE_DELETE=35]="L2C_ROLE_DELETE",t[t.L2C_QUEUE_UPDATE=36]="L2C_QUEUE_UPDATE",t[t.LOGIN_MSG_COUNT=37]="LOGIN_MSG_COUNT"}(r||(r={}));var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.state=0,this.code=0,this.buffer=null},e.prototype.destory=function(){this.buffer=null},e}(TClass);t.NetWorkResult=o,__reflect(o.prototype,"core.NetWorkResult");var n="`#$X1_+%,aBVx}@8",a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetConnectEvent=a,__reflect(a.prototype,"core.NetConnectEvent");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetCloseEvent=s,__reflect(s.prototype,"core.NetCloseEvent");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetRecvEvent=h,__reflect(h.prototype,"core.NetRecvEvent");var l=function(r){function l(){var t=null!==r&&r.apply(this,arguments)||this;return t.PACKET_HEADER_SIZE=4,t.SHORT_SIZE=2,t}return __extends(l,r),l.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mRecvBuffer=new BinaryStream,this.mRecvResultList=[],this.socket=this.createSocket(),this.mWriteBuffer=new BinaryStream,this.mWriteBuffer.setNetMode(!1),this.mConnecting=!1,this.mSocketError=!1,this.mClosing=!1,this.m_encryptKey=n,this.m_decryptKey=n,this.m_encrypt=!0,this.m_decrypt=!0,this.m_encryptSeed=25,this.m_decryptSeed=25,this.m_serialNumber=0,this.m_initSerialNumber=!1,this.m_sendSerialNumber=!1},l.prototype.destory=function(){this.destorySocket(),this.mRecvBuffer.clear(),this.mRecvBuffer=null,this.mWriteBuffer.clear(),this.mWriteBuffer=null},l.prototype.createSocket=function(){var t=new egret.WebSocket;return t.type=egret.WebSocket.TYPE_BINARY,t.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),t.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),t.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),t},l.prototype.destorySocket=function(){if(this.socket){var t=this.socket;t.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),t.removeEventListener(egret.ProgressEvent.CONNECT,this.onSocketOpen,this),t.removeEventListener(egret.ProgressEvent.CLOSE,this.onSocketClose,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),0==this.mClosing&&t.close(),this.socket=null}},l.prototype.connect=function(t,e){if(this.isConnect())return void TLog.Error("connect has not been close:",t+":"+e);this.destorySocket(),this.socket=this.createSocket();var i="ws://",r=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(t);return 0==r&&egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME&&(i="wss://"),this.socket.connectByUrl(i+t+":"+e),this.mClosing=!1,this.mConnecting=!0,this.mSocketError=!1,!0},l.prototype.disconnect=function(){return 0==this.isConnect()?!1:(this.mClosing=!0,this.mConnecting=!1,this.mSocketError=!1,this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.ProgressEvent.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.ProgressEvent.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.close(),!0)},l.prototype.isConnect=function(){return 1==this.mClosing?!1:this.socket.connected},l.prototype.beginPack=function(){return this.mWriteBuffer.clear(),this.mWriteBuffer},l.prototype.endPack=function(){if(0==this.isConnect())return void this.mWriteBuffer.clear();null==this.net_temp&&(this.net_temp=new Uint8Array(65536));var e=this.mWriteBuffer.length,r=this.mWriteBuffer.bytes,o=this.mWriteBuffer.dataView,n=o.getInt16(0,!0);if(n>=17&&27>=n||0==this.m_encrypt){var a=e,s=new BinaryStream;s.writeUnsignedShort(a),s.writeBytes(this.mWriteBuffer,0,e),this.sendBuffer(s),s.clear()}else{var h=new Uint8Array(r.buffer,2),l=e-2;if(this.m_sendSerialNumber){var p=0;this.m_initSerialNumber&&n!=i.CMSG_PING&&(p=this.m_serialNumber,++this.m_serialNumber,0==this.m_serialNumber&&(this.m_serialNumber=1));var u=new DataView(this.net_temp.buffer);u.setUint32(0,p,!0),this.net_temp.set(h,4),h=this.net_temp,l+=4}var m=null;if(l>0){var c=new Uint8Array(17);c[16]=0;for(var d=13,f=64,g=this.m_encryptSeed,y=0;16>y;++y)c[y]=g+33,g=g*d%f;m=t.xxteaEncrypt(h,l,c)}var v=new BinaryStream,a=m.length+2;if(v.writeUnsignedShort(a),v.writeUnsignedShort(n),m.length>0){var T=new BinaryStream(m.buffer);v.writeBytes(T)}this.sendBuffer(v),v.clear()}return this.mWriteBuffer.clear(),!0},l.prototype.sendBuffer=function(t){var e=t.dataView,i=e.getUint16(0,!0);e.setUint16(0,i,!1),this.socket.writeBytes(t)},l.prototype.setEncrypt=function(t,e){this.m_encrypt=t,this.m_decrypt=e},l.prototype.setSeed=function(t,e){this.m_encryptSeed=t,this.m_decryptSeed=e},l.prototype.setSendSerialNumber=function(t){this.m_sendSerialNumber=t},l.prototype.getLastErrorCode=function(){return this.mSocketError?-1:0},l.prototype.onSocketOpen=function(){var t=o.newObj();t.state=e.Connect,t.code=this.getLastErrorCode(),this.mRecvResultList.push(t),this.mRecvBuffer.clear(),this.mClosing=!1,this.mConnecting=!1},l.prototype.onSocketClose=function(){var t=o.newObj();t.state=this.mConnecting?e.Connect:e.Close,t.code=this.mClosing?0:-1,this.mSocketError&&(t.code=-1),this.mRecvResultList.push(t),this.mClosing=!1},l.prototype.onSocketError=function(){this.mSocketError=!0,this.mClosing=!0},l.prototype.onReceiveMessage=function(t){var i=new BinaryStream;this.socket.readBytes(i),this.mRecvBuffer.writeBytes(i);for(var r=new DataView(this.mRecvBuffer.buffer),n=!1,a=this.mRecvBuffer.position;a>=this.PACKET_HEADER_SIZE;){var s=r.getUint16(0,n),h=s+this.SHORT_SIZE;if(h>a)break;var l=o.newObj();l.state=e.Normal,l.code=this.getLastErrorCode(),l.buffer=new BinaryStream,l.buffer.setNetMode(!1),l.buffer.writeBytes(this.mRecvBuffer,this.SHORT_SIZE,s),l.buffer.position=0,this.mRecvResultList.push(l);for(var p=0;a-h>p;p++)r.setUint8(p,r.getUint8(p+h));a-=h}this.mRecvBuffer.position=a},l.prototype.onUpdate=function(){if(0!=this.mRecvResultList.length){for(var t=0,i=this.mRecvResultList;t<i.length;t++){var r=i[t];switch(r.state){case e.Connect:var o=a.createObj();o.code=r.code,o.net=this,this.fireEvent(l.ConnectEvent,o);break;case e.Close:var n=s.createObj();n.code=r.code,n.net=this,this.fireEvent(l.CloseEvent,n);break;case e.Normal:this.fireNetMsg(r.buffer)}r.deleteObj()}this.mRecvResultList.length=0}},l.prototype.fireNetMsg=function(e){var r=e.dataView,o=e.length;if(!(o>65536)){var n=r.getUint16(0,!0);if(2>=o||n>=17&&27>=n||0==this.m_decrypt){var a=h.createObj();a.msgLen=e.length,a.reader=e,a.net=this,this.fireEvent(l.RecvEvent,a)}else{var s=new Uint8Array(e.rawBuffer,2),p=null,u=new Uint8Array(17);u[16]=0;for(var m=13,c=64,d=this.m_decryptSeed,f=0;16>f;++f)u[f]=d+33,d=d*m%c;if(p=t.xxteaDecrypt(s,o-2,u)){var g=new BinaryStream(p.buffer),y=new BinaryStream;y.writeUShort(n),n!=i.SMSG_LOGIN&&n!=i.SMSG_LOGIN_USER||!this.m_sendSerialNumber?g.readBytes(y,2):(this.m_serialNumber=g.readUnsignedInt(),this.m_initSerialNumber=!0,g.readBytes(y,2)),y.position=0;var a=h.createObj();a.msgLen=y.length,a.reader=y,a.net=this,this.fireEvent(l.RecvEvent,a)}}}},l.ConnectEvent="NetConnectEvent",l.CloseEvent="NetCloseEvent",l.RecvEvent="NetRecvEvent",l}(t.EventSet);t.NetWork=l,__reflect(l.prototype,"core.NetWork")}(core||(core={}));var map;!function(t){var e=function(e){function i(i){var r=e.call(this)||this;return r.mId=-1,r.mName="",r.mTileColNum=0,r.mTileRowNum=0,r.mTileWidth=0,r.mTileHeight=0,r.mapW=0,r.mapH=0,r.mLayerList=[],r.mCamera=new t.Camera(r),i.addChild(r.mCamera),r}return __extends(i,e),i.prototype.destory=function(){this.removeAllLayer()},i.prototype.addLayer=function(t){return-1!=this.mLayerList.indexOf(t)?!1:(this.mLayerList.push(t),this.mCamera.addNodeToCamera(t.getDisplayNode()),!0)},i.prototype.removeLayer=function(t){var e=this.mLayerList.indexOf(t);return-1==e?!1:(this.mLayerList.splice(e,1),this.mCamera.removeNodeFromCamera(t.getDisplayNode()),!0)},i.prototype.removeAllLayer=function(){for(var t=0;t<this.mLayerList.length;t++){var e=this.mLayerList[t];this.mCamera.removeNodeFromCamera(e.getDisplayNode()),e.deleteObj()}this.mLayerList.length=0},i.prototype.sortLayers=function(){if(!(this.mLayerList.length<=1)){this.mLayerList.sort(function(t,e){return t.getZOrder()-e.getZOrder()});for(var t=0;t<this.mLayerList.length;t++){var e=this.mLayerList[t];this.mCamera.mContainer.setChildIndex(e.getDisplayNode(),t)}this.mCamera.onLayersChange()}},i.prototype.setId=function(t){this.mId=t},i.prototype.getId=function(){return this.mId},i.prototype.setName=function(t){this.mName=t},i.prototype.getName=function(){return this.mName},i.prototype.getCamera=function(){return this.mCamera},i.prototype.setMapSize=function(t,e,i,r){this.mTileColNum=t,this.mTileRowNum=e,this.mTileWidth=i,this.mTileHeight=r,this.mapW=t*i,this.mapH=e*r},i.prototype.getMapWidth=function(){return this.mapW},i.prototype.getMapHeight=function(){return this.mapH},i.prototype.getTileColNum=function(){return this.mTileColNum},i.prototype.getTileRowNum=function(){return this.mTileRowNum},i.prototype.getTileWidth=function(){return this.mTileWidth},i.prototype.getTileHeight=function(){return this.mTileHeight},i.prototype.onUpdate=function(){this.mCamera.onUpdate(),this.updateCameraView()},i.prototype.updateCameraView=function(){for(var t=0,e=this.mLayerList;t<e.length;t++){var i=e[t];i.onUpdate(this.mCamera)}this.mCamera.setViewChanged(!1)},i}(TClass);t.TileMap=e,__reflect(e.prototype,"map.TileMap")}(map||(map={}));var map;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.name="camera",i.touchEnabled=!0,i.mContainer=new egret.DisplayObjectContainer,i.addChild(i.mContainer),i.mBScreenContainer=new egret.DisplayObjectContainer,i.mBScreenContainer.name="background",i.mContainer.addChild(i.mBScreenContainer),i.mFScreenContainer=new egret.DisplayObjectContainer,i.mFScreenContainer.name="foreground",i.mContainer.addChild(i.mFScreenContainer),i.mTileMap=t,i.mViewRect=new egret.Rectangle,i.mViewChanged=!0,i.mbAdjustView=!0,i.m_linkSprite=null,i.mTempPoint=new egret.Point,i.mFgColorLayer=new egret.Shape,i.mFgColorLayer.name="foreground_color",i.mBgColorLayer=new egret.Shape,i.mBgColorLayer.name="background_color",i.mBgImage=new egret.Bitmap,i.mFgImage=new egret.Bitmap,i.mScreenEffectList=[],i}return __extends(i,e),i.prototype.addNodeToCamera=function(t){this.mContainer.addChild(t)},i.prototype.removeNodeFromCamera=function(t){-1!=this.mContainer.getChildIndex(t)&&this.mContainer.removeChild(t)},i.prototype.isViewChanged=function(){return this.mViewChanged},i.prototype.setViewChanged=function(t){this.mViewChanged=t},i.prototype.setViewSize=function(t,e){(this.mViewRect.width!=t||this.mViewRect.height!=e)&&(this.mViewRect.width=t,this.mViewRect.height=e,this.anchorOffsetX=t/2,this.anchorOffsetY=e/2,this.x=t/2,this.y=e/2,this.adjustViewCenter())},i.prototype.getViewWidth=function(){return this.mViewRect.width},i.prototype.getViewHeight=function(){return this.mViewRect.height},i.prototype.setAdjustViewCenter=function(t){this.mbAdjustView=t},i.prototype.setViewCenter=function(t,e){TLog.Assert(null!=t&&null!=e&&0==isNaN(t)&&0==isNaN(e)),TLog.Assert(0!=this.mViewRect.width&&0!=this.mViewRect.height,"setViewCenter");var i=t-this.mViewRect.width/2,r=e-this.mViewRect.height/2;(i!=this.mViewRect.x||r!=this.mViewRect.y)&&(this.mViewRect.x=i,this.mViewRect.y=r,this.adjustViewCenter())},i.prototype.getViewCenterX=function(){return this.mViewRect.x+this.mViewRect.width/2},i.prototype.getViewCenterY=function(){return this.mViewRect.y+this.mViewRect.height/2},i.prototype.getViewBeginX=function(){return this.mViewRect.x},i.prototype.getViewBeginY=function(){return this.mViewRect.y},i.prototype.getViewRect=function(){return this.mViewRect},i.prototype.getAdjustCenter=function(t,e,i){var r=t,o=e;if(this.mbAdjustView){var n=this.mTileMap.getMapWidth(),a=this.mTileMap.getMapHeight(),s=this.mViewRect.width,h=s/2,l=this.mViewRect.height,p=l/2,u=n-h,m=a-p,c=h,d=p;s>=n&&(u=h,c=h),l>=a&&(m=p,d=p),t>u?r=u:c>t&&(r=c),e>m?o=m:d>e&&(o=d)}return i.setTo(r,o)},i.prototype.adjustViewCenter=function(){var t=this.mViewRect.width,e=t/2,i=this.mViewRect.height,r=i/2,o=this.mViewRect.x+e,n=this.mViewRect.y+r;this.getAdjustCenter(o,n,this.mTempPoint),this.mViewRect.x=this.mTempPoint.x-e,this.mViewRect.y=this.mTempPoint.y-r,this.width=t,this.height=i,this.mContainer.x=-this.mViewRect.x,this.mContainer.y=-this.mViewRect.y,this.mFgColorLayer.x=this.mViewRect.x,this.mFgColorLayer.y=this.mViewRect.y,this.mBgColorLayer.x=this.mViewRect.x,this.mBgColorLayer.y=this.mViewRect.y,this.mFScreenContainer.x=this.mViewRect.x,this.mFScreenContainer.y=this.mViewRect.y,this.mBScreenContainer.x=this.mViewRect.x,this.mBScreenContainer.y=this.mViewRect.y,this.mViewChanged=!0},i.prototype.setZoomScale=function(t){this.scaleX=this.scaleY=t},i.prototype.getZoomScale=function(){return this.scaleX},i.prototype.$hitTest=function(t,i){var r=e.prototype.$hitTest.call(this,t,i);if(null==r){if(!this.$visible||!this.touchEnabled)return null;var o=this.mContainer.$getInvertedConcatenatedMatrix(),n=o.a*t+o.c*i+o.tx,a=o.b*t+o.d*i+o.ty;this.mViewRect.contains(n,a)&&(r=this)}return r},i.prototype.stageXYToMapXY=function(t,e,i){var r=this.mContainer.$getInvertedConcatenatedMatrix();return r.transformPoint(t,e,i),i},i.prototype.mapXYToStageXY=function(t,e,i){var r=this.mContainer.$getConcatenatedMatrix();return r.transformPoint(t,e,i),i},i.prototype.linkMapSprite=function(t){this.unlinkMapSprite(),this.m_linkSprite=t,this.m_linkSprite.retain()},i.prototype.unlinkMapSprite=function(){this.m_linkSprite&&(this.m_linkSprite.release(),this.m_linkSprite=null)},i.prototype.updateLinkSprite=function(){if(null!=this.m_linkSprite){var t=this.m_linkSprite.getPositionX(),e=this.m_linkSprite.getPositionY();this.setViewCenter(t,e)}},i.prototype.onUpdate=function(){this.updateLinkSprite(),this.updateScreenEffect()},i.prototype.updateColor=function(t,e,i,r,o){var n=i<<16|r<<8|o;t.graphics.clear(),t.graphics.beginFill(n),t.graphics.drawRect(0,0,this.mViewRect.width,this.mViewRect.height),t.graphics.endFill(),t.alpha=e/255},i.prototype.setBgBlendColorEnable=function(t){t?(this.mContainer.addChild(this.mBgColorLayer),this.onLayersChange()):this.mBgColorLayer.parent&&this.mContainer.removeChild(this.mBgColorLayer)},i.prototype.setBgBlendColor=function(t,e,i,r){this.updateColor(this.mBgColorLayer,t,e,i,r)},i.prototype.setFgBlendColorEnable=function(t){t?(this.mContainer.addChild(this.mFgColorLayer),this.onLayersChange()):this.mFgColorLayer.parent&&this.mContainer.removeChild(this.mFgColorLayer)},i.prototype.setFgBlendColor=function(t,e,i,r){this.updateColor(this.mFgColorLayer,t,e,i,r)},i.prototype._setScreenImageImp=function(t,e,i){if(""==t||null==t)e.parent&&e.parent.removeChild(e);else{var r={onAsynTextureSucceed:function(t,i,r){e.texture=i}};i.addChildAt(e,0);var o=core.TextureManager.getInstance();o.loadTextureAsyn(t,r)}},i.prototype.setBgImage=function(t){return this._setScreenImageImp(t,this.mBgImage,this.mBScreenContainer),this.mBgImage},i.prototype.setFgImage=function(t){return this._setScreenImageImp(t,this.mFgImage,this.mFScreenContainer),this.mFgImage},i.prototype.onLayersChange=function(){for(var e=this.mContainer.$children,i=-1,r=0;r<e.length;r++){var o=e[r];if(o instanceof t.MapLayerDisplayerNode){i=r;break}}-1!=i?(this.mContainer.setChildIndex(this.mBScreenContainer,i+1),this.mBgColorLayer.parent&&this.mContainer.setChildIndex(this.mBgColorLayer,i+1)):(this.mContainer.setChildIndex(this.mBScreenContainer,0),this.mBgColorLayer.parent&&this.mContainer.setChildIndex(this.mBgColorLayer,0)),i=-1;for(var r=e.length-1;r>=0;r--){var o=e[r];if(o instanceof t.SpriteLayerDisplayerNode){i=r;break}}-1!=i&&(this.mContainer.setChildIndex(this.mFScreenContainer,i+1),this.mFgColorLayer.parent&&this.mContainer.setChildIndex(this.mFgColorLayer,i-1))},i.prototype.addScreenEffect=function(t,e){var r=this.mScreenEffectList.indexOf(t);return-1!=r?!1:(e==i.SCREEN_FOREGROUND?this.mFScreenContainer.addChild(t.getDisplayNode()):this.mBScreenContainer.addChild(t.getDisplayNode()),void this.mScreenEffectList.push(t))},i.prototype.removeScreenEffect=function(t){var e=this.mScreenEffectList.indexOf(t);if(-1==e)return!1;this.mScreenEffectList.splice(e,1);var i=t.getDisplayNode().parent;TLog.Assert(null!=i),i.removeChild(t.getDisplayNode())},i.prototype.updateScreenEffect=function(){if(0!=this.mScreenEffectList.length)for(var t=0,e=this.mScreenEffectList;t<e.length;t++){var i=e[t];i.retain(),i.onUpdate(null),i.release()}},i.SCREEN_BACKGROUND=0,i.SCREEN_FOREGROUND=1,i}(egret.DisplayObjectContainer);t.Camera=e,__reflect(e.prototype,"map.Camera")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.positionFromRect=function(t){this.x=t.left+t.width/2,this.y=t.top+t.height/2},e}(egret.DisplayObjectContainer);t.MapAreaElemDisplayNode=e,__reflect(e.prototype,"map.MapAreaElemDisplayNode");var i=function(e){function i(){var i=e.call(this)||this;return i.mMapMgr=t.MapManager.getInstance(),i.textureRes=null,i.jsonRes=null,i.mResMgr=core.ResManager.getInstance(),i.mTextureMgr=core.TextureManager.getInstance(),i}return __extends(i,e),i.prototype.clear=function(){this.textureRes&&(this.textureRes.release(),this.textureRes=null),this.jsonRes&&(this.jsonRes.release(),this.jsonRes=null),this.mResMgr.cancelResAsyn(this),this.mTextureMgr.cancelTextureAsynAll(this)},i.prototype.loadTextureAndJson=function(t,e){this.mTextureMgr.loadTextureAsyn(t,this),this.mResMgr.loadResAsyn(e,this,core.ResourceType.TYPE_JSON)},i.prototype.onAsynTextureSucceed=function(t,e,i){this.textureRes=i,this.textureRes.retain(),this.checkLoadComplete()},i.prototype.onResItemLoad=function(t){this.jsonRes=t,this.jsonRes.retain(),this.checkLoadComplete()},i.prototype.onResItemError=function(t){},i.prototype.checkLoadComplete=function(){this.textureRes&&this.jsonRes&&this.onLoadComplete()},i.prototype.onLoadComplete=function(){},i}(e);t.MapAreaElemResNode=i,__reflect(i.prototype,"map.MapAreaElemResNode",["core.ResItemCallback","core.TextureCallback"]);var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastTimeStamp=-1,e.frames=null,e.index=0,e.delay=200,e.during=0,e.animScale=1,e}return __extends(e,t),e.prototype.initWithName=function(t){var e=this.mMapMgr.getAreaAnimConfig(t);if(null==e||!e.path)return void TLog.Error("MapAreaAnimNode %s not exist",t);this.index=-1,this.delay=e.delay||200,this.animScale=e.scale,this.during=this.delay;var i=e.path;"/"!=i.charAt(i.length-1)&&(i+="/");var r=i+t+".png",o=i+t+".json";this.loadTextureAndJson(r,o)},e.prototype.clear=function(){t.prototype.clear.call(this),egret.stopTick(this.update,this),this.mFramesTexture=null},e.prototype.positionFromRect=function(t){this.x=t.x,this.y=t.bottom-t.height},e.prototype.onLoadComplete=function(){var t=this.jsonRes.getData();TLog.Assert(t.frames);var e=Object.keys(t.frames);e.sort(function(t,e){return t.localeCompare(e)}),this.frames=[];for(var i=0,r=e;i<r.length;i++){var o=r[i];this.frames.push(t.frames[o])}TLog.Assert(this.frames.length>0),this.mBitmap=new egret.Bitmap,this.addChild(this.mBitmap),this.lastTimeStamp=egret.getTimer(),this.mFramesTexture={},this.scaleX=this.animScale,this.scaleY=this.animScale,egret.startTick(this.update,this)},e.prototype.update=function(t){if(null==this.mFramesTexture)return!1;var e=t-this.lastTimeStamp;if(this.lastTimeStamp=t,this.during+=e,this.during>=this.delay){if(this.during=0,this.index++,this.index>=this.frames.length&&(this.index=0),null==this.mFramesTexture[this.index]){var i=this.frames[this.index],r=this.textureRes.getData(),o=new egret.Texture;o.$bitmapData=r.$bitmapData,o.$initData(i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH,r.$sourceWidth,r.$sourceHeight),this.mFramesTexture[this.index]=o}this.mBitmap.texture=this.mFramesTexture[this.index]}return!1},e}(i);t.MapAreaAnimNode=r,__reflect(r.prototype,"map.MapAreaAnimNode")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);t.MapLayerDisplayerNode=e,__reflect(e.prototype,"map.MapLayerDisplayerNode");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);t.SpriteLayerDisplayerNode=i,__reflect(i.prototype,"map.SpriteLayerDisplayerNode")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mRefCount=0,t}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mMapMgr=t.MapManager.getInstance()},i.prototype.destory=function(){this.clearNode(),this.mRefCount=0},i.prototype.initWithParam=function(t,e,i,r){this.mId=t,this.mName=e,this.mArea=i,this.mType=r},i.prototype.onElemFound=function(t){if(0==this.mRefCount){if(this.mRefCount++,null==this.mNode&&(this.mNode=this.createElemNode(this.mType,this.mName)),null==this.mNode)return void TLog.Error("MapAreaElem.onElemFound",this.mType,this.mName);t.getDisplayNode().addChild(this.mNode),this.mNode.positionFromRect(this.mArea)}},i.prototype.onElemLost=function(t){0!=this.mRefCount&&(this.mRefCount--,0==this.mRefCount&&this.clearNode())},i.prototype.clearNode=function(){this.mNode&&(this.mNode.parent&&this.mNode.parent.removeChild(this.mNode),this.mNode.clear(),this.mNode=null)},i.prototype.createElemNode=function(e,i){var r=null;return"frame_anim"==e&&(r=new t.MapAreaAnimNode),r&&r.initWithName(i),r},i}(TClass);t.MapAreaElem=e,__reflect(e.prototype,"map.MapAreaElem")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mAreaElemList=[],this.mGrid2ElemListMap={}},i.prototype.destory=function(){this.clearAllElems()},i.prototype.clearAllElems=function(){for(var t=0,e=this.mAreaElemList;t<e.length;t++){var i=e[t];i.destory()}this.mAreaElemList=null},i.prototype.load=function(i){e.prototype.load.call(this,i);for(var r=(i.readUInt(),i.readUInt()),o=0;r>o;++o)for(var n=i.readString(),a=i.readUInt(),s=0;a>s;++s){var h=i.readUInt(),l=i.readString(),p=new egret.Rectangle;p.left=i.readUInt(),p.top=i.readUInt(),p.right=i.readUInt(),p.bottom=i.readUInt();var u=t.MapAreaElem.newObj();u.initWithParam(h,l,p,n),this.mAreaElemList.push(u)}return!0},i.prototype.initEyeshot=function(t,i,r,o){e.prototype.initEyeshot.call(this,t,i,r,o),this.mGrid2ElemListMap={};for(var n=this.mLayerEyeshot.getGridWidth(),a=0,s=this.mAreaElemList;a<s.length;a++)for(var h=s[a],l=this.mLayerEyeshot.getGridByMapRect(h.mArea),p=l.left;p<=l.right;p++)for(var u=l.top;u<=l.bottom;u++){var m=p*n+u;null==this.mGrid2ElemListMap[m]&&(this.mGrid2ElemListMap[m]=[]),this.mGrid2ElemListMap[m].push(h)}},i.prototype.getMapAreaElem=function(t,e){var i=this.mLayerEyeshot.getGridWidth(),r=t*i+e;return this.mGrid2ElemListMap[r]},i.prototype.onEyeshotFound=function(t,e){var i=this.getMapAreaElem(t,e);if(i)for(var r=0,o=i;r<o.length;r++){var n=o[r];n.onElemFound(this)}},i.prototype.onEyeshotLost=function(t,e){var i=this.getMapAreaElem(t,e);if(i)for(var r=0,o=i;r<o.length;r++){var n=o[r];n.onElemLost(this)}},i}(t.MapLayerBase);t.MapAreaElemLayer=e,__reflect(e.prototype,"map.MapAreaElemLayer")}(map||(map={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResGroupMgr=t[0],this.mResItemMap={},this.mbLoaded=!1,this.mDelayTime=0,this.mDisposeTime=-1,this.mResCallback=null,this.mTextureCallback=null},i.prototype.destory=function(){this.unload(),this.mResItemMap=null},i.prototype.addResItemConfig=function(t,e){this.mResItemMap[t]={type:e,resItem:null}},i.prototype.setDisposeTime=function(t){this.mDisposeTime=t},i.prototype.onLoadComplete=function(){this.mDelayTime=0,this.mbLoaded=!0,this.mResCallback=null,this.mTextureCallback=null,this.mResGroupMgr._onGroupLoad(this.name)
},i.prototype.onSingleResSucceed=function(t,e,i){var r=this.mResItemMap[t.getKey()];return r&&(TLog.Assert(null==r.resItem),r.resItem=t,t.retain()),e++,e>=i&&this.onLoadComplete(),e},i.prototype.load=function(){var e=this;if(1==this.mbLoaded)return void egret.callLater(this.mResGroupMgr._onGroupLoad,this.mResGroupMgr,this.name);if(null==this.mResCallback||null==this.mTextureCallback){var i=this,r=Object.keys(this.mResItemMap).length,o=0,n={onResItemLoad:function(t){o=i.onSingleResSucceed(t,o,r)},onResItemError:function(t){o++,o>=r&&e.onLoadComplete()}};this.mResCallback=n;var a={onAsynTextureSucceed:function(t,e,n){o=i.onSingleResSucceed(n,o,r)}};this.mTextureCallback=a;var s=t.ResManager.getInstance(),h=t.TextureManager.getInstance();for(var l in this.mResItemMap){var p=this.mResItemMap[l];p.type==t.ResourceType.TYPE_IMAGE?h.loadTextureAsyn(l,a):s.loadResAsyn(l,n,p.type)}}},i.prototype.unload=function(){if(0!=this.mbLoaded){if(this.mbLoaded=!1,this.mResCallback){var e=t.ResManager.getInstance();e.cancelResAsyn(this.mResCallback),this.mResCallback=null}if(this.mTextureCallback){var i=t.TextureManager.getInstance();i.cancelTextureAsynAll(this.mTextureCallback),this.mTextureCallback=null}for(var r in this.mResItemMap){var o=this.mResItemMap[r];o.resItem&&(o.resItem.release(),o.resItem=null)}}},i.prototype.onUpdate=function(){0!=this.mbLoaded&&-1!=this.mDisposeTime&&(this.mDelayTime+=t.TimeStamp.DelayTime,this.mDelayTime>this.mDisposeTime&&this.unload())},i}(TClass);t.ResGroup=e,__reflect(e.prototype,"core.ResGroup")}(core||(core={}));var map;!function(t){function e(t,e){return Math.floor((t-1)/e+1)}var i=function(){function i(){this.m_bForceRefresh=!1}return i.prototype.create=function(t,i,r,o,n){return this.m_pScrollSheetSink=t,this.m_nMapWidth=i,this.m_nMapHeight=r,0==this.m_nMapWidth||0==this.m_nMapHeight?!1:(this.m_nGridWidth=o,this.m_nGridHeight=n,0==this.m_nGridWidth||0==this.m_nGridHeight?!1:(this.m_nMapGridWidth=e(this.m_nMapWidth,this.m_nGridWidth),this.m_nMapGridHeight=e(this.m_nMapHeight,this.m_nGridHeight),this.m_rcViewport=new egret.Rectangle,this.m_rcViewportGrid=new egret.Rectangle,core.EgretUtil.Rectangle_setLTRB(this.m_rcViewportGrid,-1,-1,-1,-1),this.m_rcLastDirtyGrid=new egret.Rectangle,void this.m_rcLastDirtyGrid.copyFrom(this.m_rcViewportGrid)))},i.prototype.getGridWidth=function(){return this.m_nGridWidth},i.prototype.getGridHeight=function(){return this.m_nGridHeight},i.prototype.getGridXCount=function(){return this.m_nMapGridWidth},i.prototype.getGridYCount=function(){return this.m_nMapGridHeight},i.prototype.getGridRect=function(t,e){var i=new egret.Rectangle;core.EgretUtil.Rectangle_setLTRB(i,t*this.m_nGridWidth,e*this.m_nGridHeight,(t+1)*this.m_nGridWidth,(e+1)*this.m_nGridHeight);var r=new egret.Rectangle;return core.EgretUtil.Rectangle_setLTRB(r,0,0,this.m_nMapWidth-1,this.m_nMapHeight-1),i.intersection(r)},i.prototype.getGridByMapRect=function(e){if(0==this.m_nMapWidth||0==this.m_nMapHeight)return new egret.Rectangle;var i=new egret.Rectangle;core.EgretUtil.Rectangle_setLTRB(i,t.FLOOR(e.left/this.m_nGridWidth),t.FLOOR(e.top/this.m_nGridHeight),t.FLOOR(e.right/this.m_nGridWidth),t.FLOOR(e.bottom/this.m_nGridHeight));var r=new egret.Rectangle;return core.EgretUtil.Rectangle_setLTRB(r,0,0,this.m_nMapWidth-1,this.m_nMapHeight-1),i.intersection(r)},i.prototype.changeViewportSize=function(t,e,i){(this.m_rcViewport.width!=t||this.m_rcViewport.height!=e)&&(this.m_rcViewport.setTo(this.m_rcViewport.left,this.m_rcViewport.top,t,e),i&&this.scrollViewport(0,0))},i.prototype.moveViewportCenterTo=function(t,e){return this.moveViewportTo(t-this.m_rcViewport.width/2,e-this.m_rcViewport.height/2)},i.prototype.moveViewportTo=function(t,e){return 0==this.m_rcViewport.height||0==this.m_rcViewport.width?!1:this.scrollViewport(t-this.m_rcViewport.left,e-this.m_rcViewport.top)},i.prototype.scrollViewport=function(e,i){this.m_rcViewport.left+e<0&&(e=-this.m_rcViewport.left),this.m_rcViewport.right+e>this.m_nMapWidth&&(e=this.m_nMapWidth-this.m_rcViewport.right),this.m_rcViewport.top+i<0&&(i=-this.m_rcViewport.top),this.m_rcViewport.bottom+i>this.m_nMapHeight&&(i=this.m_nMapHeight-this.m_rcViewport.bottom),this.m_rcViewport.offset(e,i);var r=new egret.Rectangle,o=null,n=null;if(core.EgretUtil.Rectangle_setLTRB(r,t.FLOOR(this.m_rcViewport.left/this.m_nGridWidth),t.FLOOR(this.m_rcViewport.top/this.m_nGridHeight),t.FLOOR(this.m_rcViewport.right/this.m_nGridWidth),t.FLOOR(this.m_rcViewport.bottom/this.m_nGridHeight)),r.equals(this.m_rcViewportGrid))return!0;o=r.clone(),o.left-=1,o.top-=1,o.right+=1,o.bottom+=1;var a=new egret.Rectangle;a.setTo(0,0,this.m_nMapGridWidth-1,this.m_nMapGridHeight-1),n=o.intersection(a);var s=new egret.Point;if(0==this.m_bForceRefresh){for(var h=this.m_rcLastDirtyGrid.top;h>=0&&h<=this.m_rcLastDirtyGrid.bottom;h++)for(var l=this.m_rcLastDirtyGrid.left;l>=0&&l<=this.m_rcLastDirtyGrid.right;l++)s.setTo(l,h),n.contains(s.x,s.y)||this.m_pScrollSheetSink.onEyeshotLost(l,h);for(var h=n.top;h<=n.bottom;h++)for(var l=n.left;l<=n.right;l++)s.setTo(l,h),this.m_rcLastDirtyGrid.contains(s.x,s.y)||this.m_pScrollSheetSink.onEyeshotFound(l,h)}else{for(var h=this.m_rcLastDirtyGrid.top;h>=0&&h<=this.m_rcLastDirtyGrid.bottom;h++)for(var l=this.m_rcLastDirtyGrid.left;l>=0&&l<=this.m_rcLastDirtyGrid.right;l++)this.m_pScrollSheetSink.onEyeshotLost(l,h);for(var h=n.top;h<=n.bottom;h++)for(var l=n.left;l<=n.right;l++)this.m_pScrollSheetSink.onEyeshotFound(l,h)}return this.m_rcViewportGrid=r,this.m_rcLastDirtyGrid=n,!0},i}();t.MapLayerEyeShot=i,__reflect(i.prototype,"map.MapLayerEyeShot")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mRefCount=0,t}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mCellX=e[0],this.mCellY=e[1],this.mImageId=0,this.mFlag=0,this.mMapMgr=t.MapManager.getInstance()},i.prototype.destory=function(){this.clearImage(),this.mImage=null,this.mRefCount=0},i.prototype.setImageId=function(t){this.mImageId=t},i.prototype.setFlag=function(t){this.mFlag=t},i.prototype.onTileFound=function(t){if(0==this.mRefCount){this.mRefCount++,null==this.mImage&&(this.mImage=new egret.Bitmap),t.getDisplayNode().addChild(this.mImage),this.mImage.x=this.mCellX*t.getCellW(),this.mImage.y=this.mCellY*t.getCellH();var e=this.mMapMgr.getStaticImagePath(this.mImageId);if(""!=e){var i=core.TextureManager.getInstance();i.loadTextureAsyn(e,this),this.mPath=e,this.mMapMgr.addLoadingTileImage(this.mPath)}}},i.prototype.onTileLost=function(t){0!=this.mRefCount&&(this.mRefCount--,0==this.mRefCount&&this.clearImage())},i.prototype.clearImage=function(){if(this.mImage&&this.mImage.parent&&(this.mImage.parent.removeChild(this.mImage),this.mImage.$setBitmapData(null)),this.mPath){this.mMapMgr.removeLoadingTileImage(this.mPath);var t=core.TextureManager.getInstance();t.cancelTextureAsyn(this.mPath,this),this.mPath=null}},i.prototype.onAsynTextureSucceed=function(t,e){this.mImage.texture=e,this.mPath&&this.mMapMgr.removeLoadingTileImage(this.mPath)},i}(TClass);t.MapTile=e,__reflect(e.prototype,"map.MapTile",["core.TextureCallback"])}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mTempViewInfo={},t}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTileList=[]},i.prototype.destory=function(){this.clearAllTiles()},i.prototype.clearAllTiles=function(){this.mTileList.forEach(function(t){t.deleteObj()}),this.mTileList=[]},i.prototype.load=function(t){e.prototype.load.call(this,t);var i=t.readUnsignedInt(),r=t.readUnsignedInt(),o=t.readUnsignedInt(),n=t.readUnsignedInt();this.setCellWHAndNum(i,r,o,n);for(var a=0;n>a;++a)for(var s=0;o>s;++s){for(var h=this.getMapTile(s,a),l=t.readShort(),p=0;l>p;p++){var u=t.readInt();h.setImageId(u)}var m=t.readInt();h.setFlag(m)}return!0},i.prototype.getMapTile=function(e,i){TLog.Assert(e<this.cellNumW||e>=0||i<this.cellNumW||i>=0,"getTile x:"+e+" y:"+i);var r=e+i*this.cellNumW,o=this.mTileList[r];return null==o&&(o=this.mTileList[r]=t.MapTile.newObj(e,i)),o},i.prototype.setCellWHAndNum=function(t,e,i,r){this.clearAllTiles(),this.cellSizeW=t,this.cellSizeH=e,this.cellNumW=i,this.cellNumH=r,this.mapSizeH=this.cellSizeH*this.cellNumH,this.mapSizeW=this.cellSizeW*this.cellNumW},i.prototype.getCellW=function(){return this.cellSizeW},i.prototype.getCellH=function(){return this.cellSizeH},i.prototype.onEyeshotFound=function(t,e){this.getVisibleCellInfo(t,e);for(var i=this.mTempViewInfo,r=0;r<i.xviewnum;r++)for(var o=0;o<i.yviewnum;o++){var n=i.xbegin+r,a=i.ybegin+o,s=this.getMapTile(n,a);s.onTileFound(this)}},i.prototype.onEyeshotLost=function(t,e){this.getVisibleCellInfo(t,e);for(var i=this.mTempViewInfo,r=0;r<i.xviewnum;r++)for(var o=0;o<i.yviewnum;o++){var n=i.xbegin+r,a=i.ybegin+o,s=this.getMapTile(n,a);s.onTileLost(this)}},i.prototype.getVisibleCellInfo=function(e,i){var r=this.mLayerEyeshot.getGridRect(e,i),o=this.mTempViewInfo={};o.xbegin=t.FLOOR(r.left/this.cellSizeW),o.ybegin=t.FLOOR(r.top/this.cellSizeH),o.xviewnum=t.FLOOR((r.width-1)/this.cellSizeW)+1,o.yviewnum=t.FLOOR((r.height-1)/this.cellSizeH)+1},i}(t.MapLayerBase);t.MapTileLayer=e,__reflect(e.prototype,"map.MapTileLayer")}(map||(map={}));var Application=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mLastTime=-1,e}return __extends(e,t),e.prototype.init=function(t,e){this.mRootNode=t,this.mStage=e,OverrideEgretInit(),OverrideEUIInit(),map.MapManager.getInstance().init(this.mRootNode),gui.GuiManager.getInstance().init(this.mRootNode,this.mStage),this.mRootNode.addEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this);var i=egret.getDefinitionByName("g_LaunchInit");TLog.Assert("function"==typeof i),i()},e.prototype.stop=function(){this.mRootNode.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},e.prototype.setFps=function(t){this.mStage.frameRate=t},e.prototype.setDebug=function(t){},e.prototype.getRootNode=function(){return this.mRootNode},e.prototype.getStageNode=function(){return this.mStage},e.prototype.onUpdate=function(){var t=core.getCpuTime();this.mLastTime<0&&(this.mLastTime=t),core.TimeStamp.DelayTime=t-this.mLastTime,core.TimeStamp.CurrentTime+=core.TimeStamp.DelayTime,core.TimeStamp.CurrentFrame+=1,this.mLastTime=t,core.NetSystem.getInstance().onUpdate(),map.MapManager.getInstance().onUpdate(),gui.GuiManager.getInstance().onUpdate(),map.LogicSpriteManager.getInstance().onUpdate(),core.TextureManager.getInstance().onUpdate(),core.ResGroupManager.getInstance().onUpdate(),core.AutoreleasePool.getInstance().clear()},e}(TClass);__reflect(Application.prototype,"Application");var UserSettingMode;!function(t){t[t.Common=0]="Common",t[t.Role=1]="Role"}(UserSettingMode||(UserSettingMode={}));var UserSetting=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mCommonName="",this.mRoleName="",this.mOperateType=-1,this.mStorgeCache={}},e.prototype.setOperationType=function(t){},e.prototype.setRoleName=function(t){this.mRoleName=t},e.prototype.setCommonSetting=function(t,e,i){this._setSetttingStorage(UserSettingMode.Common,t,e,i)},e.prototype.getCommonSetting=function(t,e,i){return this._getSettingStorage(UserSettingMode.Common,t,e,i)},e.prototype.setRoleSetting=function(t,e,i){this._setSetttingStorage(UserSettingMode.Role,t,e,i)},e.prototype.getRoleSetting=function(t,e,i){return this._getSettingStorage(UserSettingMode.Role,t,e,i)},e.prototype._setSetttingStorage=function(t,e,i,r){var o=this._getKeyName(t,i),n=this.mStorgeCache[o];if(n!=r)try{egret.localStorage.setItem(o,r)}catch(a){}this.mStorgeCache[o]=r},e.prototype._getSettingStorage=function(t,i,r,o){var n=this._getKeyName(t,r),a=this.mStorgeCache[n];if(null==a){try{a=egret.localStorage.getItem(n)}catch(s){a=null}this.mStorgeCache[n]=a}return null===a||""===a?(this.mStorgeCache[n]=o,o):i==e.TYPE_NUMBER?Number(a).valueOf():i==e.TYPE_BOOLEAN?a===!1||"false"==a||"0"==a?!1:!0:a},e.prototype._getKeyName=function(t,e){var i=e;return UserSettingMode.Role==t&&(""==this.mRoleName&&TLog.Error("UserSetting RoleName is empty. key:%s",i),i+=this.mRoleName),i},e.TYPE_STRING=0,e.TYPE_NUMBER=1,e.TYPE_BOOLEAN=2,e}(TClass);__reflect(UserSetting.prototype,"UserSetting");var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResGroupList=[],this.mGroupCallbackMap={}},i.prototype.destory=function(){for(var t=0,e=this.mResGroupList;t<e.length;t++){var i=e[t];i.deleteObj()}this.mResGroupList=null},i.prototype.getGroup=function(e,i){for(var r=0,o=this.mResGroupList;r<o.length;r++){var n=o[r];if(n.name==e)return n}if(i=!!i,0==i)return null;var a=t.ResGroup.newObj(this);return a.name=e,this.mResGroupList.push(a),a},i.prototype.addGroupConfig=function(t,e,i){var r=this.getGroup(t,!0);r.addResItemConfig(e,i)},i.prototype.loadGroup=function(t,e){var i=this.getGroup(t);if(null!=i){if(e){var r=this.mGroupCallbackMap[t];if(null==r&&(r=this.mGroupCallbackMap[t]=[]),-1!=r.indexOf(e))return;r.push(e)}i.load()}},i.prototype.unLoadGroup=function(t){var e=this.getGroup(t);null!=e&&e.unload()},i.prototype.cancelGroup=function(t){delete this.mGroupCallbackMap[t]},i.prototype._onGroupLoad=function(t){var e=this.mGroupCallbackMap[t];e&&(e.forEach(function(e){e.onResGroupLoad(t)}),delete this.mGroupCallbackMap[t])},i.prototype.onUpdate=function(){for(var t=0,e=this.mResGroupList;t<e.length;t++){var i=e[t];i.onUpdate()}},i}(TClass);t.ResGroupManager=e,__reflect(e.prototype,"core.ResGroupManager")}(core||(core={}));var map;!function(t){var e;!function(t){t[t.TYPE_BONE_SPRITE=0]="TYPE_BONE_SPRITE",t[t.TYPE_FRMAE_SPRITE=1]="TYPE_FRMAE_SPRITE"}(e=t.SpriteType||(t.SpriteType={}));var i;!function(t){t[t.ANIM_NOTIFY=262144]="ANIM_NOTIFY",t[t.BOUND_NOTIFY=524288]="BOUND_NOTIFY"}(i=t.AnimReportFlag||(t.AnimReportFlag={}));var r;!function(t){t[t.eLoaded=0]="eLoaded",t[t.eUnLoaded=1]="eUnLoaded",t[t.eLoading=2]="eLoading",t[t.eUnLoading=3]="eUnLoading"}(r=t.ModelLoadState||(t.ModelLoadState={}));var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.AnimEvent="AnimEvent",e}(core.EventArgs);t.SpriteAnimEvent=o,__reflect(o.prototype,"map.SpriteAnimEvent");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.BoundSizeEvent="BoundSizeEvent",e}(core.EventArgs);t.SpriteEvent=n,__reflect(n.prototype,"map.SpriteEvent");var a;!function(t){t[t.eDisplayNode_UI=0]="eDisplayNode_UI",t[t.eDisplayNode_Shadow=1]="eDisplayNode_Shadow",t[t.eDisplayNode_Unknown=2]="eDisplayNode_Unknown"}(a=t.SpriteDisplayNodeType||(t.SpriteDisplayNodeType={}))}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mSpriteList=[],this.mRelaseSpriteList=[],this.mModelInfoMap={},this.mSkeletonResourceMap={},this.mTextureResourceMap={},this.mUnloadingResourceList=[],this.mDisposeTime=5e3},i.prototype.destory=function(){for(var t=0,e=this.mRelaseSpriteList;t<e.length;t++){var i=e[t];i.release()}this.mRelaseSpriteList.length=0,this.mSpriteList.forEach(function(t){t.deleteObj()}),this.mSpriteList.length=0,this.mUnloadingResourceList.length=0},i.prototype.createSprite=function(e){var i=i=t.FrameSprite.createObj();return this.mSpriteList.push(i),i},i.prototype.removeSprite=function(t){var e=this.mSpriteList.indexOf(t);-1!=e&&this.mSpriteList.splice(e,1)},i.prototype.defineModelPath=function(t,e,i){if(t&&e){var r={};r.modelName=t,r.path=e,r.isbin=i,this.mModelInfoMap[t]=r}},i.prototype.getFrameTextureResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mTextureResourceMap[e];return null==r&&(r=t.FrameSpriteTextureResource.newObj(e,i,this),this.mTextureResourceMap[e]=r),r},i.prototype.getFrameSpriteInfoResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mSkeletonResourceMap[e];return null==r&&(r=t.FrameSpriteInfoResource.newObj(e,i,this),this.mSkeletonResourceMap[e]=r),r},i.prototype.addUnloadingResource=function(t){-1==this.mUnloadingResourceList.indexOf(t)&&(TLog.Assert(-1==t.mUnLoadBeginTime),t.mUnLoadBeginTime=core.TimeStamp.CurrentTime,this.mUnloadingResourceList.push(t))},i.prototype.removeUnloadingResource=function(t){var e=this.mUnloadingResourceList.indexOf(t);-1!=e&&this.mUnloadingResourceList.splice(e,1)},i.prototype.setAutoDisposeTime=function(t){TLog.Assert(t>=0),this.mDisposeTime=t},i.prototype.cleanUpCacheRes=function(){this.onUpdate(!0)},i.prototype.onUpdate=function(t){var e=this;if(void 0===t&&(t=!1),this.mUnloadingResourceList.length>0){for(var i=[],r=core.TimeStamp.CurrentTime-this.mDisposeTime,o=0,n=this.mUnloadingResourceList;o<n.length;o++){var a=n[o];(t||a.mUnLoadBeginTime>0&&a.mUnLoadBeginTime<r)&&i.push(a)}i.length>0&&i.forEach(function(t){e.removeUnloadingResource(t),t.unloadImp()})}},i}(core.EventSet);t.LogicSpriteManager=e,__reflect(e.prototype,"map.LogicSpriteManager")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mCacheHashCodeList=[]},e.prototype.destory=function(){},e.prototype.onRenderSpriteList=function(e){var i=this;t.prototype.onRenderSpriteList.call(this,e);var r=this.mRenderObjectList.length;if(0!=r){this.mRenderObjectList.sort(function(t,e){var i=t.getPositionY()-e.getPositionY();return 0==i&&(i=t.getPositionX()-e.getPositionX()),i});var o=!1;if(r!=this.mCacheHashCodeList.length)o=!0;else for(var n=0;r>n;n++){var a=this.mCacheHashCodeList[n],s=this.mRenderObjectList[n].hashCode;if(a!=s){o=!0;break}}if(o){this.mCacheHashCodeList.length=0;var h=0,l=this.getDisplayNode();this.mRenderObjectList.forEach(function(t){var e=t.getDisplayNode();e.parent==l&&l.setChildIndex(e,h),h++,i.mCacheHashCodeList.push(t.hashCode)})}}},e}(t.SpriteLayer);t.SortSpriteLayer=e,__reflect(e.prototype,"map.SortSpriteLayer")}(map||(map={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mKey=t[0],this.mPath=t[1],this.mData=t[2],this.mFromZip=!!t[3]},i.prototype.destory=function(){0==this.mFromZip&&t.ResManager.getInstance().destroyRes(this.mPath),this.mData=null,t.ResManager.getInstance().clearResPath(this.mPath)},i.prototype.getKey=function(){return this.mKey},i.prototype.getData=function(){return this.mData},i}(TClass);t.ResItem=e,__reflect(e.prototype,"core.ResItem")}(core||(core={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mSpriteInfoResource=null,this.mTextureResource=null,this.mSpriteAnimation=t.FrameSpriteAnim.newObj(this),this.mSpriteDisplay=new t.FrameSpriteDisplay,this.mbSpriteDisplayLoaded=!1,this.mRootNode.addChildAt(this.mSpriteDisplay,0),this.mTransfromProxy=null},i.prototype.destory=function(){this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource()},i.prototype.getSpriteTexture=function(){return this.mTextureResource},i.prototype.getSpriteDisplay=function(){return this.mSpriteDisplay},i.prototype.setTransfromProxy=function(t){this.mTransfromProxy=t},i.prototype.getTransformProxy=function(){return this.mTransfromProxy},i.prototype.joinBodyPartsTo=function(t){var e=t.getSpriteDisplay();this.mSpriteDisplay.joinBodyPartDisplayTo(e),this.mJoinPartsTarget=t},i.prototype.restoreBodyParts=function(){this.mSpriteDisplay.restoreBodyPartDisplay(),this.mJoinPartsTarget=null},i.prototype.onAnimationEvent=function(t){""!=t&&this._fireAnimEvent(t)},i.prototype.onAnimationIndexChange=function(t,e){this.mSpriteDisplay.setActionAndFrameIndex(t,e)},i.prototype.getSpriteInfo=function(){return null==this.mSpriteInfoResource?null:this.mSpriteInfoResource.getSpriteInfo()},i.prototype._clearArmature=function(){this.mbSpriteDisplayLoaded=!1,this.mSpriteDisplay.clearBodyPartDisplay(),this.mSpriteAnimation.unloadAnim()},i.prototype._createArmature=function(){TLog.Assert(0==this.mbSpriteDisplayLoaded&&null!=this.mSpriteInfoResource),this.mbSpriteDisplayLoaded=!0,this.mSpriteDisplay.loadModelInfo(this,this.getSpriteInfo()),this.mSpriteAnimation.loadModelAnim(this.getSpriteInfo()),this.mJoinPartsTarget&&this.joinBodyPartsTo(this.mJoinPartsTarget)},i.prototype._loadTextureResource=function(){if(null==this.mTextureResource){var t=this.getModelName();if(""!=t){if(this.mTextureResource=this.mSpriteMgr.getFrameTextureResource(t),null==this.mTextureResource)return void TLog.Error("_loadTextureResource:"+t);this.mTextureResource.load(),this._setFlags(32)}}},i.prototype._unLoadTextureResource=function(){this.mTextureResource&&(this.mTextureResource.unload(),this.mTextureResource=null),this._removeFlags(32)},i.prototype._loadSkeletonResource=function(){if(null==this.mSpriteInfoResource){var t=this.getModelName();if(""!=t){if(this.mSpriteInfoResource=this.mSpriteMgr.getFrameSpriteInfoResource(t),null==this.mSpriteInfoResource)return void TLog.Error("_loadSkeletonResource:"+t);this.mSpriteInfoResource.load()}}},i.prototype._unLoadSkeletonResource=function(){this.mSpriteInfoResource&&(this.mSpriteInfoResource.unload(),this.mSpriteInfoResource=null)},i.prototype._updateAnimation=function(){if(this._hasFlags(2)){this._removeFlags(2),this._removeFlags(8);var t=this.mLogicInfo[1];if(""==t||null==t){var e=this.mSpriteAnimation.getAnimationInfoByIndex(0);this.mSpriteAnimation.changeAction(e.name,0==this.getLoopCount())}else{if(0==this.hasActionId(t)){var i=this.getAliasAction(t);null!=i&&(t=i)}this.mSpriteAnimation.changeAction(t,0==this.getLoopCount())}this.mSpriteAnimation.setAnimSpeed(this.getAnimSpeed()),this._updateDirChange(!0)}if(this._hasFlags(4)&&(this._removeFlags(4),this.mSpriteAnimation.setAnimSpeed(this.getAnimSpeed())),this._hasFlags(16)){this._removeFlags(16);var r=this.isPause();r?this.mSpriteAnimation.setPause(!0):this.mSpriteAnimation.setPause(!1)}null==this.mJoinPartsTarget&&this.mSpriteAnimation.onUpdate()},i.prototype._updateTexture=function(){this.mTextureResource&&this.mTextureResource.isLoaded()&&this._hasFlags(32)&&(this._removeFlags(32),this.mSpriteDisplay.updateDisplay())},i.prototype._updateBound=function(){if(0!=this.mbBoundDirty&&null!=this.mTextureResource&&0!=this.mTextureResource.isLoaded()&&0!=this.mSpriteDisplay.numChildren){var t=this.mSpriteAnimation;if(this.mJoinPartsTarget&&(t=this.mJoinPartsTarget.getAnimation()),0!=this.mTextureResource.isAnimTextureLoaded(t.getActionId())){this.mbBoundDirty=!1,this.mSpriteDisplay.updateDisplay();var e=this.getDisplayNode();this.mSpriteDisplay.getTransformedBounds(e,this.mBoundRect),this._fireBoundEvent(),null!=this.mParentSprite&&this.mParentSprite.invalideBounds()}}},i.prototype._addChidNode=function(e,r,o,n){if(TLog.Assert(r instanceof i),n)if(0==o)r.joinBodyPartsTo(this);else{var a=new t.FramSpriteBodyPartDisplayProxy;a.initWithParam(r),a.setOrder(o),this.mSpriteDisplay.addBodyPartDisplay(a),this.mSpriteDisplay.updateDisplay(),r.setTransfromProxy(a)}else{var s=this.mRootNode.numChildren;0>o&&(s=0),r.setPersScale(this.getPersScale()),this.mRootNode.addChildAt(r.getDisplayNode(),s)}this.mChildSpriteList.push(r),r.retain()},i.prototype._removeChildNode=function(t){var i=t.getTransformProxy();null!=i&&this.mSpriteDisplay.removeBodyPartDisplay(i),t.restoreBodyParts(),e.prototype._removeChildNode.call(this,t)},i.prototype._updateDirChange=function(t){if(t=!!t,(null==this.mTransfromProxy||0!=t)&&null==this.mJoinPartsTarget){var e=this.getDir();null!=this.mParentSprite&&(e=this.mParentSprite.getDir());var i=this.mSpriteAnimation.getCurAnimationInfo();if(!(null==i||i.dirs.length<=0)){for(var r=i.dirs[0],o=Math.abs(e-r),n=1;n<i.dirs.length;n++){var a=i.dirs[n],s=Math.abs(a-e);o>s&&(r=a,o=s)}this.mSpriteDisplay.setDirIndex(r)}}},i.prototype.onCameraFound=function(){e.prototype.onCameraFound.call(this),this._loadTextureResource()},i.prototype.onCameraLost=function(){e.prototype.onCameraLost.call(this),this._unLoadTextureResource()},i.prototype.onMoveDirChange=function(t){return this._updateDirChange(),!0},i.prototype.changePartSkin=function(t,e){this.mSpriteDisplay.setPartShow(t,e)},i.prototype.changeSkin=function(t){},i.prototype.getSkinName=function(){return TLog.Assert(!1,"not support"),""},i.prototype.setPositionOffset=function(t,e){this.mSpriteDisplay.x=t,this.mSpriteDisplay.y=e},i.prototype._updateAlpha=function(){this.mSpriteDisplay.alpha=this.mAlpha/255*(this.mMaskAlpha/255)},i.prototype._updateScale=function(){var t=this.mPersScale*this.mScale;this.mSpriteDisplay.scaleX=t*this.mFlipXFlag,this.mSpriteDisplay.scaleY=t*this.mFlipYFlag},i.prototype._updateRotate=function(){this.mSpriteDisplay.rotation=this.mRotate},i.prototype._updateModel=function(){if(this._hasFlags(1)&&(this._removeFlags(1),this.invalideBounds(),this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource(),this._loadSkeletonResource(),this.isClip()||this._loadTextureResource()),null!=this.mSpriteInfoResource&&0!=this.mSpriteInfoResource.isLoaded()){0==this.mbSpriteDisplayLoaded&&(this._createArmature(),this.setDirChange()),this._updateAnimation(),this._updateTexture(),this._updateBound(),1==this.isEnterMap()&&this._updateMask();var t=this.mChildAddInfoList.length;if(t>0){for(var e=0;t>e;e++){var i=this.mChildAddInfoList[e];this._addChidNode(i.slot,i.sprite,i.order,i.bTransform),i.sprite.release()}this.mChildAddInfoList.length=0}}},i.prototype.hasActionId=function(t){return null!=this.mSpriteAnimation.getAnimationInfo(t)},i.prototype.getAnimation=function(){return this.mSpriteAnimation},i}(t.LogicSprite);t.FrameSprite=e,__reflect(e.prototype,"map.FrameSprite",["map.FrameSpriteAnimListener"])}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mListener=t[0],this.mLoop=!0,this.mAnimSpeed=1,this.mFrameIndex=-1,this.mbPause=!1,this.mCurIntervalTime=0,this.mAnimChanged=!1,this.mCurAnimInfo=null,this.mSpriteInfo=null,this.mActionId=""},e.prototype.destory=function(){},e.prototype.loadModelAnim=function(t){this.mSpriteInfo=t,""!=this.mActionId&&this.changeAction(this.mActionId,this.mLoop)},e.prototype.unloadAnim=function(){this.mSpriteInfo=null,this.mCurAnimInfo=null},e.prototype.changeAction=function(t,e){if(this.mActionId=t,this.mLoop=e,null!=this.mSpriteInfo){var i=this.mSpriteInfo;this.mCurAnimInfo=i.getFrameAnimInfo(t),null==this.mCurAnimInfo&&TLog.Error("model:%s body:%s changeAction %s not exist",i.name,t),this.mAnimChanged=!1,this.mFrameIndex=-1,this.setPause(!1)}},e.prototype.getActionId=function(){return this.mActionId},e.prototype.setAnimSpeed=function(t){this.mAnimSpeed=t},e.prototype.setPause=function(t){this.mbPause=t},e.prototype.getAnimationInfoByIndex=function(t){return null==this.mSpriteInfo?null:this.mSpriteInfo.mAnimationList[t]},e.prototype.getAnimationInfo=function(t){return null!=this.mSpriteInfo?this.mSpriteInfo.getFrameAnimInfo(t):void 0},e.prototype.getCurAnimationInfo=function(){return this.mCurAnimInfo},e.prototype.onUpdate=function(){if(!this.mbPause&&null!=this.mCurAnimInfo){var t=core.TimeStamp.DelayTime*this.mAnimSpeed;for(this.mCurIntervalTime+=t,-1==this.mFrameIndex&&(this.mFrameIndex=-1,this.mCurIntervalTime=this.mCurAnimInfo.timeInterval,this.mAnimChanged=!0,this.mListener.onAnimationEvent("begin"));this.mCurIntervalTime>=this.mCurAnimInfo.timeInterval;){this.mCurIntervalTime-=this.mCurAnimInfo.timeInterval;var e=!1;this.mFrameIndex++,this.mFrameIndex>=this.mCurAnimInfo.frameCount&&(e=!0,this.mFrameIndex=0),this.mAnimChanged=!0,this.mCurAnimInfo.eventFrameIndex==this.mFrameIndex&&""!=this.mCurAnimInfo.eventName&&this.mListener.onAnimationEvent(this.mCurAnimInfo.eventName),e&&(this.mListener.onAnimationEvent("end"),0==this.mLoop?this.mbPause=!0:this.mListener.onAnimationEvent("turn"))}this.mAnimChanged&&this.mListener.onAnimationIndexChange(this.mCurAnimInfo.name,this.mFrameIndex)}},e}(TClass);t.FrameSpriteAnim=e,__reflect(e.prototype,"map.FrameSpriteAnim")}(map||(map={}));var map;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mActionId="",e.mDirIndex=-1,e.mFrameIndex=-1,e.mPartShowName="",e.mOrder=0,e}return __extends(e,t),e.prototype.setDispalyParent=function(t,e){return void 0===e&&(e=0),this.parent!=t?void(null==t?this.parent&&this.parent.removeChild(this):t.addChildAt(this,e)):void t.setChildIndex(this,e)},e.prototype.setDirIndex=function(t){this.mDirIndex=t,this.updateDislay()},e.prototype.setAction=function(t){this.mActionId=t,this.updateDislay()},e.prototype.setFrameIndex=function(t){this.mFrameIndex=t,this.updateDislay()},e.prototype.setPartShow=function(t){this.mPartShowName=t,this.updateDislay()},e.prototype.setVisible=function(t){this.visible=t},e.prototype.setOrder=function(t){this.mOrder=t},e.prototype.getOrder=function(){return this.mOrder},e.prototype.updateDislay=function(){},e}(egret.DisplayObjectContainer);t.FramSpriteBodyPartDisplayBase=e,__reflect(e.prototype,"map.FramSpriteBodyPartDisplayBase");var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initWithParam=function(t,e){this.mLogicSprite=t,this.mBodyPartInfo=e,this.mPartName=e.name,this.mOrder=this.mBodyPartInfo.defaultOrder,this.mBitmap=new egret.Bitmap,this.mBitmap.anchorOffsetX=e.offx,this.mBitmap.anchorOffsetY=e.offy,this.addChild(this.mBitmap)},e.prototype.setAction=function(t){var e=t;if(0==this.mLogicSprite.hasActionId(t)){var i=this.mLogicSprite.getAliasAction(t);null!=i&&(e=i)}this.mActionId=e,this.updateDislay()},e.prototype.setDirIndex=function(e){t.prototype.setDirIndex.call(this,e);var i=this.mBodyPartInfo.dirsOrder[e];null!=i&&this.setOrder(i)},e.prototype.updateDislay=function(){if(!(""==this.mActionId||this.mDirIndex<0||this.mFrameIndex<0)){var t=this.mLogicSprite.getSpriteTexture();if(null!=t){t.requestLoadAnimTexture(this.mActionId);var e=this.mFrameIndex<10?"0"+this.mFrameIndex:String(this.mFrameIndex),i=null;i=""==this.mPartShowName?this.mActionId+"_"+this.mDirIndex+"_"+this.mBodyPartInfo.name+"_"+e:this.mActionId+"_"+this.mDirIndex+"_"+this.mBodyPartInfo.name+"_"+this.mPartShowName+"_"+e;var r=t.getTexture(i);this.mBitmap.texture=r}}},e.prototype.$measureChildBounds=function(e){t.prototype.$measureContentBounds.call(this,e),this.mBitmap.texture?e.setTo(0,0,this.mBitmap.texture.$getScaleBitmapWidth(),this.mBitmap.texture.$getScaleBitmapHeight()):e.setTo(0,0,0,0)},e}(e);t.FramSpriteBodyPartDisplayBitmap=i,__reflect(i.prototype,"map.FramSpriteBodyPartDisplayBitmap");var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initWithParam=function(t){this.mLogicSprite=t,this.mSpriteDisplay=t.getSpriteDisplay(),this.mSpriteAnim=t.getAnimation(),this.addChild(this.mLogicSprite.getDisplayNode())},e.prototype.setDirIndex=function(e){var r=this.mSpriteAnim.getCurAnimationInfo();if(null!=r){if(0==r.isDirectionExsit(e)){if(-1!=this.mDirIndex||0==r.dirs.length)return;e=r.dirs[0]
}t.prototype.setDirIndex.call(this,e);var o=this.mSpriteDisplay.mBodyPartDisplayList;if(o.length>0){var n=o[0];if(n instanceof i){var a=n.mBodyPartInfo.dirsOrder[e];null!=a&&this.setOrder(a)}}}},e.prototype.setAction=function(t){},e.prototype.setFrameIndex=function(t){},e.prototype.updateDislay=function(){this.mDirIndex<0||this.mSpriteDisplay.setDirIndex(this.mDirIndex)},e}(e);t.FramSpriteBodyPartDisplayProxy=r,__reflect(r.prototype,"map.FramSpriteBodyPartDisplayProxy");var o=function(t){function e(){var e=t.call(this)||this;return e.mBodyPartDisplayList=[],e.mRestoreBodyPartDisplayList=[],e.mRestoreSpriteDisplay=null,e.mActionId="",e.mDirIndex=-1,e.mFrameIndex=-1,e}return __extends(e,t),e.prototype.loadModelInfo=function(t,e){TLog.Assert(null!=e),this.mRestoreBodyPartDisplayList=[],this.mRestoreSpriteDisplay=null,this.mActionId="",this.mDirIndex=-1,this.mFrameIndex=-1,this.mLogicSprite=t;for(var r=e.mBodyPartInfoList,o=0,n=r;o<n.length;o++){var a=n[o],s=new i;s.initWithParam(t,a),this.addChild(s),this.mBodyPartDisplayList.push(s)}this.updateDisplay()},e.prototype.setDirIndex=function(t){for(var e=!1,i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var o=r[i],n=o.getOrder();o.setDirIndex(t),n!=o.getOrder()&&(e=!0)}e&&this.updateDisplay(),this.mDirIndex=t},e.prototype.setActionAndFrameIndex=function(t,e){if(this.mActionId!=t){for(var i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var o=r[i];o.setAction(t)}this.mActionId=t}if(this.mFrameIndex!=e){for(var n=0,a=this.mBodyPartDisplayList;n<a.length;n++){var o=a[n];o.setFrameIndex(e)}this.mFrameIndex=e}},e.prototype.setPartShow=function(t,e){if(""!=t)for(var i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var o=r[i];o.mPartName==t&&o.setPartShow(e)}},e.prototype.restoreBodyPartDisplay=function(){if(null!=this.mRestoreSpriteDisplay){for(var t=0;t<this.mRestoreBodyPartDisplayList.length;t++){var e=this.mRestoreBodyPartDisplayList[t];this.mRestoreSpriteDisplay.removeBodyPartDisplay(e),this.addBodyPartDisplay(e)}this.mRestoreSpriteDisplay.updateDisplay(),this.updateDisplay(),this.mRestoreSpriteDisplay=null}},e.prototype.joinBodyPartDisplayTo=function(t){if(null==this.mRestoreSpriteDisplay&&0!=this.mBodyPartDisplayList.length){for(var e=0;e<this.mBodyPartDisplayList.length;e++){var i=this.mBodyPartDisplayList[e];this.removeChild(i),t.addBodyPartDisplay(i),this.mRestoreBodyPartDisplayList.push(i)}this.mBodyPartDisplayList.length=0,this.mRestoreSpriteDisplay=t,t.updateDisplay()}},e.prototype.addBodyPartDisplay=function(t){return JsUtil.arrayPush(this.mBodyPartDisplayList,t)?(this.addChild(t),t.setDirIndex(this.mDirIndex),t.setAction(this.mActionId),t.setFrameIndex(this.mDirIndex),!0):!1},e.prototype.removeBodyPartDisplay=function(t){return JsUtil.arrayRemoveVal(this.mBodyPartDisplayList,t)?(this.removeChild(t),!0):!1},e.prototype.clearBodyPartDisplay=function(){for(var t=0;t<this.mBodyPartDisplayList.length;t++){var e=this.mBodyPartDisplayList[t];this.removeChild(e)}this.mBodyPartDisplayList.length=0},e.prototype.updateDisplay=function(){if(null==this.mRestoreSpriteDisplay){this.mBodyPartDisplayList.sort(function(t,e){return t.getOrder()-e.getOrder()});for(var t=0;t<this.mBodyPartDisplayList.length;t++){var e=this.mBodyPartDisplayList[t];e.setDispalyParent(this,t),e.updateDislay()}}else for(var t=0;t<this.mRestoreBodyPartDisplayList.length;t++){var i=this.mRestoreBodyPartDisplayList[t];i.updateDislay()}},e}(egret.DisplayObjectContainer);t.FrameSpriteDisplay=o,__reflect(o.prototype,"map.FrameSpriteDisplay")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name=t[0],this.frameCount=0,this.timeInterval=0,this.eventName="",this.eventFrameIndex=-1,this.dirs=[]},e.prototype.isDirectionExsit=function(t){return-1!=this.dirs.indexOf(t)},e}(TClass);t.FrameSpriteAnimInfo=e,__reflect(e.prototype,"map.FrameSpriteAnimInfo");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name=t[0],this.partShowList=[],this.defaultOrder=0,this.defaultShow="",this.dirsOrder={},this.offx=0,this.offy=0},e.prototype.destory=function(){},e}(TClass);t.FrameSpriteBodyPartInfo=i,__reflect(i.prototype,"map.FrameSpriteBodyPartInfo");var r=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name="",this.mBodyPartInfoList=[],this.mAnimationList=[]},r.prototype.destory=function(){},r.prototype.loadWithJson=function(t){this.name=t.name;for(var e=t.bodyparts,i=0,r=e;i<r.length;i++){var o=r[i],n=this.addBodyPart(o.name,o.order);if(n.offx=o.offx,n.offy=o.offy,o.dirsOrder)for(var a in o.dirsOrder){var s=JsUtil.toNumber(a,-1);-1!=s&&(n.dirsOrder[s]=o.dirsOrder[s])}if(o.shows)for(var h=0,l=o.shows;h<l.length;h++){var p=l[h];this.addBodyPartShow(o.name,p)}}for(var u=t.anims,m=0,c=u;m<c.length;m++){var d=c[m];this.addAnimation(d.name,d.dirs,d.interval,d.frameCount,d.eventName,d.eventIndex)}},r.prototype.addBodyPart=function(t,e){var r=this.getBodyPartInfo(t);return null==r&&(r=i.newObj(t)),r.defaultOrder=e,this.mBodyPartInfoList.push(r),this.mBodyPartInfoList.sort(function(t,e){return t.defaultOrder-e.defaultOrder}),r},r.prototype.addBodyPartShow=function(t,e){if(""!=e){var i=this.getBodyPartInfo(t);if(null==i)return void TLog.Error("addBodyPartShow %s not exsit",t);i.partShowList.push(e),""==i.defaultShow&&(i.defaultShow=e)}},r.prototype.getBodyPartInfo=function(t){for(var e=0;e<this.mBodyPartInfoList.length;e++){var i=this.mBodyPartInfoList[e];if(i.name==t)return i}return null},r.prototype.addAnimation=function(t,i,r,o,n,a){void 0===n&&(n=""),void 0===a&&(a=-1);var s=this.getFrameAnimInfo(t);return null!=s?void TLog.Error("addAnimation anim:%s exsit",t):(s=e.newObj(t),s.dirs=i.concat(),s.frameCount=o,s.timeInterval=r,s.eventName=n,s.eventFrameIndex=a,this.mAnimationList.push(s),s)},r.prototype.getFrameAnimInfo=function(t){for(var e=this.mAnimationList,i=0,r=e;i<r.length;i++){var o=r[i];if(o.name==t)return o}return null},r}(TClass);t.FrameSpriteInfo=r,__reflect(r.prototype,"map.FrameSpriteInfo")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[1];this.mBasePath=i.path,this.modelJsonPath=this.mBasePath.concat("/"+i.modelName+"_ske.json"),this.mFrameSpriteInfo=null},i.prototype.destory=function(){},i.prototype.getSpriteInfo=function(){return this.mFrameSpriteInfo},i.prototype._loadImp=function(){var t=core.ResManager.getInstance();t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_JSON)},i.prototype._unloadImp=function(){this.mFrameSpriteInfo&&(this.mFrameSpriteInfo.deleteObj(),this.mFrameSpriteInfo=null)},i.prototype._cancelLoadImp=function(){var t=core.ResManager.getInstance();t.cancelResAsyn(this)},i.prototype.onResItemLoad=function(e){if(e.getKey()==this.modelJsonPath){var i=e.getData(),r=t.FrameSpriteInfo.newObj();r.loadWithJson(i),this.mFrameSpriteInfo=r,this.notifyLoadComplete()}},i.prototype.onResItemError=function(t){},i}(t.SpriteResourceBase);t.FrameSpriteInfoResource=e,__reflect(e.prototype,"map.FrameSpriteInfoResource",["core.ResItemCallback"]);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTextureResMap={},this.mTextureAtlasMap={};var i=t[1];this.mBasePath=i.path,this.modelJsonPath=this.mBasePath.concat("/"+i.modelName+"_ske.json")},e.prototype.destory=function(){},e.prototype.getTexture=function(t){return this.mTextureAtlasMap[t]},e.prototype.isAnimTextureLoaded=function(t){var e=this.mModelName+"_"+t,i=this.mTextureResMap[e];return null==i&&(e=this.mModelName,i=this.mTextureResMap[e]),null!=i&&null!=i.textureRes&&0==i.bloading},e.prototype.requestLoadAnimTexture=function(t){var e=this.mModelName+"_"+t,i=this.mTextureResMap[e];if(null==i&&(e=this.mModelName,i=this.mTextureResMap[e]),null!=i&&null==i.textureRes&&1!=i.bloading){var r=this._getTextureJsonPath(e),o=core.ResManager.getInstance();o.loadResAsyn(r,this,core.ResourceType.TYPE_JSON);var n=this._getTexturePath(e),a=core.TextureManager.getInstance();a.loadTextureAsyn(n,this),i.bloading=!0}},e.prototype._loadImp=function(){var t=core.ResManager.getInstance();t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_JSON)},e.prototype._unloadImp=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.textureRes&&e.textureRes.release(),e.jsonRes&&e.jsonRes.release()}this.mTextureResMap={},this.mTextureAtlasMap={}},e.prototype._cancelLoadImp=function(){var t=core.TextureManager.getInstance();for(var e in this.mTextureResMap){this.mTextureResMap[e];t.cancelTextureAsyn(this._getTexturePath(e),this)}var i=core.ResManager.getInstance();i.cancelResAsyn(this)},e.prototype.onResItemLoad=function(t){if(t.getKey()==this.modelJsonPath){var e=t.getData(),i=[];if(null!=e.textures)for(var r=0,o=e.textures;r<o.length;r++){var n=o[r];i.push(n)}for(var a=0,s=i;a<s.length;a++){var h=s[a],l=h.lastIndexOf("."),p=h.substring(0,l);this.mTextureResMap[p]={textureRes:null,jsonRes:null,bloading:!1}}this.notifyLoadComplete()}else{for(var u in this.mTextureResMap){var m=this.mTextureResMap[u],c=this._getTextureJsonPath(u);c==t.getKey()&&(t.retain(),m.jsonRes=t)}this._checkLoadComplete()}},e.prototype.onResItemError=function(t){},e.prototype.onAsynTextureSucceed=function(t,e,i){for(var r in this.mTextureResMap){var o=this.mTextureResMap[r],n=this._getTexturePath(r);n==t&&(i.retain(),o.textureRes=i)}this._checkLoadComplete()},e.prototype._getTexturePath=function(t){return this.mBasePath.concat("/",t+".png")},e.prototype._getTextureJsonPath=function(t){return this.mBasePath.concat("/",t+".json")},e.prototype._checkLoadComplete=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.bloading&&null!=e.textureRes&&null!=e.jsonRes&&(this._createTextureAtlas(e),e.bloading=!1,e.jsonRes.release(),e.jsonRes=null)}},e.prototype._createTextureAtlas=function(t){TLog.Assert(null!=t.textureRes&&null!=t.jsonRes);var e=t.textureRes.getData(),i=t.jsonRes.getData();for(var r in i.frames){var o=i.frames[r],n=new egret.Texture;n.$bitmapData=e.$bitmapData,n.$initData(o.x,o.y,o.w,o.h,o.offX,o.offY,o.sourceW,o.sourceH,e.$sourceWidth,e.$sourceHeight),this.mTextureAtlasMap[r]=n}},e}(t.SpriteResourceBase);t.FrameSpriteTextureResource=i,__reflect(i.prototype,"map.FrameSpriteTextureResource",["core.ResItemCallback","core.TextureCallback"])}(map||(map={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.code=t[0],this.params=t[1]},e.prototype.destory=function(){},e}(t.EventArgs);t.SdkResultEvent=e,__reflect(e.prototype,"core.SdkResultEvent");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t.mInterGameSdk=null,t.mSupportInvite=!1,t.mAttentionStatus=r.NOT_SUPPORT_ATTENTION,t}return __extends(r,i),r.staticInit=function(t,e){r.sCmdLine=t,r.sMainClass=e},r.prototype.initSdk=function(e){this.mConfig=new t.ConfigFile,this.mConfig.initWithJson(e),this._loginSuccessAppead="qdKey="+this.getStringConfigDef("QD_Key",""),this._loginSuccessAppead=this._loginSuccessAppead+"&code1="+this.getStringConfigDef("QD_Code1",""),this._loginSuccessAppead=this._loginSuccessAppead+"&code2="+this.getStringConfigDef("QD_Code2",""),this._loginSuccessAppead=this._loginSuccessAppead+"&gameKey="+this.getStringConfigDef("GameKey",""),this._loginSuccessAppead=this._loginSuccessAppead+"&gameName="+this.getStringConfigDef("GameName","")+"&",this.initCmdLine();var i=egret.getDefinitionByName(r.sMainClass);i&&(this.mInterGameSdk=new i(this)),null!=this.mInterGameSdk&&this.mInterGameSdk.initSdk()},r.prototype.initCmdLine=function(){if(TLog.Debug("sCmdLine",r.sCmdLine),this.mCmdListValueList={},TLog.Debug("GameSdk.sCmdLine",r.sCmdLine),null!=r.sCmdLine&&r.sCmdLine.length>1){var e=r.sCmdLine.indexOf("?");if(-1!=e){var i=r.sCmdLine.substr(0,e);if(r.sCmdLine.length>e+1){var o=e+1,n=r.sCmdLine.substr(o,r.sCmdLine.length-o);this.mCmdListValueList=t.GameSdkUtil.splitHttpParams(n)}this.mCmdListValueList.url=i}else this.mCmdListValueList.url=r.sCmdLine}for(var a in this.mCmdListValueList){var s=this.mCmdListValueList[a];TLog.Debug("cmd:",a,s)}},r.prototype.getFromCmdLine=function(t){return this.mCmdListValueList[t]},r.prototype.getStringConfigDef=function(t,e){return this.mConfig.getString(t,e)},r.prototype.getBoolConfigDef=function(t,e){return this.mConfig.getBoolean(t,e)},r.prototype.reportRoleCreate=function(t,e){return TLog.Debug("GameSdk.reportRoleCreate"),null==this.mInterGameSdk?!1:this.mInterGameSdk.reportRoleCreate(t,e)},r.prototype.reportRoleLogin=function(t,e){return TLog.Debug("GameSdk.reportRoleLogin"),null==this.mInterGameSdk?!1:this.mInterGameSdk.reportRoleLogin(t,e)},r.prototype.reportFirstEnter=function(){return TLog.Debug("GameSdk.reportFirstEnter"),null==this.mInterGameSdk?!1:this.mInterGameSdk.reportFirstEnter()},r.prototype.reportPayReturn=function(t,e,i){return TLog.Debug("GameSdk.reportFirstEnter"),null==this.mInterGameSdk?!1:this.mInterGameSdk.reportPayReturn(t,e,i)},r.prototype.canInvite=function(){return this.mSupportInvite},r.prototype.setSupportInvite=function(t){TLog.Debug("GameSdk:setSupportInvite",t),this.mSupportInvite=t,this.fireEvent(r.SHARE_STATUS_CHANGE,e.newObj(0))},r.prototype.setAttentionStatus=function(t){TLog.Debug("GameSdk:setAttentionStatus",t),this.mAttentionStatus=t,this.fireEvent(r.ATTENTION_STATUS_CHANGE,e.newObj(0))},r.prototype.getAttentionStatus=function(){return this.mAttentionStatus},r.prototype.canShowAttention=function(){return this.mAttentionStatus==r.NOT_ATTENTION},r.prototype.onLoginReturn=function(t,i){0==t&&(i=this._loginSuccessAppead+i),this.fireEvent(r.LoginEvent,e.newObj(t,i))},r.prototype.onInviteReturn=function(t){TLog.Debug("GameSdk:onInviteReturn",t),t&&this.fireEvent(r.SHARE_RETURN,e.newObj(0))},r.prototype.onPayReturn=function(t,i){TLog.Debug("GameSDK.onPayReturn",t,i),this.fireEvent(r.PAY_SDK_EVENT,e.newObj(t,i))},r.prototype.callLogin=function(t){return null==this.mInterGameSdk?!1:this.mInterGameSdk.login(t)},r.prototype.callPay=function(t){return TLog.Debug("sCmdLine",t),null==this.mInterGameSdk?(this.onPayReturn(-1,"not suport"),!1):this.mInterGameSdk.pay(t)},r.prototype.callShowShare=function(t){return null!=this.mInterGameSdk?this.mInterGameSdk.showShare(t):void 0},r.prototype.callShowAttention=function(t){return null!=this.mInterGameSdk?this.mInterGameSdk.showAttention(t):void 0},r.prototype.callSdk=function(t,e){void 0===e&&(e=""),null==this.mInterGameSdk?this.callRuntimeInterface(t,e):this.mInterGameSdk.callSdk(t,e)},r.prototype.callRuntimeInterface=function(t,e){if(""!=t&&null!=t){var i=this,r=function(e){i.callEventToGame.call(i,t,e)};egret.ExternalInterface.addCallback(t,r)}},r.prototype.callEventToGame=function(t,i){this.fireEvent(t,e.newObj(0,i))},r.SHARE_STATUS_CHANGE="SHARE_STATUS_CHANGE",r.SHARE_RETURN="SHARE_RETURN",r.ATTENTION_STATUS_CHANGE="ATTENTION_STATUS_CHANGE",r.PAY_SDK_EVENT="PAY_SDK_EVENT",r.LoginEvent="LoginEvent",r.NOT_SUPPORT_ATTENTION=-1,r.NOT_ATTENTION=0,r.AREADY_ATTENTION=1,r.sCmdLine=null,r.sMainClass=null,r}(t.EventSet);t.GameSdk=i,__reflect(i.prototype,"core.GameSdk")}(core||(core={}));var core;!function(t){var e=function(){function t(){}return t.splitHttpParams=function(t){if(!t)return{};for(var e={},i=t.split("&"),r=0;r<i.length;++r){var o=i[r],n=o.search("=");if(-1!=n&&o.length>n+1){var a=o.substr(0,n),s=n+1,h=o.substr(s,o.length-s);e[a]=h}}return e},t.httpParamsToString=function(t){if(null==t)return"";var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")},t.getOSTime=function(){var t=new Date;return Math.floor(t.getTime()/1e3)},t.toNumber=function(t,e){return null==t?e:"number"==typeof t?t:JsUtil.toNumber(t,e)},t}();t.GameSdkUtil=e,__reflect(e.prototype,"core.GameSdkUtil")}(core||(core={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTcpListLock=0,this.mTcpList=[],this.mHttpListLock=0,this.mHttpList=[]},i.prototype.destory=function(){this.clearAll()},i.prototype.createNetWork=function(){var e=this.mTcpList;this.mTcpListLock>0&&(e=this.mTcpList=this.mTcpList.concat());var i=t.NetWork.newObj();return e.push(i),i},i.prototype.removeNetWork=function(t){var e=this.mTcpList.indexOf(t);if(-1==e)return!1;var i=this.mTcpList;return this.mTcpListLock>0&&(i=this.mTcpList=this.mTcpList.concat()),t.deleteObj(),i.splice(e,1),!0},i.prototype.createHttpClient=function(){var e=this.mHttpList;this.mHttpListLock>0&&(e=this.mHttpList=this.mHttpList.concat());var i=t.HttpClient.newObj();return e.push(i),i},i.prototype.removeHttpClient=function(t){var e=this.mHttpList.indexOf(t);if(-1==e)return!1;var i=this.mHttpList;this.mHttpListLock>0&&(i=this.mHttpList=this.mHttpList.concat()),t.deleteObj(),i.splice(e,1)},i.prototype.onUpdate=function(){var t=this.mTcpList,e=this.mHttpList;this.mTcpListLock++;for(var i=0,r=t;i<r.length;i++){var o=r[i];o.onUpdate()}this.mTcpListLock--,this.mHttpListLock++;for(var n=0,a=e;n<a.length;n++){var s=a[n];s.onUpdate()}this.mHttpListLock--},i.prototype.clearAll=function(){for(var t=0,e=this.mTcpList;t<e.length;t++){var i=e[t];i.deleteObj()}this.mTcpList=null;for(var r=0,o=this.mHttpList;r<o.length;r++){var n=o[r];n.onUpdate()}this.mHttpList=null},i}(TClass);t.NetSystem=e,__reflect(e.prototype,"core.NetSystem")}(core||(core={}));